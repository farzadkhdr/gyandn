<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: calc(100vh - 56px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table-responsive {
            border-radius: 5px;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .copyright {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .vehicle-details, .customer-details {
            display: none;
            margin-top: 20px;
        }
        
        .suggestion-list {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .status-returned {
            background-color: #d4edda;
        }
        
        .status-not-returned {
            background-color: #f8d7da;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .invoice-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-logo img {
            max-width: 200px;
            height: auto;
        }
        
        .custom-logo {
            max-height: 50px;
            margin-right: 10px;
        }
        
        .currency-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .user-only {
            display: none;
        }
        
        .system-logo-large {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
        }
        
        .signature-area {
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .maintenance-status {
            background-color: #fff3cd;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .vehicle-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .customer-form-container {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .form-section {
            margin-bottom: 20px;
        }
        
        .debt-summary {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .permission-item {
            margin-bottom: 10px;
        }
        
        .advanced-search {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .permission-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-4">
            <i class="fas fa-car fa-3x text-primary mb-3"></i>
            <h2>Car Rental System</h2>
            <p class="text-muted">Please login to continue</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        <div class="text-center mt-3">
            <small class="text-muted">Default admin password: 000000</small>
        </div>
        <div class="text-center mt-4">
            <small class="text-muted">Created by Farzad Programmer - Not Editable</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img id="headerLogo" src="" class="custom-logo" style="display: none;">
                    <span id="headerSystemName">Car Rental System</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <span id="currentUser">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key"></i> Change Password</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#userManagementModal"><i class="fas fa-users"></i> User Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar d-none d-md-block no-print">
                    <div class="logo-container">
                        <img id="sidebarLogo" src="" class="system-logo-large" style="display: none;">
                        <span class="system-name" id="sidebarSystemName">RentalSys</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item dashboard-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item vehicles-item">
                            <a class="nav-link" href="#vehicles" data-bs-toggle="tab">
                                <i class="fas fa-car"></i> Vehicles
                            </a>
                        </li>
                        <li class="nav-item rentals-customers-item">
                            <a class="nav-link" href="#rentals-customers" data-bs-toggle="tab">
                                <i class="fas fa-users"></i> Rentals & Customers
                            </a>
                        </li>
                        <li class="nav-item returns-item">
                            <a class="nav-link" href="#returns" data-bs-toggle="tab">
                                <i class="fas fa-undo"></i> Vehicle Returns
                            </a>
                        </li>
                        <li class="nav-item maintenance-item">
                            <a class="nav-link" href="#maintenance" data-bs-toggle="tab">
                                <i class="fas fa-tools"></i> Vehicle Maintenance
                            </a>
                        </li>
                        <li class="nav-item payments-item">
                            <a class="nav-link" href="#payments" data-bs-toggle="tab">
                                <i class="fas fa-money-bill-wave"></i> Payments
                            </a>
                        </li>
                        <li class="nav-item fines-item">
                            <a class="nav-link" href="#fines" data-bs-toggle="tab">
                                <i class="fas fa-gavel"></i> Fines & Taxes
                            </a>
                        </li>
                        <li class="nav-item reports-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">
                                <i class="fas fa-chart-bar"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item admin-only settings-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cogs"></i> System Settings
                            </a>
                        </li>
                    </ul>
                    <div class="copyright">
                        Created by Farzad Programmer<br>Not Editable
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 ms-sm-auto col-lg-10 px-4">
                    <div class="tab-content mt-4">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard</h2>
                            <div class="row" id="dashboardStats">
                                <!-- Dashboard statistics will be loaded here -->
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Recent Rentals
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentRentalsTable">
                                                        <!-- Recent rentals will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Vehicle Status
                                        </div>
                                        <div class="card-body">
                                            <canvas id="vehicleStatusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicles Tab -->
                        <div class="tab-pane fade" id="vehicles">
                            <h2 class="mb-4">Vehicle Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addVehicle">Add Vehicle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleList">Vehicle List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleHistory">Vehicle History</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addVehicle">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Vehicle
                                        </div>
                                        <div class="card-body">
                                            <form id="addVehicleForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleName" class="form-label">Vehicle Name</label>
                                                        <input type="text" class="form-control" id="vehicleName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleOdometer" class="form-label">Odometer</label>
                                                        <input type="number" class="form-control" id="vehicleOdometer" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleVin" class="form-label">VIN #</label>
                                                        <input type="text" class="form-control" id="vehicleVin" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehiclePlate" class="form-label">Plate Number</label>
                                                        <input type="text" class="form-control" id="vehiclePlate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleColor" class="form-label">Color</label>
                                                        <input type="text" class="form-control" id="vehicleColor" placeholder="Type color..." required>
                                                        <div class="suggestion-list" id="colorSuggestions"></div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleModel" class="form-label">Model</label>
                                                        <input type="text" class="form-control" id="vehicleModel" placeholder="Type model year..." required>
                                                        <div class="suggestion-list" id="modelSuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleRentalPrice" class="form-label">Rental Price (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="vehicleRentalPrice" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleImage" class="form-label">Vehicle Image</label>
                                                        <input type="file" class="form-control" id="vehicleImage" accept="image/*">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Vehicle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicles...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Name</th>
                                                            <th>Model</th>
                                                            <th>Color</th>
                                                            <th>Plate #</th>
                                                            <th>Odometer</th>
                                                            <th>Rental Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleTableBody">
                                                        <!-- Vehicle data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle Details Section -->
                                    <div class="card vehicle-details" id="vehicleDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeVehicleDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="vehicleDetailsContent">
                                            <!-- Vehicle details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleHistory">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleHistorySearch" placeholder="Search by vehicle name...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleHistorySearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Vehicle</th>
                                                            <th>Customer</th>
                                                            <th>Rental Date</th>
                                                            <th>Return Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleHistoryTableBody">
                                                        <!-- Vehicle history will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals & Customers Tab -->
                        <div class="tab-pane fade" id="rentals-customers">
                            <h2 class="mb-4">Rentals & Customers Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#rentalCar">Rent a Car</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#customerList">Customer List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#rentalList">Rental List</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="rentalCar">
                                    <div class="card">
                                        <div class="card-header">
                                            Rent a Car
                                        </div>
                                        <div class="card-body">
                                            <form id="createRentalForm">
                                                <div class="form-section">
                                                    <h5>Customer Information</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalCustomer" class="form-label">Customer</label>
                                                            <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer or add new...">
                                                            <div class="suggestion-list" id="customerSuggestions"></div>
                                                            <div class="form-text">If customer doesn't exist, you can add them below</div>
                                                        </div>
                                                        <div class="col-md-6 mb-3 d-flex align-items-end">
                                                            <button type="button" class="btn btn-outline-primary" id="toggleCustomerForm">
                                                                <i class="fas fa-user-plus"></i> Add New Customer
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- New Customer Form (Initially Hidden) -->
                                                    <div class="customer-form-container" id="newCustomerForm">
                                                        <h6>Add New Customer</h6>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerFullName" class="form-label">Full Name *</label>
                                                                <input type="text" class="form-control" id="customerFullName">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerAge" class="form-label">Age *</label>
                                                                <input type="number" class="form-control" id="customerAge">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerId" class="form-label">PS/ID *</label>
                                                                <input type="text" class="form-control" id="customerId">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerNationality" class="form-label">Nationality *</label>
                                                                <input type="text" class="form-control" id="customerNationality" placeholder="Type country name...">
                                                                <div class="suggestion-list" id="nationalitySuggestions"></div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerContact" class="form-label">Contact Number *</label>
                                                                <input type="text" class="form-control" id="customerContact">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerAddress" class="form-label">Address *</label>
                                                                <input type="text" class="form-control" id="customerAddress">
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="guaranteeDoc" class="form-label">Guarantee / Document</label>
                                                            <input type="file" class="form-control" id="guaranteeDoc">
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="form-section">
                                                    <h5>Vehicle Information</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalVehicle" class="form-label">Vehicle</label>
                                                            <input type="text" class="form-control" id="rentalVehicle" placeholder="Search vehicle...">
                                                            <div class="suggestion-list" id="vehicleSuggestions"></div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalAmount" class="form-label">Rental Amount (per day)</label>
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" id="rentalAmount" required>
                                                                <span class="input-group-text">AED</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalDays" class="form-label">Rental Days</label>
                                                            <input type="number" class="form-control" id="rentalDays" required>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="invoiceCode" class="form-label">Invoice Code</label>
                                                            <input type="text" class="form-control" id="invoiceCode">
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalStartDate" class="form-label">Rental Start Date</label>
                                                            <input type="date" class="form-control" id="rentalStartDate" required>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalEndDate" class="form-label">Rental End Date</label>
                                                            <input type="date" class="form-control" id="rentalEndDate" required>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="advancePayment" class="form-label">Advance Payment (Optional)</label>
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" id="advancePayment" value="0">
                                                                <span class="input-group-text">AED</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary">Create Rental</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="customerList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                                                <button class="btn btn-outline-secondary" type="button" id="customerSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Full Name</th>
                                                            <th>Age</th>
                                                            <th>ID</th>
                                                            <th>Nationality</th>
                                                            <th>Contact</th>
                                                            <th>Total Debt</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customerTableBody">
                                                        <!-- Customer data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Details Section -->
                                    <div class="card customer-details" id="customerDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeCustomerDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="customerDetailsContent">
                                            <!-- Customer details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="rentalList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="rentalSearch" placeholder="Search by invoice code...">
                                                <button class="btn btn-outline-secondary" type="button" id="rentalSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Invoice Code</th>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Start Date</th>
                                                            <th>End Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rentalTableBody">
                                                        <!-- Rental data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Invoice for Printing -->
                            <div id="invoicePrint" class="print-only" style="display: none;">
                                <div class="invoice-logo">
                                    <img id="printLogo" src="" style="max-width: 200px; display: none;">
                                    <h3 id="printSystemName">Car Rental System</h3>
                                </div>
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h3>Car Rental Invoice</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Invoice Code:</strong> <span id="printInvoiceCode"></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Date:</strong> <span id="printInvoiceDate"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer:</strong> <span id="printCustomerName"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Vehicle:</strong> <span id="printVehicleName"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer ID:</strong> <span id="printCustomerId"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Customer Address:</strong> <span id="printCustomerAddress"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Amount (per day):</strong> <span id="printRentalAmount"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Days:</strong> <span id="printRentalDays"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental History:</strong>
                                                <div id="printRentalHistory"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <hr>
                                                <h4 class="text-end">Total: <span id="printTotalAmount"></span></h4>
                                            </div>
                                        </div>
                                        <div class="row signature-area">
                                            <div class="col-6">
                                                <strong>Customer Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Company Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Returns Tab -->
                        <div class="tab-pane fade" id="returns">
                            <h2 class="mb-4">Vehicle Returns</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Return Vehicle
                                </div>
                                <div class="card-body">
                                    <form id="returnVehicleForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="returnInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="returnInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="invoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="returnOdometer" class="form-label">Odometer Reading at Return</label>
                                                <input type="number" class="form-control" id="returnOdometer" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="returnDate" class="form-label">Return Date</label>
                                                <input type="date" class="form-control" id="returnDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="returnCondition" class="form-label">Vehicle Condition</label>
                                                <select class="form-select" id="returnCondition" required>
                                                    <option value="">Select condition...</option>
                                                    <option value="excellent">Excellent</option>
                                                    <option value="good">Good</option>
                                                    <option value="fair">Fair</option>
                                                    <option value="poor">Poor</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="returnNotes" class="form-label">Notes (Optional)</label>
                                                <textarea class="form-control" id="returnNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Process Return</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Return History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Odometer</th>
                                                    <th>Condition</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnTableBody">
                                                <!-- Return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Maintenance Tab -->
                        <div class="tab-pane fade" id="maintenance">
                            <h2 class="mb-4">Vehicle Maintenance</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Schedule Maintenance
                                </div>
                                <div class="card-body">
                                    <form id="maintenanceForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="maintenanceVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="maintenanceVehicleSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceType" class="form-label">Maintenance Type</label>
                                                <select class="form-select" id="maintenanceType" required>
                                                    <option value="">Select type...</option>
                                                    <option value="oil_change">Oil Change</option>
                                                    <option value="tire_rotation">Tire Rotation</option>
                                                    <option value="brake_service">Brake Service</option>
                                                    <option value="engine_service">Engine Service</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceDate" class="form-label">Maintenance Date</label>
                                                <input type="date" class="form-control" id="maintenanceDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceCost" class="form-label">Cost</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="maintenanceCost" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="maintenanceDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="maintenanceDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Schedule Maintenance</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Maintenance History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Type</th>
                                                    <th>Date</th>
                                                    <th>Cost</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="maintenanceTableBody">
                                                <!-- Maintenance history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payments Tab -->
                        <div class="tab-pane fade" id="payments">
                            <h2 class="mb-4">Payment Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Record Payment
                                </div>
                                <div class="card-body">
                                    <form id="paymentForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="paymentInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="paymentInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentAmount" class="form-label">Payment Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="paymentAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentDate" class="form-label">Payment Date</label>
                                                <input type="date" class="form-control" id="paymentDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                                <select class="form-select" id="paymentMethod" required>
                                                    <option value="">Select method...</option>
                                                    <option value="cash">Cash</option>
                                                    <option value="card">Card</option>
                                                    <option value="bank_transfer">Bank Transfer</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="paymentNotes" class="form-label">Notes (Optional)</label>
                                                <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Record Payment</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Payment History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Method</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentTableBody">
                                                <!-- Payment history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fines & Taxes Tab -->
                        <div class="tab-pane fade" id="fines">
                            <h2 class="mb-4">Fines & Taxes Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Add Fine/Tax
                                </div>
                                <div class="card-body">
                                    <form id="fineForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="fineInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="fineInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineType" class="form-label">Type</label>
                                                <select class="form-select" id="fineType" required>
                                                    <option value="">Select type...</option>
                                                    <option value="traffic_fine">Traffic Fine</option>
                                                    <option value="late_return">Late Return</option>
                                                    <option value="damage">Damage</option>
                                                    <option value="tax">Tax</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="fineAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="fineDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="fineDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="fineDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Fine/Tax</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Fines & Taxes History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fineTableBody">
                                                <!-- Fines history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div class="tab-pane fade" id="reports">
                            <h2 class="mb-4">Reports</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Generate Report
                                </div>
                                <div class="card-body">
                                    <form id="reportForm">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="reportType" class="form-label">Report Type</label>
                                                <select class="form-select" id="reportType" required>
                                                    <option value="">Select report type...</option>
                                                    <option value="rental">Rental Report</option>
                                                    <option value="financial">Financial Report</option>
                                                    <option value="vehicle">Vehicle Report</option>
                                                    <option value="customer">Customer Report</option>
                                                    <option value="maintenance">Maintenance Report</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="reportStartDate" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="reportStartDate" required>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="reportEndDate" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="reportEndDate" required>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Generate Report</button>
                                        <button type="button" class="btn btn-success" id="exportReportBtn">
                                            <i class="fas fa-file-export"></i> Export to Excel
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Report Results
                                </div>
                                <div class="card-body">
                                    <div id="reportResults">
                                        <!-- Report results will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Settings Tab -->
                        <div class="tab-pane fade" id="settings">
                            <h2 class="mb-4">System Settings</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    General Settings
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName" value="Car Rental System">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="systemLogo" class="form-label">System Logo</label>
                                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="currency" class="form-label">Currency</label>
                                                <select class="form-select" id="currency">
                                                    <option value="AED" selected>AED (UAE Dirham)</option>
                                                    <option value="USD">USD (US Dollar)</option>
                                                    <option value="EUR">EUR (Euro)</option>
                                                    <option value="GBP">GBP (British Pound)</option>
                                                    <option value="SAR">SAR (Saudi Riyal)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="dateFormat" class="form-label">Date Format</label>
                                                <select class="form-select" id="dateFormat">
                                                    <option value="YYYY-MM-DD" selected>YYYY-MM-DD</option>
                                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    User Permissions
                                </div>
                                <div class="card-body">
                                    <div class="permission-section">
                                        <h5>User Management</h5>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionUserAdd" class="form-check-input">
                                            <label for="permissionUserAdd" class="form-check-label">Add Users</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionUserEdit" class="form-check-input">
                                            <label for="permissionUserEdit" class="form-check-label">Edit Users</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionUserDelete" class="form-check-input">
                                            <label for="permissionUserDelete" class="form-check-label">Delete Users</label>
                                        </div>
                                    </div>
                                    
                                    <div class="permission-section">
                                        <h5>Vehicle Management</h5>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionVehicleAdd" class="form-check-input">
                                            <label for="permissionVehicleAdd" class="form-check-label">Add Vehicles</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionVehicleEdit" class="form-check-input">
                                            <label for="permissionVehicleEdit" class="form-check-label">Edit Vehicles</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionVehicleDelete" class="form-check-input">
                                            <label for="permissionVehicleDelete" class="form-check-label">Delete Vehicles</label>
                                        </div>
                                    </div>
                                    
                                    <div class="permission-section">
                                        <h5>Rental Management</h5>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionRentalCreate" class="form-check-input">
                                            <label for="permissionRentalCreate" class="form-check-label">Create Rentals</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionRentalEdit" class="form-check-input">
                                            <label for="permissionRentalEdit" class="form-check-label">Edit Rentals</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permissionRentalDelete" class="form-check-input">
                                            <label for="permissionRentalDelete" class="form-check-label">Delete Rentals</label>
                                        </div>
                                    </div>
                                    
                                    <button type="button" class="btn btn-primary mt-3">Save Permissions</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="savePasswordBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade" id="userManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- User data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-primary" id="addUserBtn">
                        <i class="fas fa-user-plus"></i> Add User
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="newFullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="newFullName" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserRole" class="form-label">Role</label>
                            <select class="form-select" id="newUserRole" required>
                                <option value="admin">Admin</option>
                                <option value="user">User</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="newUserPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveUserBtn">Save User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // System Data Storage
        let systemData = {
            users: [
                { username: "admin", password: "000000", fullName: "System Administrator", role: "admin" },
                { username: "user", password: "123456", fullName: "Regular User", role: "user" }
            ],
            vehicles: [],
            customers: [],
            rentals: [],
            returns: [],
            maintenance: [],
            payments: [],
            fines: [],
            settings: {
                systemName: "Car Rental System",
                currency: "AED",
                dateFormat: "YYYY-MM-DD"
            },
            permissions: {
                admin: {
                    dashboard: true,
                    vehicles: true,
                    rentals_customers: true,
                    returns: true,
                    maintenance: true,
                    payments: true,
                    fines: true,
                    reports: true,
                    settings: true
                },
                user: {
                    dashboard: true,
                    vehicles: true,
                    rentals_customers: true,
                    returns: true,
                    maintenance: true,
                    payments: true,
                    fines: true,
                    reports: true,
                    settings: false
                }
            }
        };

        // Current User
        let currentUser = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize date fields
            initializeDateFields();
            
            // Check if user is already logged in
            checkLoginStatus();
        });

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('carRentalSystem');
            if (savedData) {
                systemData = JSON.parse(savedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('carRentalSystem', JSON.stringify(systemData));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Save password button
            document.getElementById('savePasswordBtn').addEventListener('click', changePassword);
            
            // Add user button
            document.getElementById('addUserBtn').addEventListener('click', showAddUserModal);
            
            // Save user button
            document.getElementById('saveUserBtn').addEventListener('click', saveNewUser);
            
            // Vehicle form
            document.getElementById('addVehicleForm').addEventListener('submit', addVehicle);
            
            // Vehicle search
            document.getElementById('vehicleSearchBtn').addEventListener('click', searchVehicles);
            document.getElementById('vehicleSearch').addEventListener('input', searchVehicles);
            
            // Close vehicle details
            document.getElementById('closeVehicleDetails').addEventListener('click', closeVehicleDetails);
            
            // Vehicle history search
            document.getElementById('vehicleHistorySearchBtn').addEventListener('click', searchVehicleHistory);
            document.getElementById('vehicleHistorySearch').addEventListener('input', searchVehicleHistory);
            
            // Customer search
            document.getElementById('customerSearchBtn').addEventListener('click', searchCustomers);
            document.getElementById('customerSearch').addEventListener('input', searchCustomers);
            
            // Close customer details
            document.getElementById('closeCustomerDetails').addEventListener('click', closeCustomerDetails);
            
            // Toggle customer form
            document.getElementById('toggleCustomerForm').addEventListener('click', toggleCustomerForm);
            
            // Rental form
            document.getElementById('createRentalForm').addEventListener('submit', createRental);
            
            // Rental search
            document.getElementById('rentalSearchBtn').addEventListener('click', searchRentals);
            document.getElementById('rentalSearch').addEventListener('input', searchRentals);
            
            // Return form
            document.getElementById('returnVehicleForm').addEventListener('submit', processReturn);
            
            // Maintenance form
            document.getElementById('maintenanceForm').addEventListener('submit', scheduleMaintenance);
            
            // Payment form
            document.getElementById('paymentForm').addEventListener('submit', recordPayment);
            
            // Fine form
            document.getElementById('fineForm').addEventListener('submit', addFine);
            
            // Report form
            document.getElementById('reportForm').addEventListener('submit', generateReport);
            
            // Export report button
            document.getElementById('exportReportBtn').addEventListener('click', exportReport);
            
            // Settings form
            document.getElementById('generalSettingsForm').addEventListener('submit', saveSettings);
            
            // Auto-suggestions
            setupAutoSuggestions();
        }

        // Initialize date fields with current date
        function initializeDateFields() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('rentalStartDate').value = today;
            document.getElementById('rentalEndDate').value = today;
            document.getElementById('returnDate').value = today;
            document.getElementById('maintenanceDate').value = today;
            document.getElementById('paymentDate').value = today;
            document.getElementById('fineDate').value = today;
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = today;
        }

        // Check if user is already logged in
        function checkLoginStatus() {
            const loggedInUser = sessionStorage.getItem('currentUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showMainApp();
            }
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = systemData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                showMainApp();
            } else {
                alert('Invalid username or password!');
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            sessionStorage.removeItem('currentUser');
            showLoginScreen();
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        // Show main application
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update UI based on current user
            updateUIForUser();
            
            // Load dashboard data
            loadDashboardData();
            
            // Load vehicle list
            loadVehicleList();
            
            // Load customer list
            loadCustomerList();
            
            // Load rental list
            loadRentalList();
            
            // Load return history
            loadReturnHistory();
            
            // Load maintenance history
            loadMaintenanceHistory();
            
            // Load payment history
            loadPaymentHistory();
            
            // Load fine history
            loadFineHistory();
            
            // Load user list
            loadUserList();
            
            // Apply settings
            applySettings();
        }

        // Update UI based on user role
        function updateUIForUser() {
            document.getElementById('currentUser').textContent = currentUser.fullName;
            
            // Show/hide admin-only elements
            const adminOnlyElements = document.querySelectorAll('.admin-only');
            adminOnlyElements.forEach(el => {
                el.style.display = currentUser.role === 'admin' ? 'block' : 'none';
            });
            
            // Show/hide user-only elements
            const userOnlyElements = document.querySelectorAll('.user-only');
            userOnlyElements.forEach(el => {
                el.style.display = currentUser.role === 'user' ? 'block' : 'none';
            });
            
            // Enable/disable tabs based on permissions
            const userPermissions = systemData.permissions[currentUser.role];
            
            const tabItems = {
                'dashboard': document.querySelector('.dashboard-item'),
                'vehicles': document.querySelector('.vehicles-item'),
                'rentals_customers': document.querySelector('.rentals-customers-item'),
                'returns': document.querySelector('.returns-item'),
                'maintenance': document.querySelector('.maintenance-item'),
                'payments': document.querySelector('.payments-item'),
                'fines': document.querySelector('.fines-item'),
                'reports': document.querySelector('.reports-item'),
                'settings': document.querySelector('.settings-item')
            };
            
            for (const [tab, element] of Object.entries(tabItems)) {
                if (element) {
                    element.style.display = userPermissions[tab] ? 'block' : 'none';
                }
            }
        }

        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== currentUser.password) {
                alert('Current password is incorrect!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            
            // Update in system data
            const userIndex = systemData.users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                systemData.users[userIndex].password = newPassword;
            }
            
            // Save data
            saveData();
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Close modal and reset form
            document.getElementById('changePasswordModal').querySelector('.btn-close').click();
            document.getElementById('changePasswordForm').reset();
            
            alert('Password changed successfully!');
        }

        // Show add user modal
        function showAddUserModal() {
            // Close user management modal
            document.getElementById('userManagementModal').querySelector('.btn-close').click();
            
            // Show add user modal
            const addUserModal = new bootstrap.Modal(document.getElementById('addUserModal'));
            addUserModal.show();
        }

        // Save new user
        function saveNewUser() {
            const username = document.getElementById('newUsername').value;
            const fullName = document.getElementById('newFullName').value;
            const role = document.getElementById('newUserRole').value;
            const password = document.getElementById('newUserPassword').value;
            
            // Check if username already exists
            if (systemData.users.some(u => u.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            // Add new user
            systemData.users.push({
                username,
                password,
                fullName,
                role
            });
            
            // Save data
            saveData();
            
            // Reload user list
            loadUserList();
            
            // Close modal and reset form
            document.getElementById('addUserModal').querySelector('.btn-close').click();
            document.getElementById('addUserForm').reset();
            
            alert('User added successfully!');
        }

        // Load user list
        function loadUserList() {
            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = '';
            
            systemData.users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.role}</td>
                    <td>Active</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editUser('${user.username}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.username !== 'admin' ? `
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                userTableBody.appendChild(row);
            });
        }

        // Edit user (placeholder)
        function editUser(username) {
            alert(`Edit user functionality for ${username} would be implemented here.`);
        }

        // Delete user
        function deleteUser(username) {
            if (confirm(`Are you sure you want to delete user ${username}?`)) {
                systemData.users = systemData.users.filter(u => u.username !== username);
                saveData();
                loadUserList();
                alert('User deleted successfully!');
            }
        }

        // Add vehicle
        function addVehicle(e) {
            e.preventDefault();
            
            const name = document.getElementById('vehicleName').value;
            const odometer = parseInt(document.getElementById('vehicleOdometer').value);
            const vin = document.getElementById('vehicleVin').value;
            const plate = document.getElementById('vehiclePlate').value;
            const color = document.getElementById('vehicleColor').value;
            const model = document.getElementById('vehicleModel').value;
            const rentalPrice = parseFloat(document.getElementById('vehicleRentalPrice').value);
            
            // Check if VIN already exists
            if (systemData.vehicles.some(v => v.vin === vin)) {
                alert('Vehicle with this VIN already exists!');
                return;
            }
            
            // Check if plate number already exists
            if (systemData.vehicles.some(v => v.plate === plate)) {
                alert('Vehicle with this plate number already exists!');
                return;
            }
            
            // Add new vehicle
            const newVehicle = {
                id: generateId(),
                name,
                odometer,
                vin,
                plate,
                color,
                model,
                rentalPrice,
                status: 'available',
                image: null,
                createdDate: new Date().toISOString()
            };
            
            // Handle image upload
            const imageInput = document.getElementById('vehicleImage');
            if (imageInput.files.length > 0) {
                const file = imageInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newVehicle.image = e.target.result;
                    systemData.vehicles.push(newVehicle);
                    saveData();
                    loadVehicleList();
                    document.getElementById('addVehicleForm').reset();
                    alert('Vehicle added successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                systemData.vehicles.push(newVehicle);
                saveData();
                loadVehicleList();
                document.getElementById('addVehicleForm').reset();
                alert('Vehicle added successfully!');
            }
        }

        // Load vehicle list
        function loadVehicleList() {
            const vehicleTableBody = document.getElementById('vehicleTableBody');
            vehicleTableBody.innerHTML = '';
            
            systemData.vehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${vehicle.image ? 
                            `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : 
                            '<i class="fas fa-car fa-2x text-muted"></i>'
                        }
                    </td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.odometer.toLocaleString()}</td>
                    <td>${vehicle.rentalPrice} <span class="currency-badge">${systemData.settings.currency}</span></td>
                    <td>
                        <span class="badge ${vehicle.status === 'available' ? 'bg-success' : 
                                         vehicle.status === 'rented' ? 'bg-warning' : 
                                         vehicle.status === 'maintenance' ? 'bg-info' : 'bg-danger'}">
                            ${vehicle.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewVehicleDetails('${vehicle.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editVehicle('${vehicle.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteVehicle('${vehicle.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                vehicleTableBody.appendChild(row);
            });
        }

        // View vehicle details
        function viewVehicleDetails(vehicleId) {
            const vehicle = systemData.vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            const detailsContent = document.getElementById('vehicleDetailsContent');
            detailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        ${vehicle.image ? 
                            `<img src="${vehicle.image}" class="img-fluid rounded" alt="${vehicle.name}">` : 
                            '<div class="text-center p-4 bg-light rounded"><i class="fas fa-car fa-5x text-muted"></i></div>'
                        }
                    </div>
                    <div class="col-md-8">
                        <h4>${vehicle.name}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Model:</th>
                                <td>${vehicle.model}</td>
                            </tr>
                            <tr>
                                <th>Color:</th>
                                <td>${vehicle.color}</td>
                            </tr>
                            <tr>
                                <th>Plate Number:</th>
                                <td>${vehicle.plate}</td>
                            </tr>
                            <tr>
                                <th>VIN:</th>
                                <td>${vehicle.vin}</td>
                            </tr>
                            <tr>
                                <th>Odometer:</th>
                                <td>${vehicle.odometer.toLocaleString()} km</td>
                            </tr>
                            <tr>
                                <th>Rental Price:</th>
                                <td>${vehicle.rentalPrice} <span class="currency-badge">${systemData.settings.currency}</span> per day</td>
                            </tr>
                            <tr>
                                <th>Status:</th>
                                <td>
                                    <span class="badge ${vehicle.status === 'available' ? 'bg-success' : 
                                                     vehicle.status === 'rented' ? 'bg-warning' : 
                                                     vehicle.status === 'maintenance' ? 'bg-info' : 'bg-danger'}">
                                        ${vehicle.status}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Added Date:</th>
                                <td>${formatDate(vehicle.createdDate)}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${getVehicleRentalHistory(vehicleId)}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Show vehicle details section
            document.getElementById('vehicleDetailsCard').style.display = 'block';
            
            // Scroll to details section
            document.getElementById('vehicleDetailsCard').scrollIntoView({ behavior: 'smooth' });
        }

        // Get vehicle rental history
        function getVehicleRentalHistory(vehicleId) {
            const vehicleRentals = systemData.rentals.filter(r => r.vehicleId === vehicleId);
            
            if (vehicleRentals.length === 0) {
                return '<tr><td colspan="5" class="text-center">No rental history</td></tr>';
            }
            
            return vehicleRentals.map(rental => {
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                return `
                    <tr>
                        <td>${customer ? customer.fullName : 'Unknown'}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-success' : 
                                             rental.status === 'completed' ? 'bg-info' : 
                                             rental.status === 'cancelled' ? 'bg-danger' : 'bg-warning'}">
                                ${rental.status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Close vehicle details
        function closeVehicleDetails() {
            document.getElementById('vehicleDetailsCard').style.display = 'none';
        }

        // Edit vehicle (placeholder)
        function editVehicle(vehicleId) {
            alert(`Edit vehicle functionality for ID: ${vehicleId} would be implemented here.`);
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                systemData.vehicles = systemData.vehicles.filter(v => v.id !== vehicleId);
                saveData();
                loadVehicleList();
                alert('Vehicle deleted successfully!');
            }
        }

        // Search vehicles
        function searchVehicles() {
            const searchTerm = document.getElementById('vehicleSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#vehicleTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Load vehicle history
        function loadVehicleHistory() {
            const vehicleHistoryTableBody = document.getElementById('vehicleHistoryTableBody');
            vehicleHistoryTableBody.innerHTML = '';
            
            systemData.rentals.forEach(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                
                if (vehicle && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${vehicle.name}</td>
                        <td>${customer.fullName}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-success' : 
                                             rental.status === 'completed' ? 'bg-info' : 
                                             rental.status === 'cancelled' ? 'bg-danger' : 'bg-warning'}">
                                ${rental.status}
                            </span>
                        </td>
                    `;
                    vehicleHistoryTableBody.appendChild(row);
                }
            });
        }

        // Search vehicle history
        function searchVehicleHistory() {
            const searchTerm = document.getElementById('vehicleHistorySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#vehicleHistoryTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Toggle customer form
        function toggleCustomerForm() {
            const customerForm = document.getElementById('newCustomerForm');
            customerForm.style.display = customerForm.style.display === 'none' ? 'block' : 'none';
        }

        // Load customer list
        function loadCustomerList() {
            const customerTableBody = document.getElementById('customerTableBody');
            customerTableBody.innerHTML = '';
            
            systemData.customers.forEach(customer => {
                const totalDebt = calculateCustomerDebt(customer.id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.fullName}</td>
                    <td>${customer.age}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.nationality}</td>
                    <td>${customer.contact}</td>
                    <td>${totalDebt} <span class="currency-badge">${systemData.settings.currency}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewCustomerDetails('${customer.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editCustomer('${customer.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCustomer('${customer.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                customerTableBody.appendChild(row);
            });
        }

        // Calculate customer debt
        function calculateCustomerDebt(customerId) {
            const customerRentals = systemData.rentals.filter(r => r.customerId === customerId && r.status !== 'cancelled');
            let totalDebt = 0;
            
            customerRentals.forEach(rental => {
                // Calculate paid amount
                const payments = systemData.payments.filter(p => p.invoiceCode === rental.invoiceCode);
                const paidAmount = payments.reduce((sum, payment) => sum + payment.amount, 0);
                
                // Calculate fines
                const fines = systemData.fines.filter(f => f.invoiceCode === rental.invoiceCode && f.status !== 'paid');
                const finesAmount = fines.reduce((sum, fine) => sum + fine.amount, 0);
                
                totalDebt += (rental.totalAmount - paidAmount) + finesAmount;
            });
            
            return totalDebt;
        }

        // View customer details
        function viewCustomerDetails(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const detailsContent = document.getElementById('customerDetailsContent');
            detailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h4>${customer.fullName}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Age:</th>
                                <td>${customer.age}</td>
                            </tr>
                            <tr>
                                <th>ID Number:</th>
                                <td>${customer.idNumber}</td>
                            </tr>
                            <tr>
                                <th>Nationality:</th>
                                <td>${customer.nationality}</td>
                            </tr>
                            <tr>
                                <th>Contact:</th>
                                <td>${customer.contact}</td>
                            </tr>
                            <tr>
                                <th>Address:</th>
                                <td>${customer.address}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h5>Debt Summary</h5>
                        <div class="debt-summary">
                            <p><strong>Total Debt:</strong> ${calculateCustomerDebt(customerId)} <span class="currency-badge">${systemData.settings.currency}</span></p>
                            <p><strong>Active Rentals:</strong> ${systemData.rentals.filter(r => r.customerId === customerId && r.status === 'active').length}</p>
                            <p><strong>Completed Rentals:</strong> ${systemData.rentals.filter(r => r.customerId === customerId && r.status === 'completed').length}</p>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Invoice Code</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${getCustomerRentalHistory(customerId)}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Show customer details section
            document.getElementById('customerDetailsCard').style.display = 'block';
            
            // Scroll to details section
            document.getElementById('customerDetailsCard').scrollIntoView({ behavior: 'smooth' });
        }

        // Get customer rental history
        function getCustomerRentalHistory(customerId) {
            const customerRentals = systemData.rentals.filter(r => r.customerId === customerId);
            
            if (customerRentals.length === 0) {
                return '<tr><td colspan="6" class="text-center">No rental history</td></tr>';
            }
            
            return customerRentals.map(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                return `
                    <tr>
                        <td>${rental.invoiceCode}</td>
                        <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-success' : 
                                             rental.status === 'completed' ? 'bg-info' : 
                                             rental.status === 'cancelled' ? 'bg-danger' : 'bg-warning'}">
                                ${rental.status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Close customer details
        function closeCustomerDetails() {
            document.getElementById('customerDetailsCard').style.display = 'none';
        }

        // Edit customer (placeholder)
        function editCustomer(customerId) {
            alert(`Edit customer functionality for ID: ${customerId} would be implemented here.`);
        }

        // Delete customer
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                // Check if customer has active rentals
                const activeRentals = systemData.rentals.filter(r => r.customerId === customerId && r.status === 'active');
                if (activeRentals.length > 0) {
                    alert('Cannot delete customer with active rentals!');
                    return;
                }
                
                systemData.customers = systemData.customers.filter(c => c.id !== customerId);
                saveData();
                loadCustomerList();
                alert('Customer deleted successfully!');
            }
        }

        // Search customers
        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#customerTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Create rental
        function createRental(e) {
            e.preventDefault();
            
            // Get customer information
            const customerName = document.getElementById('rentalCustomer').value;
            let customer = systemData.customers.find(c => 
                c.fullName.toLowerCase().includes(customerName.toLowerCase()) || 
                c.idNumber === customerName
            );
            
            // If customer doesn't exist and new customer form is filled
            if (!customer) {
                const newCustomerForm = document.getElementById('newCustomerForm');
                if (newCustomerForm.style.display === 'block') {
                    // Validate new customer form
                    const fullName = document.getElementById('customerFullName').value;
                    const age = document.getElementById('customerAge').value;
                    const idNumber = document.getElementById('customerId').value;
                    const nationality = document.getElementById('customerNationality').value;
                    const contact = document.getElementById('customerContact').value;
                    const address = document.getElementById('customerAddress').value;
                    
                    if (!fullName || !age || !idNumber || !nationality || !contact || !address) {
                        alert('Please fill all required customer fields!');
                        return;
                    }
                    
                    // Check if customer with same ID already exists
                    if (systemData.customers.some(c => c.idNumber === idNumber)) {
                        alert('Customer with this ID already exists!');
                        return;
                    }
                    
                    // Create new customer
                    customer = {
                        id: generateId(),
                        fullName,
                        age: parseInt(age),
                        idNumber,
                        nationality,
                        contact,
                        address,
                        createdDate: new Date().toISOString()
                    };
                    
                    systemData.customers.push(customer);
                } else {
                    alert('Please select an existing customer or add a new one!');
                    return;
                }
            }
            
            // Get vehicle information
            const vehicleName = document.getElementById('rentalVehicle').value;
            const vehicle = systemData.vehicles.find(v => 
                v.name.toLowerCase().includes(vehicleName.toLowerCase()) || 
                v.plate === vehicleName
            );
            
            if (!vehicle) {
                alert('Please select a valid vehicle!');
                return;
            }
            
            // Check if vehicle is available
            if (vehicle.status !== 'available') {
                alert('Selected vehicle is not available for rental!');
                return;
            }
            
            // Get rental details
            const rentalAmount = parseFloat(document.getElementById('rentalAmount').value);
            const rentalDays = parseInt(document.getElementById('rentalDays').value);
            const startDate = document.getElementById('rentalStartDate').value;
            const endDate = document.getElementById('rentalEndDate').value;
            const invoiceCode = document.getElementById('invoiceCode').value || generateInvoiceCode();
            const advancePayment = parseFloat(document.getElementById('advancePayment').value) || 0;
            
            // Calculate total amount
            const totalAmount = rentalAmount * rentalDays;
            
            // Create rental
            const rental = {
                id: generateId(),
                invoiceCode,
                customerId: customer.id,
                vehicleId: vehicle.id,
                startDate,
                endDate,
                rentalDays,
                dailyRate: rentalAmount,
                totalAmount,
                advancePayment,
                status: 'active',
                createdDate: new Date().toISOString()
            };
            
            // Update vehicle status
            vehicle.status = 'rented';
            
            // Add rental to system
            systemData.rentals.push(rental);
            
            // Record advance payment if any
            if (advancePayment > 0) {
                const payment = {
                    id: generateId(),
                    invoiceCode,
                    amount: advancePayment,
                    date: new Date().toISOString().split('T')[0],
                    method: 'cash',
                    notes: 'Advance payment',
                    createdDate: new Date().toISOString()
                };
                
                systemData.payments.push(payment);
            }
            
            // Save data
            saveData();
            
            // Reload lists
            loadVehicleList();
            loadCustomerList();
            loadRentalList();
            
            // Reset form
            document.getElementById('createRentalForm').reset();
            document.getElementById('newCustomerForm').style.display = 'none';
            initializeDateFields();
            
            // Generate and show invoice
            generateInvoice(rental, customer, vehicle);
            
            alert('Rental created successfully!');
        }

        // Load rental list
        function loadRentalList() {
            const rentalTableBody = document.getElementById('rentalTableBody');
            rentalTableBody.innerHTML = '';
            
            systemData.rentals.forEach(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                
                if (vehicle && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${rental.invoiceCode}</td>
                        <td>${customer.fullName}</td>
                        <td>${vehicle.name}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-success' : 
                                             rental.status === 'completed' ? 'bg-info' : 
                                             rental.status === 'cancelled' ? 'bg-danger' : 'bg-warning'}">
                                ${rental.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewRentalDetails('${rental.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editRental('${rental.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-success" onclick="printInvoice('${rental.invoiceCode}')">
                                <i class="fas fa-print"></i>
                            </button>
                        </td>
                    `;
                    rentalTableBody.appendChild(row);
                }
            });
        }

        // View rental details (placeholder)
        function viewRentalDetails(rentalId) {
            alert(`View rental details functionality for ID: ${rentalId} would be implemented here.`);
        }

        // Edit rental (placeholder)
        function editRental(rentalId) {
            alert(`Edit rental functionality for ID: ${rentalId} would be implemented here.`);
        }

        // Search rentals
        function searchRentals() {
            const searchTerm = document.getElementById('rentalSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#rentalTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Process return
        function processReturn(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('returnInvoiceCode').value;
            const odometer = parseInt(document.getElementById('returnOdometer').value);
            const returnDate = document.getElementById('returnDate').value;
            const condition = document.getElementById('returnCondition').value;
            const notes = document.getElementById('returnNotes').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            if (!rental) {
                alert('Rental with this invoice code not found!');
                return;
            }
            
            // Check if already returned
            if (rental.status === 'completed') {
                alert('This vehicle has already been returned!');
                return;
            }
            
            // Find vehicle
            const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
            if (!vehicle) {
                alert('Associated vehicle not found!');
                return;
            }
            
            // Update vehicle
            vehicle.odometer = odometer;
            vehicle.status = 'available';
            
            // Update rental
            rental.status = 'completed';
            rental.actualEndDate = returnDate;
            
            // Create return record
            const returnRecord = {
                id: generateId(),
                invoiceCode,
                vehicleId: vehicle.id,
                customerId: rental.customerId,
                returnDate,
                odometer,
                condition,
                notes,
                createdDate: new Date().toISOString()
            };
            
            systemData.returns.push(returnRecord);
            
            // Save data
            saveData();
            
            // Reload lists
            loadVehicleList();
            loadRentalList();
            loadReturnHistory();
            
            // Reset form
            document.getElementById('returnVehicleForm').reset();
            initializeDateFields();
            
            alert('Vehicle return processed successfully!');
        }

        // Load return history
        function loadReturnHistory() {
            const returnTableBody = document.getElementById('returnTableBody');
            returnTableBody.innerHTML = '';
            
            systemData.returns.forEach(returnRecord => {
                const rental = systemData.rentals.find(r => r.invoiceCode === returnRecord.invoiceCode);
                const vehicle = systemData.vehicles.find(v => v.id === returnRecord.vehicleId);
                const customer = systemData.customers.find(c => c.id === returnRecord.customerId);
                
                if (rental && vehicle && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${returnRecord.invoiceCode}</td>
                        <td>${customer.fullName}</td>
                        <td>${vehicle.name}</td>
                        <td>${formatDate(returnRecord.returnDate)}</td>
                        <td>${returnRecord.odometer.toLocaleString()}</td>
                        <td>${returnRecord.condition}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewReturnDetails('${returnRecord.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    returnTableBody.appendChild(row);
                }
            });
        }

        // View return details (placeholder)
        function viewReturnDetails(returnId) {
            alert(`View return details functionality for ID: ${returnId} would be implemented here.`);
        }

        // Schedule maintenance
        function scheduleMaintenance(e) {
            e.preventDefault();
            
            const vehicleName = document.getElementById('maintenanceVehicle').value;
            const type = document.getElementById('maintenanceType').value;
            const date = document.getElementById('maintenanceDate').value;
            const cost = parseFloat(document.getElementById('maintenanceCost').value);
            const description = document.getElementById('maintenanceDescription').value;
            
            // Find vehicle
            const vehicle = systemData.vehicles.find(v => 
                v.name.toLowerCase().includes(vehicleName.toLowerCase()) || 
                v.plate === vehicleName
            );
            
            if (!vehicle) {
                alert('Please select a valid vehicle!');
                return;
            }
            
            // Create maintenance record
            const maintenance = {
                id: generateId(),
                vehicleId: vehicle.id,
                type,
                date,
                cost,
                description,
                status: 'scheduled',
                createdDate: new Date().toISOString()
            };
            
            // Update vehicle status if needed
            if (type !== 'oil_change' && type !== 'tire_rotation') {
                vehicle.status = 'maintenance';
            }
            
            systemData.maintenance.push(maintenance);
            
            // Save data
            saveData();
            
            // Reload lists
            loadVehicleList();
            loadMaintenanceHistory();
            
            // Reset form
            document.getElementById('maintenanceForm').reset();
            initializeDateFields();
            
            alert('Maintenance scheduled successfully!');
        }

        // Load maintenance history
        function loadMaintenanceHistory() {
            const maintenanceTableBody = document.getElementById('maintenanceTableBody');
            maintenanceTableBody.innerHTML = '';
            
            systemData.maintenance.forEach(maintenance => {
                const vehicle = systemData.vehicles.find(v => v.id === maintenance.vehicleId);
                
                if (vehicle) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${vehicle.name}</td>
                        <td>${maintenance.type.replace('_', ' ').toUpperCase()}</td>
                        <td>${formatDate(maintenance.date)}</td>
                        <td>${maintenance.cost} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>${maintenance.description}</td>
                        <td>
                            <span class="badge ${maintenance.status === 'scheduled' ? 'bg-warning' : 
                                             maintenance.status === 'completed' ? 'bg-success' : 
                                             maintenance.status === 'cancelled' ? 'bg-danger' : 'bg-info'}">
                                ${maintenance.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewMaintenanceDetails('${maintenance.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editMaintenance('${maintenance.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    maintenanceTableBody.appendChild(row);
                }
            });
        }

        // View maintenance details (placeholder)
        function viewMaintenanceDetails(maintenanceId) {
            alert(`View maintenance details functionality for ID: ${maintenanceId} would be implemented here.`);
        }

        // Edit maintenance (placeholder)
        function editMaintenance(maintenanceId) {
            alert(`Edit maintenance functionality for ID: ${maintenanceId} would be implemented here.`);
        }

        // Record payment
        function recordPayment(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('paymentInvoiceCode').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const date = document.getElementById('paymentDate').value;
            const method = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('paymentNotes').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            if (!rental) {
                alert('Rental with this invoice code not found!');
                return;
            }
            
            // Create payment record
            const payment = {
                id: generateId(),
                invoiceCode,
                amount,
                date,
                method,
                notes,
                createdDate: new Date().toISOString()
            };
            
            systemData.payments.push(payment);
            
            // Save data
            saveData();
            
            // Reload lists
            loadPaymentHistory();
            
            // Reset form
            document.getElementById('paymentForm').reset();
            initializeDateFields();
            
            alert('Payment recorded successfully!');
        }

        // Load payment history
        function loadPaymentHistory() {
            const paymentTableBody = document.getElementById('paymentTableBody');
            paymentTableBody.innerHTML = '';
            
            systemData.payments.forEach(payment => {
                const rental = systemData.rentals.find(r => r.invoiceCode === payment.invoiceCode);
                const customer = rental ? systemData.customers.find(c => c.id === rental.customerId) : null;
                
                if (rental && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${payment.invoiceCode}</td>
                        <td>${customer.fullName}</td>
                        <td>${payment.amount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>${formatDate(payment.date)}</td>
                        <td>${payment.method}</td>
                        <td>${payment.notes}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewPaymentDetails('${payment.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    paymentTableBody.appendChild(row);
                }
            });
        }

        // View payment details (placeholder)
        function viewPaymentDetails(paymentId) {
            alert(`View payment details functionality for ID: ${paymentId} would be implemented here.`);
        }

        // Add fine
        function addFine(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('fineInvoiceCode').value;
            const type = document.getElementById('fineType').value;
            const amount = parseFloat(document.getElementById('fineAmount').value);
            const date = document.getElementById('fineDate').value;
            const description = document.getElementById('fineDescription').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            if (!rental) {
                alert('Rental with this invoice code not found!');
                return;
            }
            
            // Create fine record
            const fine = {
                id: generateId(),
                invoiceCode,
                type,
                amount,
                date,
                description,
                status: 'unpaid',
                createdDate: new Date().toISOString()
            };
            
            systemData.fines.push(fine);
            
            // Save data
            saveData();
            
            // Reload lists
            loadFineHistory();
            
            // Reset form
            document.getElementById('fineForm').reset();
            initializeDateFields();
            
            alert('Fine/tax added successfully!');
        }

        // Load fine history
        function loadFineHistory() {
            const fineTableBody = document.getElementById('fineTableBody');
            fineTableBody.innerHTML = '';
            
            systemData.fines.forEach(fine => {
                const rental = systemData.rentals.find(r => r.invoiceCode === fine.invoiceCode);
                const customer = rental ? systemData.customers.find(c => c.id === rental.customerId) : null;
                
                if (rental && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${fine.invoiceCode}</td>
                        <td>${customer.fullName}</td>
                        <td>${fine.type.replace('_', ' ').toUpperCase()}</td>
                        <td>${fine.amount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>${formatDate(fine.date)}</td>
                        <td>${fine.description}</td>
                        <td>
                            <span class="badge ${fine.status === 'paid' ? 'bg-success' : 'bg-danger'}">
                                ${fine.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewFineDetails('${fine.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editFine('${fine.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    fineTableBody.appendChild(row);
                }
            });
        }

        // View fine details (placeholder)
        function viewFineDetails(fineId) {
            alert(`View fine details functionality for ID: ${fineId} would be implemented here.`);
        }

        // Edit fine (placeholder)
        function editFine(fineId) {
            alert(`Edit fine functionality for ID: ${fineId} would be implemented here.`);
        }

        // Generate report
        function generateReport(e) {
            e.preventDefault();
            
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!reportType) {
                alert('Please select a report type!');
                return;
            }
            
            let reportData = '';
            
            switch (reportType) {
                case 'rental':
                    reportData = generateRentalReport(startDate, endDate);
                    break;
                case 'financial':
                    reportData = generateFinancialReport(startDate, endDate);
                    break;
                case 'vehicle':
                    reportData = generateVehicleReport(startDate, endDate);
                    break;
                case 'customer':
                    reportData = generateCustomerReport(startDate, endDate);
                    break;
                case 'maintenance':
                    reportData = generateMaintenanceReport(startDate, endDate);
                    break;
            }
            
            document.getElementById('reportResults').innerHTML = reportData;
        }

        // Generate rental report
        function generateRentalReport(startDate, endDate) {
            const filteredRentals = systemData.rentals.filter(r => 
                r.startDate >= startDate && r.startDate <= endDate
            );
            
            let totalRevenue = 0;
            let html = `
                <h4>Rental Report (${formatDate(startDate)} to ${formatDate(endDate)})</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Invoice Code</th>
                                <th>Customer</th>
                                <th>Vehicle</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredRentals.forEach(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                
                if (vehicle && customer) {
                    totalRevenue += rental.totalAmount;
                    
                    html += `
                        <tr>
                            <td>${rental.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${vehicle.name}</td>
                            <td>${formatDate(rental.startDate)}</td>
                            <td>${formatDate(rental.endDate)}</td>
                            <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                            <td>${rental.status}</td>
                        </tr>
                    `;
                }
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <h5>Summary</h5>
                    <p><strong>Total Rentals:</strong> ${filteredRentals.length}</p>
                    <p><strong>Total Revenue:</strong> ${totalRevenue} <span class="currency-badge">${systemData.settings.currency}</span></p>
                </div>
            `;
            
            return html;
        }

        // Generate financial report (placeholder)
        function generateFinancialReport(startDate, endDate) {
            return `<h4>Financial Report (${formatDate(startDate)} to ${formatDate(endDate)})</h4>
                    <p>Financial report functionality would be implemented here.</p>`;
        }

        // Generate vehicle report (placeholder)
        function generateVehicleReport(startDate, endDate) {
            return `<h4>Vehicle Report (${formatDate(startDate)} to ${formatDate(endDate)})</h4>
                    <p>Vehicle report functionality would be implemented here.</p>`;
        }

        // Generate customer report (placeholder)
        function generateCustomerReport(startDate, endDate) {
            return `<h4>Customer Report (${formatDate(startDate)} to ${formatDate(endDate)})</h4>
                    <p>Customer report functionality would be implemented here.</p>`;
        }

        // Generate maintenance report (placeholder)
        function generateMaintenanceReport(startDate, endDate) {
            return `<h4>Maintenance Report (${formatDate(startDate)} to ${formatDate(endDate)})</h4>
                    <p>Maintenance report functionality would be implemented here.</p>`;
        }

        // Export report (placeholder)
        function exportReport() {
            alert('Export to Excel functionality would be implemented here.');
        }

        // Save settings
        function saveSettings(e) {
            e.preventDefault();
            
            const systemName = document.getElementById('systemName').value;
            const currency = document.getElementById('currency').value;
            const dateFormat = document.getElementById('dateFormat').value;
            
            // Update settings
            systemData.settings.systemName = systemName;
            systemData.settings.currency = currency;
            systemData.settings.dateFormat = dateFormat;
            
            // Handle logo upload
            const logoInput = document.getElementById('systemLogo');
            if (logoInput.files.length > 0) {
                const file = logoInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemData.settings.logo = e.target.result;
                    saveData();
                    applySettings();
                    alert('Settings saved successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                saveData();
                applySettings();
                alert('Settings saved successfully!');
            }
        }

        // Apply settings
        function applySettings() {
            // Update system name
            document.getElementById('headerSystemName').textContent = systemData.settings.systemName;
            document.getElementById('sidebarSystemName').textContent = systemData.settings.systemName;
            document.getElementById('printSystemName').textContent = systemData.settings.systemName;
            
            // Update currency badges
            document.querySelectorAll('.currency-badge').forEach(badge => {
                badge.textContent = systemData.settings.currency;
            });
            
            // Update logo if exists
            if (systemData.settings.logo) {
                document.getElementById('headerLogo').src = systemData.settings.logo;
                document.getElementById('headerLogo').style.display = 'inline';
                document.getElementById('sidebarLogo').src = systemData.settings.logo;
                document.getElementById('sidebarLogo').style.display = 'block';
                document.getElementById('printLogo').src = systemData.settings.logo;
                document.getElementById('printLogo').style.display = 'inline';
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            // Update statistics
            const totalVehicles = systemData.vehicles.length;
            const availableVehicles = systemData.vehicles.filter(v => v.status === 'available').length;
            const rentedVehicles = systemData.vehicles.filter(v => v.status === 'rented').length;
            const totalCustomers = systemData.customers.length;
            const activeRentals = systemData.rentals.filter(r => r.status === 'active').length;
            const totalRevenue = systemData.rentals.reduce((sum, rental) => sum + rental.totalAmount, 0);
            
            document.getElementById('dashboardStats').innerHTML = `
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-primary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalVehicles}</h4>
                                    <p>Total Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-success">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${availableVehicles}</h4>
                                    <p>Available Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-warning">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${rentedVehicles}</h4>
                                    <p>Rented Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-road fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-info">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalCustomers}</h4>
                                    <p>Total Customers</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-danger">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${activeRentals}</h4>
                                    <p>Active Rentals</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-clipboard-list fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card text-white bg-secondary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalRevenue}</h4>
                                    <p>Total Revenue</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load recent rentals
            const recentRentals = systemData.rentals
                .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate))
                .slice(0, 5);
            
            const recentRentalsTable = document.getElementById('recentRentalsTable');
            recentRentalsTable.innerHTML = '';
            
            recentRentals.forEach(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                
                if (vehicle && customer) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${customer.fullName}</td>
                        <td>${vehicle.name}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${rental.totalAmount} <span class="currency-badge">${systemData.settings.currency}</span></td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-success' : 
                                             rental.status === 'completed' ? 'bg-info' : 
                                             rental.status === 'cancelled' ? 'bg-danger' : 'bg-warning'}">
                                ${rental.status}
                            </span>
                        </td>
                    `;
                    recentRentalsTable.appendChild(row);
                }
            });
            
            // Load vehicle status chart
            loadVehicleStatusChart();
        }

        // Load vehicle status chart
        function loadVehicleStatusChart() {
            const ctx = document.getElementById('vehicleStatusChart').getContext('2d');
            
            const available = systemData.vehicles.filter(v => v.status === 'available').length;
            const rented = systemData.vehicles.filter(v => v.status === 'rented').length;
            const maintenance = systemData.vehicles.filter(v => v.status === 'maintenance').length;
            const other = systemData.vehicles.filter(v => !['available', 'rented', 'maintenance'].includes(v.status)).length;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented', 'Maintenance', 'Other'],
                    datasets: [{
                        data: [available, rented, maintenance, other],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#17a2b8',
                            '#6c757d'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Setup auto-suggestions
        function setupAutoSuggestions() {
            // Color suggestions
            const colors = ['Red', 'Blue', 'Green', 'Black', 'White', 'Silver', 'Gray', 'Yellow', 'Orange', 'Purple', 'Brown'];
            setupSuggestionField('vehicleColor', 'colorSuggestions', colors);
            
            // Model suggestions
            const models = ['2020', '2021', '2022', '2023', '2024'];
            setupSuggestionField('vehicleModel', 'modelSuggestions', models);
            
            // Customer suggestions
            setupCustomerSuggestions();
            
            // Vehicle suggestions
            setupVehicleSuggestions();
            
            // Nationality suggestions
            const nationalities = ['United Arab Emirates', 'Saudi Arabia', 'Kuwait', 'Qatar', 'Oman', 'Bahrain', 'Egypt', 'Jordan', 'Lebanon', 'Syria', 'Yemen', 'India', 'Pakistan', 'Bangladesh', 'Philippines', 'United States', 'United Kingdom', 'Canada', 'Australia', 'France', 'Germany', 'Italy', 'Spain', 'China', 'Japan', 'South Korea'];
            setupSuggestionField('customerNationality', 'nationalitySuggestions', nationalities);
            
            // Invoice suggestions for returns
            setupInvoiceSuggestions('returnInvoiceCode', 'invoiceSuggestions');
            
            // Invoice suggestions for payments
            setupInvoiceSuggestions('paymentInvoiceCode', 'paymentInvoiceSuggestions');
            
            // Invoice suggestions for fines
            setupInvoiceSuggestions('fineInvoiceCode', 'fineInvoiceSuggestions');
            
            // Vehicle suggestions for maintenance
            setupVehicleSuggestions('maintenanceVehicle', 'maintenanceVehicleSuggestions');
        }

        // Setup suggestion field
        function setupSuggestionField(inputId, suggestionId, suggestions) {
            const input = document.getElementById(inputId);
            const suggestionList = document.getElementById(suggestionId);
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                suggestionList.innerHTML = '';
                
                if (value) {
                    const filtered = suggestions.filter(s => s.toLowerCase().includes(value));
                    
                    if (filtered.length > 0) {
                        filtered.forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = item;
                            div.addEventListener('click', function() {
                                input.value = item;
                                suggestionList.style.display = 'none';
                            });
                            suggestionList.appendChild(div);
                        });
                        suggestionList.style.display = 'block';
                    } else {
                        suggestionList.style.display = 'none';
                    }
                } else {
                    suggestionList.style.display = 'none';
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    suggestionList.style.display = 'none';
                }
            });
        }

        // Setup customer suggestions
        function setupCustomerSuggestions() {
            const input = document.getElementById('rentalCustomer');
            const suggestionList = document.getElementById('customerSuggestions');
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                suggestionList.innerHTML = '';
                
                if (value) {
                    const filtered = systemData.customers.filter(c => 
                        c.fullName.toLowerCase().includes(value) || 
                        c.idNumber.includes(value)
                    );
                    
                    if (filtered.length > 0) {
                        filtered.forEach(customer => {
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = `${customer.fullName} (${customer.idNumber})`;
                            div.addEventListener('click', function() {
                                input.value = customer.fullName;
                                suggestionList.style.display = 'none';
                            });
                            suggestionList.appendChild(div);
                        });
                        suggestionList.style.display = 'block';
                    } else {
                        suggestionList.style.display = 'none';
                    }
                } else {
                    suggestionList.style.display = 'none';
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    suggestionList.style.display = 'none';
                }
            });
        }

        // Setup vehicle suggestions
        function setupVehicleSuggestions(inputId = 'rentalVehicle', suggestionId = 'vehicleSuggestions') {
            const input = document.getElementById(inputId);
            const suggestionList = document.getElementById(suggestionId);
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                suggestionList.innerHTML = '';
                
                if (value) {
                    const filtered = systemData.vehicles.filter(v => 
                        v.name.toLowerCase().includes(value) || 
                        v.plate.toLowerCase().includes(value)
                    );
                    
                    if (filtered.length > 0) {
                        filtered.forEach(vehicle => {
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = `${vehicle.name} (${vehicle.plate}) - ${vehicle.status}`;
                            div.addEventListener('click', function() {
                                input.value = vehicle.name;
                                suggestionList.style.display = 'none';
                                
                                // If this is the rental vehicle field, set the rental amount
                                if (inputId === 'rentalVehicle') {
                                    document.getElementById('rentalAmount').value = vehicle.rentalPrice;
                                }
                            });
                            suggestionList.appendChild(div);
                        });
                        suggestionList.style.display = 'block';
                    } else {
                        suggestionList.style.display = 'none';
                    }
                } else {
                    suggestionList.style.display = 'none';
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    suggestionList.style.display = 'none';
                }
            });
        }

        // Setup invoice suggestions
        function setupInvoiceSuggestions(inputId, suggestionId) {
            const input = document.getElementById(inputId);
            const suggestionList = document.getElementById(suggestionId);
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                suggestionList.innerHTML = '';
                
                if (value) {
                    const filtered = systemData.rentals.filter(r => 
                        r.invoiceCode.toLowerCase().includes(value)
                    );
                    
                    if (filtered.length > 0) {
                        filtered.forEach(rental => {
                            const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                            const customer = systemData.customers.find(c => c.id === rental.customerId);
                            
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = `${rental.invoiceCode} - ${customer ? customer.fullName : 'Unknown'} - ${vehicle ? vehicle.name : 'Unknown'}`;
                            div.addEventListener('click', function() {
                                input.value = rental.invoiceCode;
                                suggestionList.style.display = 'none';
                            });
                            suggestionList.appendChild(div);
                        });
                        suggestionList.style.display = 'block';
                    } else {
                        suggestionList.style.display = 'none';
                    }
                } else {
                    suggestionList.style.display = 'none';
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    suggestionList.style.display = 'none';
                }
            });
        }

        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Generate invoice code
        function generateInvoiceCode() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `INV-${year}${month}${day}-${random}`;
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }

        // Generate invoice
        function generateInvoice(rental, customer, vehicle) {
            // Update print invoice content
            document.getElementById('printInvoiceCode').textContent = rental.invoiceCode;
            document.getElementById('printInvoiceDate').textContent = formatDate(new Date().toISOString());
            document.getElementById('printCustomerName').textContent = customer.fullName;
            document.getElementById('printVehicleName').textContent = vehicle.name;
            document.getElementById('printCustomerId').textContent = customer.idNumber;
            document.getElementById('printCustomerAddress').textContent = customer.address;
            document.getElementById('printRentalAmount').textContent = `${rental.dailyRate} ${systemData.settings.currency} per day`;
            document.getElementById('printRentalDays').textContent = rental.rentalDays;
            document.getElementById('printTotalAmount').textContent = `${rental.totalAmount} ${systemData.settings.currency}`;
            
            // Generate rental history for print
            const rentalHistory = `
                <div>Start Date: ${formatDate(rental.startDate)}</div>
                <div>End Date: ${formatDate(rental.endDate)}</div>
                <div>Days: ${rental.rentalDays}</div>
                <div>Daily Rate: ${rental.dailyRate} ${systemData.settings.currency}</div>
                <div>Total Amount: ${rental.totalAmount} ${systemData.settings.currency}</div>
                ${rental.advancePayment > 0 ? `<div>Advance Payment: ${rental.advancePayment} ${systemData.settings.currency}</div>` : ''}
            `;
            document.getElementById('printRentalHistory').innerHTML = rentalHistory;
            
            // Show print dialog
            printInvoice(rental.invoiceCode);
        }

        // Print invoice
        function printInvoice(invoiceCode) {
            // Show print section
            document.getElementById('invoicePrint').style.display = 'block';
            
            // Print
            window.print();
            
            // Hide print section after printing
            setTimeout(() => {
                document.getElementById('invoicePrint').style.display = 'none';
            }, 500);
        }
    </script>
</body>
</html>