<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* هەمان ستایلەکان... */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: calc(100vh - 56px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table-responsive {
            border-radius: 5px;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .copyright {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .vehicle-details, .customer-details {
            display: none;
            margin-top: 20px;
        }
        
        .suggestion-list {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .status-returned {
            background-color: #d4edda;
        }
        
        .status-not-returned {
            background-color: #f8d7da;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .invoice-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-logo img {
            max-width: 200px;
            height: auto;
        }
        
        .custom-logo {
            max-height: 50px;
            margin-right: 10px;
        }
        
        .currency-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .user-only {
            display: none;
        }
        
        .system-logo-large {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
        }
        
        .signature-area {
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .maintenance-status {
            background-color: #fff3cd;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .vehicle-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .customer-form-container {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .form-section {
            margin-bottom: 20px;
        }
        
        .debt-summary {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .permission-item {
            margin-bottom: 10px;
        }
        
        .advanced-search {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .permission-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-4">
            <i class="fas fa-car fa-3x text-primary mb-3"></i>
            <h2>Car Rental System</h2>
            <p class="text-muted">Please login to continue</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        <div class="text-center mt-3">
            <small class="text-muted">Default admin password: 000000</small>
        </div>
        <div class="text-center mt-4">
            <small class="text-muted">Created by Farzad Programmer - Not Editable</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img id="headerLogo" src="" class="custom-logo" style="display: none;">
                    <span id="headerSystemName">Car Rental System</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <span id="currentUser">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key"></i> Change Password</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#userManagementModal"><i class="fas fa-users"></i> User Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar d-none d-md-block no-print">
                    <div class="logo-container">
                        <img id="sidebarLogo" src="" class="system-logo-large" style="display: none;">
                        <span class="system-name" id="sidebarSystemName">RentalSys</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item dashboard-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item vehicles-item">
                            <a class="nav-link" href="#vehicles" data-bs-toggle="tab">
                                <i class="fas fa-car"></i> Vehicles
                            </a>
                        </li>
                        <li class="nav-item rentals-customers-item">
                            <a class="nav-link" href="#rentals-customers" data-bs-toggle="tab">
                                <i class="fas fa-users"></i> Rentals & Customers
                            </a>
                        </li>
                        <li class="nav-item returns-item">
                            <a class="nav-link" href="#returns" data-bs-toggle="tab">
                                <i class="fas fa-undo"></i> Vehicle Returns
                            </a>
                        </li>
                        <li class="nav-item maintenance-item">
                            <a class="nav-link" href="#maintenance" data-bs-toggle="tab">
                                <i class="fas fa-tools"></i> Vehicle Maintenance
                            </a>
                        </li>
                        <li class="nav-item payments-item">
                            <a class="nav-link" href="#payments" data-bs-toggle="tab">
                                <i class="fas fa-money-bill-wave"></i> Payments
                            </a>
                        </li>
                        <li class="nav-item fines-item">
                            <a class="nav-link" href="#fines" data-bs-toggle="tab">
                                <i class="fas fa-gavel"></i> Fines & Taxes
                            </a>
                        </li>
                        <li class="nav-item reports-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">
                                <i class="fas fa-chart-bar"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item admin-only settings-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cogs"></i> System Settings
                            </a>
                        </li>
                    </ul>
                    <div class="copyright">
                        Created by Farzad Programmer<br>Not Editable
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 ms-sm-auto col-lg-10 px-4">
                    <div class="tab-content mt-4">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard</h2>
                            <div class="row" id="dashboardStats">
                                <!-- Dashboard statistics will be loaded here -->
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Recent Rentals
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentRentalsTable">
                                                        <!-- Recent rentals will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Vehicle Status
                                        </div>
                                        <div class="card-body">
                                            <canvas id="vehicleStatusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicles Tab -->
                        <div class="tab-pane fade" id="vehicles">
                            <h2 class="mb-4">Vehicle Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addVehicle">Add Vehicle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleList">Vehicle List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleHistory">Vehicle History</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addVehicle">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Vehicle
                                        </div>
                                        <div class="card-body">
                                            <form id="addVehicleForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleName" class="form-label">Vehicle Name</label>
                                                        <input type="text" class="form-control" id="vehicleName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleOdometer" class="form-label">Odometer</label>
                                                        <input type="number" class="form-control" id="vehicleOdometer" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleVin" class="form-label">VIN #</label>
                                                        <input type="text" class="form-control" id="vehicleVin" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehiclePlate" class="form-label">Plate Number</label>
                                                        <input type="text" class="form-control" id="vehiclePlate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleColor" class="form-label">Color</label>
                                                        <input type="text" class="form-control" id="vehicleColor" placeholder="Type color..." required>
                                                        <div class="suggestion-list" id="colorSuggestions"></div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleModel" class="form-label">Model</label>
                                                        <input type="text" class="form-control" id="vehicleModel" placeholder="Type model year..." required>
                                                        <div class="suggestion-list" id="modelSuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleRentalPrice" class="form-label">Rental Price (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="vehicleRentalPrice" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleImage" class="form-label">Vehicle Image</label>
                                                        <input type="file" class="form-control" id="vehicleImage" accept="image/*">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Vehicle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicles...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Name</th>
                                                            <th>Model</th>
                                                            <th>Color</th>
                                                            <th>Plate #</th>
                                                            <th>Odometer</th>
                                                            <th>Rental Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleTableBody">
                                                        <!-- Vehicle data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle Details Section -->
                                    <div class="card vehicle-details" id="vehicleDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeVehicleDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="vehicleDetailsContent">
                                            <!-- Vehicle details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleHistory">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleHistorySearch" placeholder="Search by vehicle name...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleHistorySearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Vehicle</th>
                                                            <th>Customer</th>
                                                            <th>Rental Date</th>
                                                            <th>Return Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleHistoryTableBody">
                                                        <!-- Vehicle history will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals & Customers Tab -->
                        <div class="tab-pane fade" id="rentals-customers">
                            <h2 class="mb-4">Rentals & Customers Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#rentalCar">Rent a Car</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#customerList">Customer List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#rentalList">Rental List</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="rentalCar">
                                    <div class="card">
                                        <div class="card-header">
                                            Rent a Car
                                        </div>
                                        <div class="card-body">
                                            <form id="createRentalForm">
                                                <div class="form-section">
                                                    <h5>Customer Information</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalCustomer" class="form-label">Customer</label>
                                                            <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer or add new...">
                                                            <div class="suggestion-list" id="customerSuggestions"></div>
                                                            <div class="form-text">If customer doesn't exist, you can add them below</div>
                                                        </div>
                                                        <div class="col-md-6 mb-3 d-flex align-items-end">
                                                            <button type="button" class="btn btn-outline-primary" id="toggleCustomerForm">
                                                                <i class="fas fa-user-plus"></i> Add New Customer
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- New Customer Form (Initially Hidden) -->
                                                    <div class="customer-form-container" id="newCustomerForm">
                                                        <h6>Add New Customer</h6>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerFullName" class="form-label">Full Name *</label>
                                                                <input type="text" class="form-control" id="customerFullName">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerAge" class="form-label">Age *</label>
                                                                <input type="number" class="form-control" id="customerAge">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerId" class="form-label">PS/ID *</label>
                                                                <input type="text" class="form-control" id="customerId">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerNationality" class="form-label">Nationality *</label>
                                                                <input type="text" class="form-control" id="customerNationality" placeholder="Type country name...">
                                                                <div class="suggestion-list" id="nationalitySuggestions"></div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerContact" class="form-label">Contact Number *</label>
                                                                <input type="text" class="form-control" id="customerContact">
                                                            </div>
                                                            <div class="col-md-6 mb-3">
                                                                <label for="customerAddress" class="form-label">Address *</label>
                                                                <input type="text" class="form-control" id="customerAddress">
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="guaranteeDoc" class="form-label">Guarantee / Document</label>
                                                            <input type="file" class="form-control" id="guaranteeDoc">
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="form-section">
                                                    <h5>Vehicle Information</h5>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalVehicle" class="form-label">Vehicle</label>
                                                            <input type="text" class="form-control" id="rentalVehicle" placeholder="Search vehicle...">
                                                            <div class="suggestion-list" id="vehicleSuggestions"></div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalAmount" class="form-label">Rental Amount (per day)</label>
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" id="rentalAmount" required>
                                                                <span class="input-group-text">AED</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalDays" class="form-label">Rental Days</label>
                                                            <input type="number" class="form-control" id="rentalDays" required>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="invoiceCode" class="form-label">Invoice Code</label>
                                                            <input type="text" class="form-control" id="invoiceCode">
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalStartDate" class="form-label">Rental Start Date</label>
                                                            <input type="date" class="form-control" id="rentalStartDate" required>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="rentalEndDate" class="form-label">Rental End Date</label>
                                                            <input type="date" class="form-control" id="rentalEndDate" required>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="advancePayment" class="form-label">Advance Payment (Optional)</label>
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" id="advancePayment" value="0">
                                                                <span class="input-group-text">AED</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary">Create Rental</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="customerList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                                                <button class="btn btn-outline-secondary" type="button" id="customerSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Full Name</th>
                                                            <th>Age</th>
                                                            <th>ID</th>
                                                            <th>Nationality</th>
                                                            <th>Contact</th>
                                                            <th>Total Debt</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customerTableBody">
                                                        <!-- Customer data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Details Section -->
                                    <div class="card customer-details" id="customerDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeCustomerDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="customerDetailsContent">
                                            <!-- Customer details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="rentalList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="rentalSearch" placeholder="Search by invoice code...">
                                                <button class="btn btn-outline-secondary" type="button" id="rentalSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Invoice Code</th>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Start Date</th>
                                                            <th>End Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rentalTableBody">
                                                        <!-- Rental data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Invoice for Printing -->
                            <div id="invoicePrint" class="print-only" style="display: none;">
                                <div class="invoice-logo">
                                    <img id="printLogo" src="" style="max-width: 200px; display: none;">
                                    <h3 id="printSystemName">Car Rental System</h3>
                                </div>
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h3>Car Rental Invoice</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Invoice Code:</strong> <span id="printInvoiceCode"></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Date:</strong> <span id="printInvoiceDate"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer:</strong> <span id="printCustomerName"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Vehicle:</strong> <span id="printVehicleName"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer ID:</strong> <span id="printCustomerId"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Customer Address:</strong> <span id="printCustomerAddress"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Amount (per day):</strong> <span id="printRentalAmount"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Days:</strong> <span id="printRentalDays"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental History:</strong>
                                                <div id="printRentalHistory"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <hr>
                                                <h4 class="text-end">Total: <span id="printTotalAmount"></span></h4>
                                            </div>
                                        </div>
                                        <div class="row signature-area">
                                            <div class="col-6">
                                                <strong>Customer Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Company Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Returns Tab -->
                        <div class="tab-pane fade" id="returns">
                            <h2 class="mb-4">Vehicle Returns</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Return Vehicle
                                </div>
                                <div class="card-body">
                                    <form id="returnVehicleForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="returnInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="returnInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="invoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="returnOdometer" class="form-label">Odometer Reading at Return</label>
                                                <input type="number" class="form-control" id="returnOdometer" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="returnDate" class="form-label">Return Date</label>
                                                <input type="date" class="form-control" id="returnDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="returnCondition" class="form-label">Vehicle Condition</label>
                                                <select class="form-select" id="returnCondition" required>
                                                    <option value="">Select condition...</option>
                                                    <option value="excellent">Excellent</option>
                                                    <option value="good">Good</option>
                                                    <option value="fair">Fair</option>
                                                    <option value="poor">Poor</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="returnNotes" class="form-label">Notes (Optional)</label>
                                                <textarea class="form-control" id="returnNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Process Return</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Return History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Condition</th>
                                                    <th>Odometer</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnHistoryTableBody">
                                                <!-- Return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Maintenance Tab -->
                        <div class="tab-pane fade" id="maintenance">
                            <h2 class="mb-4">Vehicle Maintenance</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Schedule Maintenance
                                </div>
                                <div class="card-body">
                                    <form id="maintenanceForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="maintenanceVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="maintenanceVehicleSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceType" class="form-label">Maintenance Type</label>
                                                <select class="form-select" id="maintenanceType" required>
                                                    <option value="">Select type...</option>
                                                    <option value="oil_change">Oil Change</option>
                                                    <option value="tire_rotation">Tire Rotation</option>
                                                    <option value="brake_service">Brake Service</option>
                                                    <option value="engine_check">Engine Check</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceDate" class="form-label">Maintenance Date</label>
                                                <input type="date" class="form-control" id="maintenanceDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceCost" class="form-label">Cost</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="maintenanceCost" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="maintenanceDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="maintenanceDescription" rows="3" required></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Schedule Maintenance</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Maintenance History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Maintenance Type</th>
                                                    <th>Date</th>
                                                    <th>Cost</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="maintenanceHistoryTableBody">
                                                <!-- Maintenance history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payments Tab -->
                        <div class="tab-pane fade" id="payments">
                            <h2 class="mb-4">Payment Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Record Payment
                                </div>
                                <div class="card-body">
                                    <form id="paymentForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="paymentInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="paymentInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentAmount" class="form-label">Payment Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="paymentAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentDate" class="form-label">Payment Date</label>
                                                <input type="date" class="form-control" id="paymentDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                                <select class="form-select" id="paymentMethod" required>
                                                    <option value="">Select method...</option>
                                                    <option value="cash">Cash</option>
                                                    <option value="credit_card">Credit Card</option>
                                                    <option value="bank_transfer">Bank Transfer</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="paymentNotes" class="form-label">Notes (Optional)</label>
                                                <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Record Payment</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Payment History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Method</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentHistoryTableBody">
                                                <!-- Payment history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fines & Taxes Tab -->
                        <div class="tab-pane fade" id="fines">
                            <h2 class="mb-4">Fines & Taxes Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Add Fine/Tax
                                </div>
                                <div class="card-body">
                                    <form id="fineForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineInvoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="fineInvoiceCode" placeholder="Enter invoice code...">
                                                <div class="suggestion-list" id="fineInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineType" class="form-label">Fine/Tax Type</label>
                                                <select class="form-select" id="fineType" required>
                                                    <option value="">Select type...</option>
                                                    <option value="traffic_fine">Traffic Fine</option>
                                                    <option value="late_return">Late Return</option>
                                                    <option value="damage">Damage</option>
                                                    <option value="tax">Tax</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="fineAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="fineDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="fineDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="fineDescription" rows="3" required></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Fine/Tax</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Fines & Taxes History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fineHistoryTableBody">
                                                <!-- Fine history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div class="tab-pane fade" id="reports">
                            <h2 class="mb-4">Reports</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Generate Report
                                </div>
                                <div class="card-body">
                                    <form id="reportForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="reportType" class="form-label">Report Type</label>
                                                <select class="form-select" id="reportType" required>
                                                    <option value="">Select report type...</option>
                                                    <option value="rental_report">Rental Report</option>
                                                    <option value="payment_report">Payment Report</option>
                                                    <option value="maintenance_report">Maintenance Report</option>
                                                    <option value="fine_report">Fine Report</option>
                                                    <option value="vehicle_report">Vehicle Report</option>
                                                    <option value="customer_report">Customer Report</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="reportPeriod" class="form-label">Period</label>
                                                <select class="form-select" id="reportPeriod" required>
                                                    <option value="">Select period...</option>
                                                    <option value="today">Today</option>
                                                    <option value="this_week">This Week</option>
                                                    <option value="this_month">This Month</option>
                                                    <option value="this_year">This Year</option>
                                                    <option value="custom">Custom</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row" id="customDateRange" style="display: none;">
                                            <div class="col-md-6 mb-3">
                                                <label for="reportStartDate" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="reportStartDate">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="reportEndDate" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="reportEndDate">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Generate Report</button>
                                        <button type="button" class="btn btn-success" id="exportReportBtn">
                                            <i class="fas fa-file-excel"></i> Export to Excel
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Report Results
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="reportTable">
                                            <thead>
                                                <tr>
                                                    <!-- Table headers will be populated based on report type -->
                                                </tr>
                                            </thead>
                                            <tbody id="reportTableBody">
                                                <!-- Report data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Settings Tab -->
                        <div class="tab-pane fade" id="settings">
                            <h2 class="mb-4">System Settings</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    General Settings
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName" value="Car Rental System">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="systemCurrency" class="form-label">Currency</label>
                                                <select class="form-select" id="systemCurrency">
                                                    <option value="AED">AED (United Arab Emirates Dirham)</option>
                                                    <option value="USD">USD (US Dollar)</option>
                                                    <option value="EUR">EUR (Euro)</option>
                                                    <option value="GBP">GBP (British Pound)</option>
                                                    <option value="SAR">SAR (Saudi Riyal)</option>
                                                    <option value="QAR">QAR (Qatari Riyal)</option>
                                                    <option value="KWD">KWD (Kuwaiti Dinar)</option>
                                                    <option value="BHD">BHD (Bahraini Dinar)</option>
                                                    <option value="OMR">OMR (Omani Rial)</option>
                                                    <option value="CAD">CAD (Canadian Dollar)</option>
                                                    <option value="AUD">AUD (Australian Dollar)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="systemLogo" class="form-label">System Logo</label>
                                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="dateFormat" class="form-label">Date Format</label>
                                                <select class="form-select" id="dateFormat">
                                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    User Management
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Username</th>
                                                    <th>Role</th>
                                                    <th>Last Login</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="userTableBody">
                                                <!-- User data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                        <i class="fas fa-user-plus"></i> Add New User
                                    </button>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Permissions Management
                                </div>
                                <div class="card-body">
                                    <div class="permission-section">
                                        <h5>User Permissions</h5>
                                        <p>Control what users can do in the system</p>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionEdit" checked>
                                                        <label class="form-check-label" for="permissionEdit">Allow users to edit data</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionDelete" checked>
                                                        <label class="form-check-label" for="permissionDelete">Allow users to delete data</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionVehicles" checked>
                                                        <label class="form-check-label" for="permissionVehicles">Allow access to Vehicles section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionRentals" checked>
                                                        <label class="form-check-label" for="permissionRentals">Allow access to Rentals & Customers section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionReturns" checked>
                                                        <label class="form-check-label" for="permissionReturns">Allow access to Vehicle Returns section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionMaintenance" checked>
                                                        <label class="form-check-label" for="permissionMaintenance">Allow access to Vehicle Maintenance section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionPayments" checked>
                                                        <label class="form-check-label" for="permissionPayments">Allow access to Payments section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionFines" checked>
                                                        <label class="form-check-label" for="permissionFines">Allow access to Fines & Taxes section</label>
                                                    </div>
                                                </div>
                                                <div class="permission-item">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="permissionReports" checked>
                                                        <label class="form-check-label" for="permissionReports">Allow access to Reports section</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <button type="button" class="btn btn-primary mt-3" id="savePermissionsBtn">
                                            Save Permissions
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade" id="userManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Last Login</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userManagementTableBody">
                                <!-- User management data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">Add New User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserRole" class="form-label">Role</label>
                            <select class="form-select" id="newUserRole" required>
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // System Data and State
        let systemData = {
            users: [
                { username: "admin", password: "000000", role: "admin", lastLogin: null },
                { username: "user", password: "123456", role: "user", lastLogin: null }
            ],
            vehicles: [],
            customers: [],
            rentals: [],
            returns: [],
            maintenance: [],
            payments: [],
            fines: [],
            settings: {
                systemName: "Car Rental System",
                currency: "AED",
                dateFormat: "dd/mm/yyyy",
                logo: null
            },
            permissions: {
                edit: true,
                delete: true,
                vehicles: true,
                rentals: true,
                returns: true,
                maintenance: true,
                payments: true,
                fines: true,
                reports: true
            },
            currentUser: null,
            colors: ["Red", "Blue", "Black", "White", "Silver", "Gray", "Green", "Yellow", "Orange", "Brown"],
            models: ["2023", "2022", "2021", "2020", "2019", "2018", "2017", "2016", "2015", "2014"],
            nationalities: ["United Arab Emirates", "Saudi Arabia", "Oman", "Qatar", "Kuwait", "Bahrain", "Egypt", "Jordan", "Lebanon", "Syria", "India", "Pakistan", "Bangladesh", "Philippines", "United States", "United Kingdom", "Canada", "Australia", "France", "Germany"]
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                systemData.currentUser = JSON.parse(savedUser);
                showMainApp();
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize date fields with today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('rentalStartDate').value = today;
            document.getElementById('rentalEndDate').value = today;
            document.getElementById('returnDate').value = today;
            document.getElementById('maintenanceDate').value = today;
            document.getElementById('paymentDate').value = today;
            document.getElementById('fineDate').value = today;
        });

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('carRentalData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                systemData = { ...systemData, ...parsedData };
            }
            
            // Apply settings
            applySettings();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('carRentalData', JSON.stringify(systemData));
        }

        // Apply system settings
        function applySettings() {
            document.getElementById('systemName').value = systemData.settings.systemName;
            document.getElementById('systemCurrency').value = systemData.settings.currency;
            document.getElementById('dateFormat').value = systemData.settings.dateFormat;
            
            document.getElementById('headerSystemName').textContent = systemData.settings.systemName;
            document.getElementById('sidebarSystemName').textContent = systemData.settings.systemName;
            
            // Apply permissions
            document.getElementById('permissionEdit').checked = systemData.permissions.edit;
            document.getElementById('permissionDelete').checked = systemData.permissions.delete;
            document.getElementById('permissionVehicles').checked = systemData.permissions.vehicles;
            document.getElementById('permissionRentals').checked = systemData.permissions.rentals;
            document.getElementById('permissionReturns').checked = systemData.permissions.returns;
            document.getElementById('permissionMaintenance').checked = systemData.permissions.maintenance;
            document.getElementById('permissionPayments').checked = systemData.permissions.payments;
            document.getElementById('permissionFines').checked = systemData.permissions.fines;
            document.getElementById('permissionReports').checked = systemData.permissions.reports;
            
            // Apply permissions to UI based on user role
            applyPermissions();
        }

        // Apply permissions based on user role
        function applyPermissions() {
            const isAdmin = systemData.currentUser && systemData.currentUser.role === 'admin';
            const isUser = systemData.currentUser && systemData.currentUser.role === 'user';
            
            // Show/hide admin-only elements
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => {
                el.style.display = isAdmin ? 'block' : 'none';
            });
            
            // Apply permission settings for users
            if (isUser) {
                // Edit permission
                const editButtons = document.querySelectorAll('.btn-warning, .edit-btn');
                editButtons.forEach(btn => {
                    btn.style.display = systemData.permissions.edit ? 'inline-block' : 'none';
                });
                
                // Delete permission
                const deleteButtons = document.querySelectorAll('.btn-danger, .delete-btn');
                deleteButtons.forEach(btn => {
                    btn.style.display = systemData.permissions.delete ? 'inline-block' : 'none';
                });
                
                // Section permissions
                document.querySelector('.vehicles-item').style.display = systemData.permissions.vehicles ? 'block' : 'none';
                document.querySelector('.rentals-customers-item').style.display = systemData.permissions.rentals ? 'block' : 'none';
                document.querySelector('.returns-item').style.display = systemData.permissions.returns ? 'block' : 'none';
                document.querySelector('.maintenance-item').style.display = systemData.permissions.maintenance ? 'block' : 'none';
                document.querySelector('.payments-item').style.display = systemData.permissions.payments ? 'block' : 'none';
                document.querySelector('.fines-item').style.display = systemData.permissions.fines ? 'block' : 'none';
                document.querySelector('.reports-item').style.display = systemData.permissions.reports ? 'block' : 'none';
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Change password form
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            
            // Add user form
            document.getElementById('addUserForm').addEventListener('submit', handleAddUser);
            
            // Save permissions button
            document.getElementById('savePermissionsBtn').addEventListener('click', handleSavePermissions);
            
            // General settings form
            document.getElementById('generalSettingsForm').addEventListener('submit', handleSaveGeneralSettings);
            
            // Add vehicle form
            document.getElementById('addVehicleForm').addEventListener('submit', handleAddVehicle);
            
            // Create rental form
            document.getElementById('createRentalForm').addEventListener('submit', handleCreateRental);
            
            // Return vehicle form
            document.getElementById('returnVehicleForm').addEventListener('submit', handleReturnVehicle);
            
            // Maintenance form
            document.getElementById('maintenanceForm').addEventListener('submit', handleMaintenance);
            
            // Payment form
            document.getElementById('paymentForm').addEventListener('submit', handlePayment);
            
            // Fine form
            document.getElementById('fineForm').addEventListener('submit', handleFine);
            
            // Report form
            document.getElementById('reportForm').addEventListener('submit', handleGenerateReport);
            
            // Export report button
            document.getElementById('exportReportBtn').addEventListener('click', handleExportReport);
            
            // Toggle customer form
            document.getElementById('toggleCustomerForm').addEventListener('click', function() {
                const form = document.getElementById('newCustomerForm');
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close vehicle details
            document.getElementById('closeVehicleDetails').addEventListener('click', function() {
                document.getElementById('vehicleDetailsCard').style.display = 'none';
            });
            
            // Close customer details
            document.getElementById('closeCustomerDetails').addEventListener('click', function() {
                document.getElementById('customerDetailsCard').style.display = 'none';
            });
            
            // Search functionality
            document.getElementById('vehicleSearchBtn').addEventListener('click', searchVehicles);
            document.getElementById('vehicleSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') searchVehicles();
            });
            
            document.getElementById('customerSearchBtn').addEventListener('click', searchCustomers);
            document.getElementById('customerSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') searchCustomers();
            });
            
            document.getElementById('rentalSearchBtn').addEventListener('click', searchRentals);
            document.getElementById('rentalSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') searchRentals();
            });
            
            // Suggestion functionality
            setupSuggestion('vehicleColor', 'colorSuggestions', systemData.colors);
            setupSuggestion('vehicleModel', 'modelSuggestions', systemData.models);
            setupSuggestion('customerNationality', 'nationalitySuggestions', systemData.nationalities);
            setupSuggestion('rentalCustomer', 'customerSuggestions', systemData.customers.map(c => c.fullName));
            setupSuggestion('rentalVehicle', 'vehicleSuggestions', systemData.vehicles.map(v => v.name));
            setupSuggestion('returnInvoiceCode', 'invoiceSuggestions', systemData.rentals.map(r => r.invoiceCode));
            setupSuggestion('maintenanceVehicle', 'maintenanceVehicleSuggestions', systemData.vehicles.map(v => v.name));
            setupSuggestion('paymentInvoiceCode', 'paymentInvoiceSuggestions', systemData.rentals.map(r => r.invoiceCode));
            setupSuggestion('fineInvoiceCode', 'fineInvoiceSuggestions', systemData.rentals.map(r => r.invoiceCode));
            
            // Report period change
            document.getElementById('reportPeriod').addEventListener('change', function() {
                document.getElementById('customDateRange').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            
            // Tab change events to refresh data
            document.querySelectorAll('a[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('href');
                    if (target === '#dashboard') refreshDashboard();
                    else if (target === '#vehicleList') refreshVehicleList();
                    else if (target === '#customerList') refreshCustomerList();
                    else if (target === '#rentalList') refreshRentalList();
                    else if (target === '#returns') refreshReturnHistory();
                    else if (target === '#maintenance') refreshMaintenanceHistory();
                    else if (target === '#payments') refreshPaymentHistory();
                    else if (target === '#fines') refreshFineHistory();
                    else if (target === '#settings') refreshUserTable();
                });
            });
        }

        // Setup suggestion functionality for input fields
        function setupSuggestion(inputId, suggestionId, suggestions) {
            const input = document.getElementById(inputId);
            const suggestionList = document.getElementById(suggestionId);
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = suggestions.filter(s => s.toLowerCase().includes(value));
                
                if (filtered.length > 0 && value) {
                    suggestionList.innerHTML = '';
                    filtered.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = item;
                        div.addEventListener('click', function() {
                            input.value = item;
                            suggestionList.style.display = 'none';
                        });
                        suggestionList.appendChild(div);
                    });
                    suggestionList.style.display = 'block';
                } else {
                    suggestionList.style.display = 'none';
                }
            });
            
            input.addEventListener('blur', function() {
                setTimeout(() => {
                    suggestionList.style.display = 'none';
                }, 200);
            });
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = systemData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // Update last login
                user.lastLogin = new Date().toISOString();
                saveData();
                
                systemData.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                showMainApp();
            } else {
                alert('Invalid username or password!');
            }
        }

        // Handle logout
        function handleLogout() {
            systemData.currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('loginForm').reset();
        }

        // Show main application
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUser').textContent = systemData.currentUser.username;
            
            // Apply permissions based on user role
            applyPermissions();
            
            // Refresh dashboard
            refreshDashboard();
        }

        // Handle change password
        function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            if (systemData.currentUser.password !== currentPassword) {
                alert('Current password is incorrect!');
                return;
            }
            
            systemData.currentUser.password = newPassword;
            saveData();
            
            alert('Password changed successfully!');
            document.getElementById('changePasswordModal').querySelector('.btn-close').click();
            document.getElementById('changePasswordForm').reset();
        }

        // Handle add user
        function handleAddUser(e) {
            e.preventDefault();
            
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            
            // Check if username already exists
            if (systemData.users.find(u => u.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            // Add new user
            systemData.users.push({
                username,
                password,
                role,
                lastLogin: null
            });
            
            saveData();
            refreshUserTable();
            
            alert('User added successfully!');
            document.getElementById('addUserModal').querySelector('.btn-close').click();
            document.getElementById('addUserForm').reset();
        }

        // Handle save permissions
        function handleSavePermissions() {
            systemData.permissions.edit = document.getElementById('permissionEdit').checked;
            systemData.permissions.delete = document.getElementById('permissionDelete').checked;
            systemData.permissions.vehicles = document.getElementById('permissionVehicles').checked;
            systemData.permissions.rentals = document.getElementById('permissionRentals').checked;
            systemData.permissions.returns = document.getElementById('permissionReturns').checked;
            systemData.permissions.maintenance = document.getElementById('permissionMaintenance').checked;
            systemData.permissions.payments = document.getElementById('permissionPayments').checked;
            systemData.permissions.fines = document.getElementById('permissionFines').checked;
            systemData.permissions.reports = document.getElementById('permissionReports').checked;
            
            saveData();
            applyPermissions();
            
            alert('Permissions saved successfully!');
        }

        // Handle save general settings
        function handleSaveGeneralSettings(e) {
            e.preventDefault();
            
            systemData.settings.systemName = document.getElementById('systemName').value;
            systemData.settings.currency = document.getElementById('systemCurrency').value;
            systemData.settings.dateFormat = document.getElementById('dateFormat').value;
            
            // Handle logo upload
            const logoFile = document.getElementById('systemLogo').files[0];
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemData.settings.logo = e.target.result;
                    saveData();
                    applySettings();
                };
                reader.readAsDataURL(logoFile);
            } else {
                saveData();
                applySettings();
            }
            
            alert('Settings saved successfully!');
        }

        // Handle add vehicle
        function handleAddVehicle(e) {
            e.preventDefault();
            
            const name = document.getElementById('vehicleName').value;
            const odometer = parseInt(document.getElementById('vehicleOdometer').value);
            const vin = document.getElementById('vehicleVin').value;
            const plate = document.getElementById('vehiclePlate').value;
            const color = document.getElementById('vehicleColor').value;
            const model = document.getElementById('vehicleModel').value;
            const rentalPrice = parseFloat(document.getElementById('vehicleRentalPrice').value);
            
            // Add to colors and models if new
            if (!systemData.colors.includes(color)) {
                systemData.colors.push(color);
            }
            if (!systemData.models.includes(model)) {
                systemData.models.push(model);
            }
            
            // Handle image upload
            const imageFile = document.getElementById('vehicleImage').files[0];
            let imageData = null;
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    
                    // Add vehicle with image
                    addVehicleToSystem(name, odometer, vin, plate, color, model, rentalPrice, imageData);
                };
                reader.readAsDataURL(imageFile);
            } else {
                // Add vehicle without image
                addVehicleToSystem(name, odometer, vin, plate, color, model, rentalPrice, null);
            }
        }

        // Add vehicle to system
        function addVehicleToSystem(name, odometer, vin, plate, color, model, rentalPrice, image) {
            const newVehicle = {
                id: generateId(),
                name,
                odometer,
                vin,
                plate,
                color,
                model,
                rentalPrice,
                image,
                status: 'available',
                created: new Date().toISOString()
            };
            
            systemData.vehicles.push(newVehicle);
            saveData();
            
            alert('Vehicle added successfully!');
            document.getElementById('addVehicleForm').reset();
            
            // Refresh vehicle list if visible
            if (document.getElementById('vehicleList').classList.contains('show')) {
                refreshVehicleList();
            }
        }

        // Handle create rental
        function handleCreateRental(e) {
            e.preventDefault();
            
            // Get customer info
            const customerName = document.getElementById('rentalCustomer').value;
            let customer = systemData.customers.find(c => c.fullName === customerName);
            
            // If customer doesn't exist, check if we have new customer form data
            if (!customer) {
                const newCustomerForm = document.getElementById('newCustomerForm');
                if (newCustomerForm.style.display === 'block') {
                    // Create new customer
                    customer = {
                        id: generateId(),
                        fullName: document.getElementById('customerFullName').value,
                        age: parseInt(document.getElementById('customerAge').value),
                        idNumber: document.getElementById('customerId').value,
                        nationality: document.getElementById('customerNationality').value,
                        contact: document.getElementById('customerContact').value,
                        address: document.getElementById('customerAddress').value,
                        guaranteeDoc: null, // Would handle file upload in a real app
                        created: new Date().toISOString()
                    };
                    
                    // Add to nationalities if new
                    if (!systemData.nationalities.includes(customer.nationality)) {
                        systemData.nationalities.push(customer.nationality);
                    }
                    
                    systemData.customers.push(customer);
                } else {
                    alert('Please select an existing customer or add a new one!');
                    return;
                }
            }
            
            // Get vehicle info
            const vehicleName = document.getElementById('rentalVehicle').value;
            const vehicle = systemData.vehicles.find(v => v.name === vehicleName);
            
            if (!vehicle) {
                alert('Please select a valid vehicle!');
                return;
            }
            
            // Check if vehicle is available
            if (vehicle.status !== 'available') {
                alert('Selected vehicle is not available for rental!');
                return;
            }
            
            // Get rental details
            const rentalAmount = parseFloat(document.getElementById('rentalAmount').value);
            const rentalDays = parseInt(document.getElementById('rentalDays').value);
            const invoiceCode = document.getElementById('invoiceCode').value || generateInvoiceCode();
            const startDate = document.getElementById('rentalStartDate').value;
            const endDate = document.getElementById('rentalEndDate').value;
            const advancePayment = parseFloat(document.getElementById('advancePayment').value) || 0;
            
            // Create rental
            const newRental = {
                id: generateId(),
                invoiceCode,
                customerId: customer.id,
                vehicleId: vehicle.id,
                rentalAmount,
                rentalDays,
                startDate,
                endDate,
                advancePayment,
                totalAmount: rentalAmount * rentalDays,
                remainingAmount: (rentalAmount * rentalDays) - advancePayment,
                status: 'active',
                created: new Date().toISOString()
            };
            
            systemData.rentals.push(newRental);
            
            // Update vehicle status
            vehicle.status = 'rented';
            
            saveData();
            
            alert('Rental created successfully!');
            document.getElementById('createRentalForm').reset();
            
            // Reset dates to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('rentalStartDate').value = today;
            document.getElementById('rentalEndDate').value = today;
            
            // Print invoice
            printInvoice(newRental, customer, vehicle);
        }

        // Handle return vehicle
        function handleReturnVehicle(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('returnInvoiceCode').value;
            const odometer = parseInt(document.getElementById('returnOdometer').value);
            const returnDate = document.getElementById('returnDate').value;
            const condition = document.getElementById('returnCondition').value;
            const notes = document.getElementById('returnNotes').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!rental) {
                alert('Rental not found with the provided invoice code!');
                return;
            }
            
            if (rental.status === 'returned') {
                alert('This vehicle has already been returned!');
                return;
            }
            
            // Find vehicle
            const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            // Create return record
            const returnRecord = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                vehicleId: vehicle.id,
                customerId: rental.customerId,
                returnDate,
                odometer,
                condition,
                notes,
                created: new Date().toISOString()
            };
            
            systemData.returns.push(returnRecord);
            
            // Update rental status
            rental.status = 'returned';
            
            // Update vehicle status and odometer
            vehicle.status = 'available';
            vehicle.odometer = odometer;
            
            saveData();
            
            alert('Vehicle returned successfully!');
            document.getElementById('returnVehicleForm').reset();
            
            // Refresh return history if visible
            if (document.getElementById('returns').classList.contains('show')) {
                refreshReturnHistory();
            }
        }

        // Handle maintenance
        function handleMaintenance(e) {
            e.preventDefault();
            
            const vehicleName = document.getElementById('maintenanceVehicle').value;
            const type = document.getElementById('maintenanceType').value;
            const date = document.getElementById('maintenanceDate').value;
            const cost = parseFloat(document.getElementById('maintenanceCost').value);
            const description = document.getElementById('maintenanceDescription').value;
            
            // Find vehicle
            const vehicle = systemData.vehicles.find(v => v.name === vehicleName);
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            // Create maintenance record
            const maintenanceRecord = {
                id: generateId(),
                vehicleId: vehicle.id,
                type,
                date,
                cost,
                description,
                status: 'completed',
                created: new Date().toISOString()
            };
            
            systemData.maintenance.push(maintenanceRecord);
            saveData();
            
            alert('Maintenance record added successfully!');
            document.getElementById('maintenanceForm').reset();
            
            // Refresh maintenance history if visible
            if (document.getElementById('maintenance').classList.contains('show')) {
                refreshMaintenanceHistory();
            }
        }

        // Handle payment
        function handlePayment(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('paymentInvoiceCode').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const date = document.getElementById('paymentDate').value;
            const method = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('paymentNotes').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!rental) {
                alert('Rental not found with the provided invoice code!');
                return;
            }
            
            // Create payment record
            const paymentRecord = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                amount,
                date,
                method,
                notes,
                created: new Date().toISOString()
            };
            
            systemData.payments.push(paymentRecord);
            
            // Update rental remaining amount
            rental.remainingAmount -= amount;
            if (rental.remainingAmount < 0) rental.remainingAmount = 0;
            
            saveData();
            
            alert('Payment recorded successfully!');
            document.getElementById('paymentForm').reset();
            
            // Refresh payment history if visible
            if (document.getElementById('payments').classList.contains('show')) {
                refreshPaymentHistory();
            }
        }

        // Handle fine
        function handleFine(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('fineInvoiceCode').value;
            const type = document.getElementById('fineType').value;
            const amount = parseFloat(document.getElementById('fineAmount').value);
            const date = document.getElementById('fineDate').value;
            const description = document.getElementById('fineDescription').value;
            
            // Find rental
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!rental) {
                alert('Rental not found with the provided invoice code!');
                return;
            }
            
            // Create fine record
            const fineRecord = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                type,
                amount,
                date,
                description,
                status: 'unpaid',
                created: new Date().toISOString()
            };
            
            systemData.fines.push(fineRecord);
            saveData();
            
            alert('Fine/Tax added successfully!');
            document.getElementById('fineForm').reset();
            
            // Refresh fine history if visible
            if (document.getElementById('fines').classList.contains('show')) {
                refreshFineHistory();
            }
        }

        // Handle generate report
        function handleGenerateReport(e) {
            e.preventDefault();
            
            const reportType = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            
            let startDate, endDate;
            
            // Calculate date range based on period
            const today = new Date();
            switch(period) {
                case 'today':
                    startDate = today.toISOString().split('T')[0];
                    endDate = startDate;
                    break;
                case 'this_week':
                    const firstDay = new Date(today.setDate(today.getDate() - today.getDay()));
                    startDate = firstDay.toISOString().split('T')[0];
                    endDate = new Date().toISOString().split('T')[0];
                    break;
                case 'this_month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
                    endDate = new Date().toISOString().split('T')[0];
                    break;
                case 'this_year':
                    startDate = new Date(today.getFullYear(), 0, 1).toISOString().split('T')[0];
                    endDate = new Date().toISOString().split('T')[0];
                    break;
                case 'custom':
                    startDate = document.getElementById('reportStartDate').value;
                    endDate = document.getElementById('reportEndDate').value;
                    break;
                default:
                    alert('Please select a valid period!');
                    return;
            }
            
            // Generate report based on type
            generateReport(reportType, startDate, endDate);
        }

        // Handle export report
        function handleExportReport() {
            // In a real application, this would export the report data to Excel
            // For this demo, we'll just show an alert
            alert('Export to Excel functionality would be implemented here!');
        }

        // Generate report
        function generateReport(type, startDate, endDate) {
            const tableHead = document.querySelector('#reportTable thead');
            const tableBody = document.querySelector('#reportTable tbody');
            
            // Clear previous data
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';
            
            let headers = [];
            let data = [];
            
            switch(type) {
                case 'rental_report':
                    headers = ['Invoice Code', 'Customer', 'Vehicle', 'Start Date', 'End Date', 'Amount', 'Status'];
                    data = systemData.rentals
                        .filter(r => r.startDate >= startDate && r.startDate <= endDate)
                        .map(r => {
                            const customer = systemData.customers.find(c => c.id === r.customerId);
                            const vehicle = systemData.vehicles.find(v => v.id === r.vehicleId);
                            return [
                                r.invoiceCode,
                                customer ? customer.fullName : 'Unknown',
                                vehicle ? vehicle.name : 'Unknown',
                                formatDate(r.startDate),
                                formatDate(r.endDate),
                                formatCurrency(r.totalAmount),
                                r.status
                            ];
                        });
                    break;
                    
                case 'payment_report':
                    headers = ['Invoice Code', 'Customer', 'Amount', 'Date', 'Method', 'Notes'];
                    data = systemData.payments
                        .filter(p => p.date >= startDate && p.date <= endDate)
                        .map(p => {
                            const customer = systemData.customers.find(c => c.id === p.customerId);
                            return [
                                p.invoiceCode,
                                customer ? customer.fullName : 'Unknown',
                                formatCurrency(p.amount),
                                formatDate(p.date),
                                p.method,
                                p.notes || '-'
                            ];
                        });
                    break;
                    
                case 'maintenance_report':
                    headers = ['Vehicle', 'Type', 'Date', 'Cost', 'Description', 'Status'];
                    data = systemData.maintenance
                        .filter(m => m.date >= startDate && m.date <= endDate)
                        .map(m => {
                            const vehicle = systemData.vehicles.find(v => v.id === m.vehicleId);
                            return [
                                vehicle ? vehicle.name : 'Unknown',
                                m.type,
                                formatDate(m.date),
                                formatCurrency(m.cost),
                                m.description,
                                m.status
                            ];
                        });
                    break;
                    
                case 'fine_report':
                    headers = ['Invoice Code', 'Customer', 'Type', 'Amount', 'Date', 'Description', 'Status'];
                    data = systemData.fines
                        .filter(f => f.date >= startDate && f.date <= endDate)
                        .map(f => {
                            const customer = systemData.customers.find(c => c.id === f.customerId);
                            return [
                                f.invoiceCode,
                                customer ? customer.fullName : 'Unknown',
                                f.type,
                                formatCurrency(f.amount),
                                formatDate(f.date),
                                f.description,
                                f.status
                            ];
                        });
                    break;
                    
                case 'vehicle_report':
                    headers = ['Name', 'Model', 'Color', 'Plate', 'Odometer', 'Rental Price', 'Status'];
                    data = systemData.vehicles.map(v => [
                        v.name,
                        v.model,
                        v.color,
                        v.plate,
                        v.odometer,
                        formatCurrency(v.rentalPrice),
                        v.status
                    ]);
                    break;
                    
                case 'customer_report':
                    headers = ['Full Name', 'Age', 'ID', 'Nationality', 'Contact', 'Total Rentals', 'Total Spent'];
                    data = systemData.customers.map(c => {
                        const customerRentals = systemData.rentals.filter(r => r.customerId === c.id);
                        const totalSpent = customerRentals.reduce((sum, r) => sum + r.totalAmount, 0);
                        return [
                            c.fullName,
                            c.age,
                            c.idNumber,
                            c.nationality,
                            c.contact,
                            customerRentals.length,
                            formatCurrency(totalSpent)
                        ];
                    });
                    break;
                    
                default:
                    alert('Please select a valid report type!');
                    return;
            }
            
            // Create table headers
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);
            
            // Create table rows
            data.forEach(rowData => {
                const row = document.createElement('tr');
                rowData.forEach(cellData => {
                    const td = document.createElement('td');
                    td.textContent = cellData;
                    row.appendChild(td);
                });
                tableBody.appendChild(row);
            });
            
            // Show report count
            alert(`Report generated: ${data.length} records found for the selected period.`);
        }

        // Print invoice
        function printInvoice(rental, customer, vehicle) {
            // Populate invoice data
            document.getElementById('printInvoiceCode').textContent = rental.invoiceCode;
            document.getElementById('printInvoiceDate').textContent = formatDate(new Date().toISOString().split('T')[0]);
            document.getElementById('printCustomerName').textContent = customer.fullName;
            document.getElementById('printVehicleName').textContent = vehicle.name;
            document.getElementById('printCustomerId').textContent = customer.idNumber;
            document.getElementById('printCustomerAddress').textContent = customer.address;
            document.getElementById('printRentalAmount').textContent = formatCurrency(rental.rentalAmount);
            document.getElementById('printRentalDays').textContent = rental.rentalDays;
            document.getElementById('printTotalAmount').textContent = formatCurrency(rental.totalAmount);
            
            // Set system name and logo for printing
            document.getElementById('printSystemName').textContent = systemData.settings.systemName;
            if (systemData.settings.logo) {
                document.getElementById('printLogo').src = systemData.settings.logo;
                document.getElementById('printLogo').style.display = 'inline';
            }
            
            // Show rental history
            const rentalHistory = document.getElementById('printRentalHistory');
            rentalHistory.innerHTML = `
                <div>Start Date: ${formatDate(rental.startDate)}</div>
                <div>End Date: ${formatDate(rental.endDate)}</div>
                <div>Advance Payment: ${formatCurrency(rental.advancePayment)}</div>
                <div>Remaining Amount: ${formatCurrency(rental.remainingAmount)}</div>
            `;
            
            // Print the invoice
            window.print();
        }

        // Refresh dashboard
        function refreshDashboard() {
            // Calculate statistics
            const totalVehicles = systemData.vehicles.length;
            const availableVehicles = systemData.vehicles.filter(v => v.status === 'available').length;
            const rentedVehicles = systemData.vehicles.filter(v => v.status === 'rented').length;
            const totalCustomers = systemData.customers.length;
            const activeRentals = systemData.rentals.filter(r => r.status === 'active').length;
            const totalRevenue = systemData.rentals.reduce((sum, r) => sum + r.totalAmount, 0);
            
            // Update dashboard stats
            const statsHTML = `
                <div class="col-md-3">
                    <div class="card dashboard-card text-white bg-primary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalVehicles}</h4>
                                    <p>Total Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card text-white bg-success">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${availableVehicles}</h4>
                                    <p>Available Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card text-white bg-warning">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${rentedVehicles}</h4>
                                    <p>Rented Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-road fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card text-white bg-info">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalCustomers}</h4>
                                    <p>Total Customers</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mt-3">
                    <div class="card dashboard-card text-white bg-danger">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${activeRentals}</h4>
                                    <p>Active Rentals</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-clipboard-list fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mt-3">
                    <div class="card dashboard-card text-white bg-secondary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${formatCurrency(totalRevenue)}</h4>
                                    <p>Total Revenue</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('dashboardStats').innerHTML = statsHTML;
            
            // Update recent rentals
            const recentRentals = systemData.rentals
                .sort((a, b) => new Date(b.created) - new Date(a.created))
                .slice(0, 5);
            
            let recentRentalsHTML = '';
            recentRentals.forEach(rental => {
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                
                recentRentalsHTML += `
                    <tr>
                        <td>${customer ? customer.fullName : 'Unknown'}</td>
                        <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatCurrency(rental.totalAmount)}</td>
                        <td><span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">${rental.status}</span></td>
                    </tr>
                `;
            });
            
            document.getElementById('recentRentalsTable').innerHTML = recentRentalsHTML;
            
            // Update vehicle status chart
            updateVehicleStatusChart(availableVehicles, rentedVehicles);
        }

        // Update vehicle status chart
        function updateVehicleStatusChart(available, rented) {
            const ctx = document.getElementById('vehicleStatusChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.vehicleStatusChart) {
                window.vehicleStatusChart.destroy();
            }
            
            window.vehicleStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented'],
                    datasets: [{
                        data: [available, rented],
                        backgroundColor: ['#28a745', '#ffc107'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Refresh vehicle list
        function refreshVehicleList() {
            const tableBody = document.getElementById('vehicleTableBody');
            let html = '';
            
            systemData.vehicles.forEach(vehicle => {
                html += `
                    <tr>
                        <td>
                            ${vehicle.image ? 
                                `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : 
                                '<i class="fas fa-car fa-2x text-muted"></i>'
                            }
                        </td>
                        <td>${vehicle.name}</td>
                        <td>${vehicle.model}</td>
                        <td>${vehicle.color}</td>
                        <td>${vehicle.plate}</td>
                        <td>${vehicle.odometer}</td>
                        <td>${formatCurrency(vehicle.rentalPrice)}</td>
                        <td>
                            <span class="badge ${vehicle.status === 'available' ? 'bg-success' : 'bg-warning'}">
                                ${vehicle.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    viewVehicleDetails(vehicleId);
                });
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    editVehicle(vehicleId);
                });
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    deleteVehicle(vehicleId);
                });
            });
        }

        // View vehicle details
        function viewVehicleDetails(vehicleId) {
            const vehicle = systemData.vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            const detailsContent = document.getElementById('vehicleDetailsContent');
            
            let html = `
                <div class="row">
                    <div class="col-md-4">
                        ${vehicle.image ? 
                            `<img src="${vehicle.image}" class="img-fluid" alt="${vehicle.name}">` : 
                            '<div class="text-center"><i class="fas fa-car fa-5x text-muted"></i></div>'
                        }
                    </div>
                    <div class="col-md-8">
                        <h4>${vehicle.name}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Model</th>
                                <td>${vehicle.model}</td>
                            </tr>
                            <tr>
                                <th>Color</th>
                                <td>${vehicle.color}</td>
                            </tr>
                            <tr>
                                <th>Plate Number</th>
                                <td>${vehicle.plate}</td>
                            </tr>
                            <tr>
                                <th>VIN #</th>
                                <td>${vehicle.vin}</td>
                            </tr>
                            <tr>
                                <th>Odometer</th>
                                <td>${vehicle.odometer}</td>
                            </tr>
                            <tr>
                                <th>Rental Price</th>
                                <td>${formatCurrency(vehicle.rentalPrice)}</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td>
                                    <span class="badge ${vehicle.status === 'available' ? 'bg-success' : 'bg-warning'}">
                                        ${vehicle.status}
                                    </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Invoice Code</th>
                                        <th>Customer</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            const vehicleRentals = systemData.rentals.filter(r => r.vehicleId === vehicleId);
            if (vehicleRentals.length > 0) {
                vehicleRentals.forEach(rental => {
                    const customer = systemData.customers.find(c => c.id === rental.customerId);
                    html += `
                        <tr>
                            <td>${rental.invoiceCode}</td>
                            <td>${customer ? customer.fullName : 'Unknown'}</td>
                            <td>${formatDate(rental.startDate)}</td>
                            <td>${formatDate(rental.endDate)}</td>
                            <td>${formatCurrency(rental.totalAmount)}</td>
                            <td>
                                <span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">
                                    ${rental.status}
                                </span>
                            </td>
                        </tr>
                    `;
                });
            } else {
                html += `<tr><td colspan="6" class="text-center">No rental history found</td></tr>`;
            }
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            detailsContent.innerHTML = html;
            document.getElementById('vehicleDetailsCard').style.display = 'block';
        }

        // Edit vehicle
        function editVehicle(vehicleId) {
            // In a real application, this would open a modal or form to edit the vehicle
            alert('Edit vehicle functionality would be implemented here!');
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                systemData.vehicles = systemData.vehicles.filter(v => v.id !== vehicleId);
                saveData();
                refreshVehicleList();
                alert('Vehicle deleted successfully!');
            }
        }

        // Refresh customer list
        function refreshCustomerList() {
            const tableBody = document.getElementById('customerTableBody');
            let html = '';
            
            systemData.customers.forEach(customer => {
                const customerRentals = systemData.rentals.filter(r => r.customerId === customer.id);
                const totalDebt = customerRentals.reduce((sum, r) => sum + r.remainingAmount, 0);
                
                html += `
                    <tr>
                        <td>${customer.fullName}</td>
                        <td>${customer.age}</td>
                        <td>${customer.idNumber}</td>
                        <td>${customer.nationality}</td>
                        <td>${customer.contact}</td>
                        <td>${formatCurrency(totalDebt)}</td>
                        <td>
                            <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    viewCustomerDetails(customerId);
                });
            });
            
            document.querySelectorAll('.edit-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });
            
            document.querySelectorAll('.delete-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }

        // View customer details
        function viewCustomerDetails(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const detailsContent = document.getElementById('customerDetailsContent');
            
            let html = `
                <div class="row">
                    <div class="col-md-6">
                        <h4>${customer.fullName}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Age</th>
                                <td>${customer.age}</td>
                            </tr>
                            <tr>
                                <th>ID Number</th>
                                <td>${customer.idNumber}</td>
                            </tr>
                            <tr>
                                <th>Nationality</th>
                                <td>${customer.nationality}</td>
                            </tr>
                            <tr>
                                <th>Contact</th>
                                <td>${customer.contact}</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td>${customer.address}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Invoice Code</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Remaining</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            const customerRentals = systemData.rentals.filter(r => r.customerId === customerId);
            if (customerRentals.length > 0) {
                customerRentals.forEach(rental => {
                    const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                    html += `
                        <tr>
                            <td>${rental.invoiceCode}</td>
                            <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                            <td>${formatDate(rental.startDate)}</td>
                            <td>${formatDate(rental.endDate)}</td>
                            <td>${formatCurrency(rental.totalAmount)}</td>
                            <td>${formatCurrency(rental.remainingAmount)}</td>
                            <td>
                                <span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">
                                    ${rental.status}
                                </span>
                            </td>
                        </tr>
                    `;
                });
            } else {
                html += `<tr><td colspan="7" class="text-center">No rental history found</td></tr>`;
            }
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            detailsContent.innerHTML = html;
            document.getElementById('customerDetailsCard').style.display = 'block';
        }

        // Edit customer
        function editCustomer(customerId) {
            // In a real application, this would open a modal or form to edit the customer
            alert('Edit customer functionality would be implemented here!');
        }

        // Delete customer
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                systemData.customers = systemData.customers.filter(c => c.id !== customerId);
                saveData();
                refreshCustomerList();
                alert('Customer deleted successfully!');
            }
        }

        // Refresh rental list
        function refreshRentalList() {
            const tableBody = document.getElementById('rentalTableBody');
            let html = '';
            
            systemData.rentals.forEach(rental => {
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                
                html += `
                    <tr>
                        <td>${rental.invoiceCode}</td>
                        <td>${customer ? customer.fullName : 'Unknown'}</td>
                        <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${formatCurrency(rental.totalAmount)}</td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">
                                ${rental.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info view-rental" data-id="${rental.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-rental" data-id="${rental.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-rental" data-id="${rental.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Refresh return history
        function refreshReturnHistory() {
            const tableBody = document.getElementById('returnHistoryTableBody');
            let html = '';
            
            systemData.returns.forEach(returnRecord => {
                const rental = systemData.rentals.find(r => r.id === returnRecord.rentalId);
                const customer = systemData.customers.find(c => c.id === returnRecord.customerId);
                const vehicle = systemData.vehicles.find(v => v.id === returnRecord.vehicleId);
                
                if (rental && customer && vehicle) {
                    html += `
                        <tr>
                            <td>${returnRecord.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${vehicle.name}</td>
                            <td>${formatDate(returnRecord.returnDate)}</td>
                            <td>${returnRecord.condition}</td>
                            <td>${returnRecord.odometer}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-return" data-id="${returnRecord.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${systemData.permissions.delete ? `
                                    <button class="btn btn-sm btn-danger delete-return" data-id="${returnRecord.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = html;
        }

        // Refresh maintenance history
        function refreshMaintenanceHistory() {
            const tableBody = document.getElementById('maintenanceHistoryTableBody');
            let html = '';
            
            systemData.maintenance.forEach(maintenance => {
                const vehicle = systemData.vehicles.find(v => v.id === maintenance.vehicleId);
                
                if (vehicle) {
                    html += `
                        <tr>
                            <td>${vehicle.name}</td>
                            <td>${maintenance.type}</td>
                            <td>${formatDate(maintenance.date)}</td>
                            <td>${formatCurrency(maintenance.cost)}</td>
                            <td>${maintenance.description}</td>
                            <td>
                                <span class="badge bg-success">${maintenance.status}</span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info view-maintenance" data-id="${maintenance.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${systemData.permissions.edit ? `
                                    <button class="btn btn-sm btn-warning edit-maintenance" data-id="${maintenance.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                ` : ''}
                                ${systemData.permissions.delete ? `
                                    <button class="btn btn-sm btn-danger delete-maintenance" data-id="${maintenance.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = html;
        }

        // Refresh payment history
        function refreshPaymentHistory() {
            const tableBody = document.getElementById('paymentHistoryTableBody');
            let html = '';
            
            systemData.payments.forEach(payment => {
                const customer = systemData.customers.find(c => c.id === payment.customerId);
                
                if (customer) {
                    html += `
                        <tr>
                            <td>${payment.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${formatCurrency(payment.amount)}</td>
                            <td>${formatDate(payment.date)}</td>
                            <td>${payment.method}</td>
                            <td>${payment.notes || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-payment" data-id="${payment.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${systemData.permissions.edit ? `
                                    <button class="btn btn-sm btn-warning edit-payment" data-id="${payment.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                ` : ''}
                                ${systemData.permissions.delete ? `
                                    <button class="btn btn-sm btn-danger delete-payment" data-id="${payment.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = html;
        }

        // Refresh fine history
        function refreshFineHistory() {
            const tableBody = document.getElementById('fineHistoryTableBody');
            let html = '';
            
            systemData.fines.forEach(fine => {
                const customer = systemData.customers.find(c => c.id === fine.customerId);
                
                if (customer) {
                    html += `
                        <tr>
                            <td>${fine.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${fine.type}</td>
                            <td>${formatCurrency(fine.amount)}</td>
                            <td>${formatDate(fine.date)}</td>
                            <td>${fine.description}</td>
                            <td>
                                <span class="badge ${fine.status === 'paid' ? 'bg-success' : 'bg-warning'}">
                                    ${fine.status}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info view-fine" data-id="${fine.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${systemData.permissions.edit ? `
                                    <button class="btn btn-sm btn-warning edit-fine" data-id="${fine.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                ` : ''}
                                ${systemData.permissions.delete ? `
                                    <button class="btn btn-sm btn-danger delete-fine" data-id="${fine.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            tableBody.innerHTML = html;
        }

        // Refresh user table
        function refreshUserTable() {
            const tableBody = document.getElementById('userTableBody');
            let html = '';
            
            systemData.users.forEach(user => {
                html += `
                    <tr>
                        <td>${user.username}</td>
                        <td>
                            <span class="badge ${user.role === 'admin' ? 'bg-danger' : 'bg-primary'}">
                                ${user.role}
                            </span>
                        </td>
                        <td>${user.lastLogin ? formatDate(user.lastLogin.split('T')[0]) : 'Never'}</td>
                        <td>
                            <span class="badge bg-success">Active</span>
                        </td>
                        <td>
                            ${user.username !== systemData.currentUser.username ? `
                                <button class="btn btn-sm btn-warning edit-user" data-username="${user.username}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-user" data-username="${user.username}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Also update user management modal table
            document.getElementById('userManagementTableBody').innerHTML = html;
        }

        // Search vehicles
        function searchVehicles() {
            const query = document.getElementById('vehicleSearch').value.toLowerCase();
            const filteredVehicles = systemData.vehicles.filter(v => 
                v.name.toLowerCase().includes(query) || 
                v.plate.toLowerCase().includes(query) ||
                v.model.toLowerCase().includes(query) ||
                v.color.toLowerCase().includes(query)
            );
            
            const tableBody = document.getElementById('vehicleTableBody');
            let html = '';
            
            filteredVehicles.forEach(vehicle => {
                html += `
                    <tr>
                        <td>
                            ${vehicle.image ? 
                                `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : 
                                '<i class="fas fa-car fa-2x text-muted"></i>'
                            }
                        </td>
                        <td>${vehicle.name}</td>
                        <td>${vehicle.model}</td>
                        <td>${vehicle.color}</td>
                        <td>${vehicle.plate}</td>
                        <td>${vehicle.odometer}</td>
                        <td>${formatCurrency(vehicle.rentalPrice)}</td>
                        <td>
                            <span class="badge ${vehicle.status === 'available' ? 'bg-success' : 'bg-warning'}">
                                ${vehicle.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Search customers
        function searchCustomers() {
            const query = document.getElementById('customerSearch').value.toLowerCase();
            const filteredCustomers = systemData.customers.filter(c => 
                c.fullName.toLowerCase().includes(query) || 
                c.idNumber.toLowerCase().includes(query) ||
                c.nationality.toLowerCase().includes(query) ||
                c.contact.toLowerCase().includes(query)
            );
            
            const tableBody = document.getElementById('customerTableBody');
            let html = '';
            
            filteredCustomers.forEach(customer => {
                const customerRentals = systemData.rentals.filter(r => r.customerId === customer.id);
                const totalDebt = customerRentals.reduce((sum, r) => sum + r.remainingAmount, 0);
                
                html += `
                    <tr>
                        <td>${customer.fullName}</td>
                        <td>${customer.age}</td>
                        <td>${customer.idNumber}</td>
                        <td>${customer.nationality}</td>
                        <td>${customer.contact}</td>
                        <td>${formatCurrency(totalDebt)}</td>
                        <td>
                            <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Search rentals
        function searchRentals() {
            const query = document.getElementById('rentalSearch').value.toLowerCase();
            const filteredRentals = systemData.rentals.filter(r => 
                r.invoiceCode.toLowerCase().includes(query)
            );
            
            const tableBody = document.getElementById('rentalTableBody');
            let html = '';
            
            filteredRentals.forEach(rental => {
                const customer = systemData.customers.find(c => c.id === rental.customerId);
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                
                html += `
                    <tr>
                        <td>${rental.invoiceCode}</td>
                        <td>${customer ? customer.fullName : 'Unknown'}</td>
                        <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                        <td>${formatDate(rental.startDate)}</td>
                        <td>${formatDate(rental.endDate)}</td>
                        <td>${formatCurrency(rental.totalAmount)}</td>
                        <td>
                            <span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">
                                ${rental.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info view-rental" data-id="${rental.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${systemData.permissions.edit ? `
                                <button class="btn btn-sm btn-warning edit-rental" data-id="${rental.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            ${systemData.permissions.delete ? `
                                <button class="btn btn-sm btn-danger delete-rental" data-id="${rental.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateInvoiceCode() {
            return 'INV-' + Date.now().toString(36).toUpperCase();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: systemData.settings.currency
            }).format(amount);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const format = systemData.settings.dateFormat;
            
            if (format === 'dd/mm/yyyy') {
                return date.toLocaleDateString('en-GB');
            } else if (format === 'mm/dd/yyyy') {
                return date.toLocaleDateString('en-US');
            } else {
                return date.toISOString().split('T')[0];
            }
        }
    </script>
</body>
</html>