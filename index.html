<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: calc(100vh - 56px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table-responsive {
            border-radius: 5px;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .copyright {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .vehicle-details, .customer-details {
            display: none;
            margin-top: 20px;
        }
        
        .suggestion-list {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .status-returned {
            background-color: #d4edda;
        }
        
        .status-not-returned {
            background-color: #f8d7da;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .invoice-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-logo img {
            max-width: 200px;
            height: auto;
        }
        
        .custom-logo {
            max-height: 50px;
            margin-right: 10px;
        }
        
        .currency-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .user-only {
            display: none;
        }
        
        .system-logo-large {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
        }
        
        .signature-area {
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .maintenance-status {
            background-color: #fff3cd;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .vehicle-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-4">
            <i class="fas fa-car fa-3x text-primary mb-3"></i>
            <h2>Car Rental System</h2>
            <p class="text-muted">Please login to continue</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        <div class="text-center mt-3">
            <small class="text-muted">Default admin password: 000000</small>
        </div>
        <div class="text-center mt-4">
            <small class="text-muted">Created by Farzad Programmer - Not Editable</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img id="headerLogo" src="" class="custom-logo" style="display: none;">
                    <span id="headerSystemName">Car Rental System</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <span id="currentUser">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key"></i> Change Password</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#userManagementModal"><i class="fas fa-users"></i> User Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar d-none d-md-block no-print">
                    <div class="logo-container">
                        <img id="sidebarLogo" src="" class="system-logo-large" style="display: none;">
                        <span class="system-name" id="sidebarSystemName">RentalSys</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item dashboard-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item vehicles-item">
                            <a class="nav-link" href="#vehicles" data-bs-toggle="tab">
                                <i class="fas fa-car"></i> Vehicles
                            </a>
                        </li>
                        <li class="nav-item rentals-customers-item">
                            <a class="nav-link" href="#rentals-customers" data-bs-toggle="tab">
                                <i class="fas fa-users"></i> Rentals & Customers
                            </a>
                        </li>
                        <li class="nav-item returns-item">
                            <a class="nav-link" href="#returns" data-bs-toggle="tab">
                                <i class="fas fa-undo"></i> Vehicle Returns
                            </a>
                        </li>
                        <li class="nav-item maintenance-item">
                            <a class="nav-link" href="#maintenance" data-bs-toggle="tab">
                                <i class="fas fa-tools"></i> Vehicle Maintenance
                            </a>
                        </li>
                        <li class="nav-item payments-item">
                            <a class="nav-link" href="#payments" data-bs-toggle="tab">
                                <i class="fas fa-money-bill-wave"></i> Payments
                            </a>
                        </li>
                        <li class="nav-item fines-item">
                            <a class="nav-link" href="#fines" data-bs-toggle="tab">
                                <i class="fas fa-gavel"></i> Fines & Taxes
                            </a>
                        </li>
                        <li class="nav-item reports-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">
                                <i class="fas fa-chart-bar"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item admin-only settings-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cogs"></i> System Settings
                            </a>
                        </li>
                    </ul>
                    <div class="copyright">
                        Created by Farzad Programmer<br>Not Editable
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 ms-sm-auto col-lg-10 px-4">
                    <div class="tab-content mt-4">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard</h2>
                            <div class="row" id="dashboardStats">
                                <!-- Dashboard statistics will be loaded here -->
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Recent Rentals
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentRentalsTable">
                                                        <!-- Recent rentals will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Vehicle Status
                                        </div>
                                        <div class="card-body">
                                            <canvas id="vehicleStatusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicles Tab -->
                        <div class="tab-pane fade" id="vehicles">
                            <h2 class="mb-4">Vehicle Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addVehicle">Add Vehicle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleList">Vehicle List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleHistory">Vehicle History</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addVehicle">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Vehicle
                                        </div>
                                        <div class="card-body">
                                            <form id="addVehicleForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleName" class="form-label">Vehicle Name</label>
                                                        <input type="text" class="form-control" id="vehicleName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleOdometer" class="form-label">Odometer</label>
                                                        <input type="number" class="form-control" id="vehicleOdometer" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleVin" class="form-label">VIN #</label>
                                                        <input type="text" class="form-control" id="vehicleVin" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehiclePlate" class="form-label">Plate Number</label>
                                                        <input type="text" class="form-control" id="vehiclePlate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleColor" class="form-label">Color</label>
                                                        <input type="text" class="form-control" id="vehicleColor" placeholder="Type color..." required>
                                                        <div class="suggestion-list" id="colorSuggestions"></div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleModel" class="form-label">Model</label>
                                                        <input type="text" class="form-control" id="vehicleModel" placeholder="Type model year..." required>
                                                        <div class="suggestion-list" id="modelSuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleRentalPrice" class="form-label">Rental Price (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="vehicleRentalPrice" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleImage" class="form-label">Vehicle Image</label>
                                                        <input type="file" class="form-control" id="vehicleImage" accept="image/*">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Vehicle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicles...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Name</th>
                                                            <th>Model</th>
                                                            <th>Color</th>
                                                            <th>Plate #</th>
                                                            <th>Odometer</th>
                                                            <th>Rental Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleTableBody">
                                                        <!-- Vehicle data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle Details Section -->
                                    <div class="card vehicle-details" id="vehicleDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeVehicleDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="vehicleDetailsContent">
                                            <!-- Vehicle details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleHistory">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleHistorySearch" placeholder="Search by vehicle name...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleHistorySearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Vehicle</th>
                                                            <th>Customer</th>
                                                            <th>Rental Date</th>
                                                            <th>Return Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleHistoryTableBody">
                                                        <!-- Vehicle history will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals & Customers Tab -->
                        <div class="tab-pane fade" id="rentals-customers">
                            <h2 class="mb-4">Rentals & Customers Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addCustomer">Add Customer</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#customerList">Customer List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#createRental">Create Rental</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#rentalList">Rental List</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addCustomer">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Customer
                                        </div>
                                        <div class="card-body">
                                            <form id="addCustomerForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerFullName" class="form-label">Full Name</label>
                                                        <input type="text" class="form-control" id="customerFullName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAge" class="form-label">Age</label>
                                                        <input type="number" class="form-control" id="customerAge" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerId" class="form-label">PS/ID</label>
                                                        <input type="text" class="form-control" id="customerId" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerNationality" class="form-label">Nationality</label>
                                                        <input type="text" class="form-control" id="customerNationality" placeholder="Type country name..." required>
                                                        <div class="suggestion-list" id="nationalitySuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerContact" class="form-label">Contact Number</label>
                                                        <input type="text" class="form-control" id="customerContact" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAddress" class="form-label">Address</label>
                                                        <input type="text" class="form-control" id="customerAddress" required>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="guaranteeDoc" class="form-label">Guarantee / Document</label>
                                                    <input type="file" class="form-control" id="guaranteeDoc">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Customer</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="customerList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                                                <button class="btn btn-outline-secondary" type="button" id="customerSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Full Name</th>
                                                            <th>Age</th>
                                                            <th>ID</th>
                                                            <th>Nationality</th>
                                                            <th>Contact</th>
                                                            <th>Total Debt</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customerTableBody">
                                                        <!-- Customer data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Details Section -->
                                    <div class="card customer-details" id="customerDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeCustomerDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="customerDetailsContent">
                                            <!-- Customer details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="createRental">
                                    <div class="card">
                                        <div class="card-header">
                                            Create New Rental
                                        </div>
                                        <div class="card-body">
                                            <form id="createRentalForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalCustomer" class="form-label">Customer</label>
                                                        <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer...">
                                                        <div class="suggestion-list" id="customerSuggestions"></div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalVehicle" class="form-label">Vehicle</label>
                                                        <input type="text" class="form-control" id="rentalVehicle" placeholder="Search vehicle...">
                                                        <div class="suggestion-list" id="vehicleSuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalAmount" class="form-label">Rental Amount (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="rentalAmount" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalDays" class="form-label">Rental Days</label>
                                                        <input type="number" class="form-control" id="rentalDays" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalStartDate" class="form-label">Rental Start Date</label>
                                                        <input type="date" class="form-control" id="rentalStartDate" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="rentalEndDate" class="form-label">Rental End Date</label>
                                                        <input type="date" class="form-control" id="rentalEndDate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="invoiceCode" class="form-label">Invoice Code</label>
                                                        <input type="text" class="form-control" id="invoiceCode">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Create Rental</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="rentalList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="rentalSearch" placeholder="Search by invoice code...">
                                                <button class="btn btn-outline-secondary" type="button" id="rentalSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Invoice Code</th>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Start Date</th>
                                                            <th>End Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rentalTableBody">
                                                        <!-- Rental data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Invoice for Printing -->
                            <div id="invoicePrint" class="print-only" style="display: none;">
                                <div class="invoice-logo">
                                    <img id="printLogo" src="" style="max-width: 200px; display: none;">
                                    <h3 id="printSystemName">Car Rental System</h3>
                                </div>
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h3>Car Rental Invoice</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Invoice Code:</strong> <span id="printInvoiceCode"></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Date:</strong> <span id="printInvoiceDate"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer:</strong> <span id="printCustomerName"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Vehicle:</strong> <span id="printVehicleName"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer ID:</strong> <span id="printCustomerId"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Customer Address:</strong> <span id="printCustomerAddress"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Amount (per day):</strong> <span id="printRentalAmount"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Days:</strong> <span id="printRentalDays"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental History:</strong>
                                                <div id="printRentalHistory"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <hr>
                                                <h4 class="text-end">Total: <span id="printTotalAmount"></span></h4>
                                            </div>
                                        </div>
                                        <div class="row signature-area">
                                            <div class="col-6">
                                                <strong>Customer Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Company Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Returns Tab -->
                        <div class="tab-pane fade" id="returns">
                            <h2 class="mb-4">Vehicle Returns</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Return Vehicle
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="returnInvoiceSearch" class="form-label">Search by Invoice Code</label>
                                            <input type="text" class="form-control" id="returnInvoiceSearch" placeholder="Search invoice code...">
                                            <div class="suggestion-list" id="returnInvoiceSuggestions"></div>
                                        </div>
                                        <div class="col-md-6 d-flex align-items-end">
                                            <button class="btn btn-primary me-2" id="searchInvoiceBtn">Search</button>
                                        </div>
                                    </div>
                                    <div id="returnFormContainer" style="display: none;">
                                        <form id="returnVehicleForm">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Customer</label>
                                                    <input type="text" class="form-control" id="returnCustomer" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Vehicle</label>
                                                    <input type="text" class="form-control" id="returnVehicle" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Start Date</label>
                                                    <input type="text" class="form-control" id="returnStartDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental End Date</label>
                                                    <input type="text" class="form-control" id="returnEndDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="returnOdometer" class="form-label">Odometer on Return</label>
                                                    <input type="number" class="form-control" id="returnOdometer" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnDate" class="form-label">Return Date</label>
                                                    <input type="date" class="form-control" id="returnDate" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="returnTime" class="form-label">Return Time</label>
                                                    <input type="time" class="form-control" id="returnTime" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnFuelLevel" class="form-label">Fuel Level on Return</label>
                                                    <select class="form-select" id="returnFuelLevel" required>
                                                        <option value="">Select fuel level</option>
                                                        <option value="Full">Full</option>
                                                        <option value="3/4">3/4</option>
                                                        <option value="1/2">1/2</option>
                                                        <option value="1/4">1/4</option>
                                                        <option value="Empty">Empty</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label for="returnNotes" class="form-label">Notes</label>
                                                    <textarea class="form-control" id="returnNotes" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="returnImages" class="form-label">Vehicle Images on Return</label>
                                                <input type="file" class="form-control" id="returnImages" accept="image/*" multiple>
                                            </div>
                                            <button type="submit" class="btn btn-success">Complete Return</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Return History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="returnHistorySearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="returnHistorySearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Odometer</th>
                                                    <th>Fuel Level</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnHistoryTableBody">
                                                <!-- Return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Maintenance Tab -->
                        <div class="tab-pane fade" id="maintenance">
                            <h2 class="mb-4">Vehicle Maintenance</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Schedule Maintenance
                                </div>
                                <div class="card-body">
                                    <form id="scheduleMaintenanceForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="maintenanceVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="maintenanceVehicleSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceType" class="form-label">Maintenance Type</label>
                                                <select class="form-select" id="maintenanceType" required>
                                                    <option value="">Select type</option>
                                                    <option value="Oil Change">Oil Change</option>
                                                    <option value="Tire Rotation">Tire Rotation</option>
                                                    <option value="Brake Service">Brake Service</option>
                                                    <option value="Engine Tune-up">Engine Tune-up</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceDate" class="form-label">Maintenance Date</label>
                                                <input type="date" class="form-control" id="maintenanceDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceCost" class="form-label">Cost</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="maintenanceCost" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="maintenanceDescription" class="form-label">Description</label>
                                            <textarea class="form-control" id="maintenanceDescription" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Schedule Maintenance</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Maintenance History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="maintenanceSearch" placeholder="Search by vehicle...">
                                        <button class="btn btn-outline-secondary" type="button" id="maintenanceSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Type</th>
                                                    <th>Date</th>
                                                    <th>Cost</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="maintenanceTableBody">
                                                <!-- Maintenance history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payments Tab -->
                        <div class="tab-pane fade" id="payments">
                            <h2 class="mb-4">Payment Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Payment Processing
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="paymentCustomerSearch" class="form-label">Search Customer</label>
                                            <input type="text" class="form-control" id="paymentCustomerSearch" placeholder="Search customer...">
                                            <div class="suggestion-list" id="paymentCustomerSuggestions"></div>
                                        </div>
                                        <div class="col-md-6 d-flex align-items-end">
                                            <button class="btn btn-primary me-2" id="searchPaymentCustomerBtn">Search</button>
                                        </div>
                                    </div>
                                    <div id="paymentDetailsContainer" style="display: none;">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Customer Name</label>
                                                <input type="text" class="form-control" id="paymentCustomerName" readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Total Rental Debt</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="paymentRentalDebt" readonly>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Total Fines Debt</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="paymentFinesDebt" readonly>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Total Debt</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="paymentTotalDebt" readonly>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <form id="paymentForm">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="paymentAmount" class="form-label">Payment Amount</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="paymentAmount" required>
                                                        <span class="input-group-text">AED</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="paymentDate" class="form-label">Payment Date</label>
                                                    <input type="date" class="form-control" id="paymentDate" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="paymentTime" class="form-label">Payment Time</label>
                                                    <input type="time" class="form-control" id="paymentTime" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="paymentMethod" class="form-label">Payment Method</label>
                                                    <select class="form-select" id="paymentMethod" required>
                                                        <option value="">Select method</option>
                                                        <option value="Cash">Cash</option>
                                                        <option value="Credit Card">Credit Card</option>
                                                        <option value="Bank Transfer">Bank Transfer</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="paymentNotes" class="form-label">Notes</label>
                                                <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-success">Process Payment</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Payment History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="paymentHistorySearch" placeholder="Search by customer...">
                                        <button class="btn btn-outline-secondary" type="button" id="paymentHistorySearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Time</th>
                                                    <th>Method</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentHistoryTableBody">
                                                <!-- Payment history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fines & Taxes Tab -->
                        <div class="tab-pane fade" id="fines">
                            <h2 class="mb-4">Fines & Taxes Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Add Fine/Tax
                                </div>
                                <div class="card-body">
                                    <form id="addFineForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineCustomer" class="form-label">Customer</label>
                                                <input type="text" class="form-control" id="fineCustomer" placeholder="Search customer...">
                                                <div class="suggestion-list" id="fineCustomerSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineType" class="form-label">Type</label>
                                                <select class="form-select" id="fineType" required>
                                                    <option value="">Select type</option>
                                                    <option value="Traffic Fine">Traffic Fine</option>
                                                    <option value="Late Return">Late Return</option>
                                                    <option value="Damage Fee">Damage Fee</option>
                                                    <option value="Cleaning Fee">Cleaning Fee</option>
                                                    <option value="Tax">Tax</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="fineAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="fineDate" required>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="fineDescription" class="form-label">Description</label>
                                            <textarea class="form-control" id="fineDescription" rows="3" required></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Fine/Tax</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Fines & Taxes History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="finesSearch" placeholder="Search by customer...">
                                        <button class="btn btn-outline-secondary" type="button" id="finesSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Customer</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="finesTableBody">
                                                <!-- Fines history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div class="tab-pane fade" id="reports">
                            <h2 class="mb-4">Reports</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Generate Report
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="reportType" class="form-label">Report Type</label>
                                            <select class="form-select" id="reportType">
                                                <option value="rental">Rental Report</option>
                                                <option value="financial">Financial Report</option>
                                                <option value="vehicle">Vehicle Report</option>
                                                <option value="customer">Customer Report</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="reportStartDate" class="form-label">Start Date</label>
                                            <input type="date" class="form-control" id="reportStartDate">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="reportEndDate" class="form-label">End Date</label>
                                            <input type="date" class="form-control" id="reportEndDate">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
                                    <button class="btn btn-success ms-2" id="exportReportBtn">Export to Excel</button>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Report Results
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="reportTable">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Amount</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                </tr>
                                            </thead>
                                            <tbody id="reportTableBody">
                                                <!-- Report data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Settings Tab -->
                        <div class="tab-pane fade admin-only" id="settings">
                            <h2 class="mb-4">System Settings</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    System Configuration
                                </div>
                                <div class="card-body">
                                    <form id="systemSettingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="systemLogo" class="form-label">System Logo</label>
                                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label for="systemAddress" class="form-label">Company Address</label>
                                                <textarea class="form-control" id="systemAddress" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="systemContact" class="form-label">Contact Number</label>
                                                <input type="text" class="form-control" id="systemContact">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="systemEmail" class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="systemEmail">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    User Management
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Username</th>
                                                    <th>Role</th>
                                                    <th>Permissions</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="userManagementTableBody">
                                                <!-- User management data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade admin-only" id="userManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="userManagementForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="newUsername" class="form-label">Username</label>
                                <input type="text" class="form-control" id="newUsername" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="newUserRole" class="form-label">Role</label>
                                <select class="form-select" id="newUserRole" required>
                                    <option value="admin">Admin</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="newUserPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="newUserPassword" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="confirmUserPassword" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="confirmUserPassword" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Permissions</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionDashboard" checked>
                                <label class="form-check-label" for="permissionDashboard">Dashboard</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionVehicles" checked>
                                <label class="form-check-label" for="permissionVehicles">Vehicles</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionRentals" checked>
                                <label class="form-check-label" for="permissionRentals">Rentals & Customers</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionReturns" checked>
                                <label class="form-check-label" for="permissionReturns">Vehicle Returns</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionMaintenance" checked>
                                <label class="form-check-label" for="permissionMaintenance">Vehicle Maintenance</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionPayments" checked>
                                <label class="form-check-label" for="permissionPayments">Payments</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionFines" checked>
                                <label class="form-check-label" for="permissionFines">Fines & Taxes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionReports" checked>
                                <label class="form-check-label" for="permissionReports">Reports</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionSettings">
                                <label class="form-check-label" for="permissionSettings">System Settings</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Data storage
        let vehicles = [];
        let customers = [];
        let rentals = [];
        let returns = [];
        let maintenance = [];
        let payments = [];
        let fines = [];
        let users = [
            { username: 'admin', password: '000000', role: 'admin', permissions: ['dashboard', 'vehicles', 'rentals', 'returns', 'maintenance', 'payments', 'fines', 'reports', 'settings'] },
            { username: 'viewer', password: '000000', role: 'viewer', permissions: ['dashboard', 'vehicles', 'rentals', 'returns', 'maintenance', 'payments', 'fines', 'reports'] }
        ];
        let systemSettings = {
            systemName: 'Car Rental System',
            systemLogo: '',
            systemAddress: '',
            systemContact: '',
            systemEmail: ''
        };
        let currentUser = null;

        // Color suggestions
        const colorSuggestions = ['Red', 'Blue', 'Green', 'Black', 'White', 'Silver', 'Gray', 'Yellow', 'Orange', 'Purple', 'Brown', 'Pink', 'Gold', 'Navy', 'Maroon', 'Teal', 'Cyan', 'Magenta', 'Lime', 'Olive', 'Coral', 'Indigo', 'Violet', 'Beige', 'Turquoise'];

        // Model year suggestions
        const modelSuggestions = ['2019', '2020', '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030'];

        // Country suggestions for nationality
        const countrySuggestions = [
            'United Arab Emirates', 'Saudi Arabia', 'Kuwait', 'Qatar', 'Oman', 'Bahrain', 'Egypt', 'Jordan', 'Lebanon', 'Syria',
            'Iraq', 'Yemen', 'Palestine', 'Morocco', 'Algeria', 'Tunisia', 'Libya', 'Sudan', 'Somalia', 'Djibouti',
            'United States', 'Canada', 'United Kingdom', 'France', 'Germany', 'Italy', 'Spain', 'Netherlands', 'Belgium', 'Switzerland',
            'Sweden', 'Norway', 'Denmark', 'Finland', 'Russia', 'China', 'Japan', 'South Korea', 'India', 'Pakistan',
            'Bangladesh', 'Sri Lanka', 'Philippines', 'Indonesia', 'Malaysia', 'Singapore', 'Thailand', 'Vietnam', 'Australia', 'New Zealand'
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkLoginStatus();
            
            // Load data from localStorage
            loadData();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize suggestions
            initializeSuggestions();
        });

        // Check login status
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('currentUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        // Show main application
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUser').textContent = currentUser.username;
            
            // Update UI based on user permissions
            updateUIForUserRole();
            
            // Load dashboard
            loadDashboard();
        }

        // Update UI based on user role
        function updateUIForUserRole() {
            const adminElements = document.querySelectorAll('.admin-only');
            const userElements = document.querySelectorAll('.user-only');
            
            if (currentUser.role === 'admin') {
                adminElements.forEach(el => el.style.display = 'block');
                userElements.forEach(el => el.style.display = 'none');
            } else {
                adminElements.forEach(el => el.style.display = 'none');
                userElements.forEach(el => el.style.display = 'block');
                
                // Hide tabs that user doesn't have permission for
                const tabItems = document.querySelectorAll('.nav-item');
                tabItems.forEach(item => {
                    const tabId = item.classList[1].replace('-item', '');
                    if (!currentUser.permissions.includes(tabId)) {
                        item.style.display = 'none';
                    }
                });
            }
        }

        // Load data from localStorage
        function loadData() {
            // Load vehicles
            const savedVehicles = localStorage.getItem('vehicles');
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
            } else {
                // Add sample vehicles if none exist
                vehicles = [
                    {
                        id: 1,
                        name: 'Toyota Camry',
                        model: '2022',
                        color: 'Silver',
                        plate: 'DXB-123',
                        vin: '1HGCM82633A123456',
                        odometer: 15000,
                        rentalPrice: 200,
                        status: 'available',
                        image: ''
                    },
                    {
                        id: 2,
                        name: 'Honda Accord',
                        model: '2021',
                        color: 'Black',
                        plate: 'SHJ-456',
                        vin: '1HGCM82633A654321',
                        odometer: 22000,
                        rentalPrice: 180,
                        status: 'available',
                        image: ''
                    },
                    {
                        id: 3,
                        name: 'Nissan Altima',
                        model: '2023',
                        color: 'White',
                        plate: 'AUH-789',
                        vin: '1N4AL11D75C123456',
                        odometer: 5000,
                        rentalPrice: 220,
                        status: 'rented',
                        image: ''
                    }
                ];
                saveVehicles();
            }
            
            // Load customers
            const savedCustomers = localStorage.getItem('customers');
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            } else {
                // Add sample customers if none exist
                customers = [
                    {
                        id: 1,
                        fullName: 'Ahmed Mohammed',
                        age: 35,
                        idNumber: '784-1990-1234567-1',
                        nationality: 'United Arab Emirates',
                        contact: '+971-50-123-4567',
                        address: 'Dubai, UAE',
                        guaranteeDoc: '',
                        totalDebt: 0
                    },
                    {
                        id: 2,
                        fullName: 'John Smith',
                        age: 42,
                        idNumber: 'US-123-45-6789',
                        nationality: 'United States',
                        contact: '+1-555-123-4567',
                        address: 'New York, USA',
                        guaranteeDoc: '',
                        totalDebt: 0
                    }
                ];
                saveCustomers();
            }
            
            // Load rentals
            const savedRentals = localStorage.getItem('rentals');
            if (savedRentals) {
                rentals = JSON.parse(savedRentals);
            } else {
                // Add sample rentals if none exist
                rentals = [
                    {
                        id: 1,
                        invoiceCode: 'INV-001',
                        customerId: 1,
                        vehicleId: 3,
                        startDate: '2023-05-01',
                        endDate: '2023-05-05',
                        amount: 220,
                        days: 4,
                        status: 'active',
                        createdDate: '2023-04-28'
                    }
                ];
                saveRentals();
            }
            
            // Load returns
            const savedReturns = localStorage.getItem('returns');
            if (savedReturns) {
                returns = JSON.parse(savedReturns);
            } else {
                returns = [];
                saveReturns();
            }
            
            // Load maintenance
            const savedMaintenance = localStorage.getItem('maintenance');
            if (savedMaintenance) {
                maintenance = JSON.parse(savedMaintenance);
            } else {
                maintenance = [];
                saveMaintenance();
            }
            
            // Load payments
            const savedPayments = localStorage.getItem('payments');
            if (savedPayments) {
                payments = JSON.parse(savedPayments);
            } else {
                payments = [];
                savePayments();
            }
            
            // Load fines
            const savedFines = localStorage.getItem('fines');
            if (savedFines) {
                fines = JSON.parse(savedFines);
            } else {
                fines = [];
                saveFines();
            }
            
            // Load users
            const savedUsers = localStorage.getItem('users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                saveUsers();
            }
            
            // Load system settings
            const savedSettings = localStorage.getItem('systemSettings');
            if (savedSettings) {
                systemSettings = JSON.parse(savedSettings);
                updateSystemUI();
            } else {
                saveSystemSettings();
            }
        }

        // Save data to localStorage
        function saveVehicles() {
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
        }

        function saveCustomers() {
            localStorage.setItem('customers', JSON.stringify(customers));
        }

        function saveRentals() {
            localStorage.setItem('rentals', JSON.stringify(rentals));
        }

        function saveReturns() {
            localStorage.setItem('returns', JSON.stringify(returns));
        }

        function saveMaintenance() {
            localStorage.setItem('maintenance', JSON.stringify(maintenance));
        }

        function savePayments() {
            localStorage.setItem('payments', JSON.stringify(payments));
        }

        function saveFines() {
            localStorage.setItem('fines', JSON.stringify(fines));
        }

        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function saveSystemSettings() {
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            updateSystemUI();
        }

        // Update system UI with settings
        function updateSystemUI() {
            document.getElementById('headerSystemName').textContent = systemSettings.systemName;
            document.getElementById('sidebarSystemName').textContent = systemSettings.systemName;
            document.getElementById('printSystemName').textContent = systemSettings.systemName;
            
            if (systemSettings.systemLogo) {
                document.getElementById('headerLogo').src = systemSettings.systemLogo;
                document.getElementById('headerLogo').style.display = 'inline';
                document.getElementById('sidebarLogo').src = systemSettings.systemLogo;
                document.getElementById('sidebarLogo').style.display = 'inline';
                document.getElementById('printLogo').src = systemSettings.systemLogo;
                document.getElementById('printLogo').style.display = 'inline';
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Vehicle form
            document.getElementById('addVehicleForm').addEventListener('submit', handleAddVehicle);
            
            // Customer form
            document.getElementById('addCustomerForm').addEventListener('submit', handleAddCustomer);
            
            // Rental form
            document.getElementById('createRentalForm').addEventListener('submit', handleCreateRental);
            
            // Return form
            document.getElementById('returnVehicleForm').addEventListener('submit', handleReturnVehicle);
            
            // Maintenance form
            document.getElementById('scheduleMaintenanceForm').addEventListener('submit', handleScheduleMaintenance);
            
            // Payment form
            document.getElementById('paymentForm').addEventListener('submit', handlePayment);
            
            // Fine form
            document.getElementById('addFineForm').addEventListener('submit', handleAddFine);
            
            // System settings form
            document.getElementById('systemSettingsForm').addEventListener('submit', handleSystemSettings);
            
            // Change password form
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            
            // User management form
            document.getElementById('userManagementForm').addEventListener('submit', handleAddUser);
            
            // Search buttons
            document.getElementById('vehicleSearchBtn').addEventListener('click', searchVehicles);
            document.getElementById('customerSearchBtn').addEventListener('click', searchCustomers);
            document.getElementById('rentalSearchBtn').addEventListener('click', searchRentals);
            document.getElementById('returnHistorySearchBtn').addEventListener('click', searchReturnHistory);
            document.getElementById('maintenanceSearchBtn').addEventListener('click', searchMaintenance);
            document.getElementById('paymentHistorySearchBtn').addEventListener('click', searchPaymentHistory);
            document.getElementById('finesSearchBtn').addEventListener('click', searchFines);
            
            // Invoice search for returns
            document.getElementById('searchInvoiceBtn').addEventListener('click', searchInvoiceForReturn);
            
            // Customer search for payments
            document.getElementById('searchPaymentCustomerBtn').addEventListener('click', searchCustomerForPayment);
            
            // Report generation
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('exportReportBtn').addEventListener('click', exportReport);
            
            // Close details buttons
            document.getElementById('closeVehicleDetails').addEventListener('click', closeVehicleDetails);
            document.getElementById('closeCustomerDetails').addEventListener('click', closeCustomerDetails);
            
            // Tab changes
            document.querySelectorAll('a[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('href');
                    if (target === '#vehicleList') {
                        loadVehicleTable();
                    } else if (target === '#customerList') {
                        loadCustomerTable();
                    } else if (target === '#rentalList') {
                        loadRentalTable();
                    } else if (target === '#returns') {
                        loadReturnHistoryTable();
                    } else if (target === '#maintenance') {
                        loadMaintenanceTable();
                    } else if (target === '#payments') {
                        loadPaymentHistoryTable();
                    } else if (target === '#fines') {
                        loadFinesTable();
                    } else if (target === '#settings') {
                        loadUserManagementTable();
                    }
                });
            });
        }

        // Initialize suggestion functionality
        function initializeSuggestions() {
            // Color suggestions
            const colorInput = document.getElementById('vehicleColor');
            const colorSuggestionsDiv = document.getElementById('colorSuggestions');
            
            colorInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = colorSuggestions.filter(color => 
                    color.toLowerCase().includes(value)
                );
                
                showSuggestions(colorSuggestionsDiv, filtered, colorInput);
            });
            
            // Model suggestions
            const modelInput = document.getElementById('vehicleModel');
            const modelSuggestionsDiv = document.getElementById('modelSuggestions');
            
            modelInput.addEventListener('input', function() {
                const value = this.value;
                const filtered = modelSuggestions.filter(model => 
                    model.includes(value)
                );
                
                showSuggestions(modelSuggestionsDiv, filtered, modelInput);
            });
            
            // Nationality suggestions
            const nationalityInput = document.getElementById('customerNationality');
            const nationalitySuggestionsDiv = document.getElementById('nationalitySuggestions');
            
            nationalityInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = countrySuggestions.filter(country => 
                    country.toLowerCase().includes(value)
                );
                
                showSuggestions(nationalitySuggestionsDiv, filtered, nationalityInput);
            });
            
            // Customer suggestions for rental
            const rentalCustomerInput = document.getElementById('rentalCustomer');
            const customerSuggestionsDiv = document.getElementById('customerSuggestions');
            
            rentalCustomerInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = customers.filter(customer => 
                    customer.fullName.toLowerCase().includes(value)
                ).map(customer => customer.fullName);
                
                showSuggestions(customerSuggestionsDiv, filtered, rentalCustomerInput);
            });
            
            // Vehicle suggestions for rental
            const rentalVehicleInput = document.getElementById('rentalVehicle');
            const vehicleSuggestionsDiv = document.getElementById('vehicleSuggestions');
            
            rentalVehicleInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const availableVehicles = vehicles.filter(vehicle => 
                    vehicle.status === 'available' && 
                    vehicle.name.toLowerCase().includes(value)
                ).map(vehicle => vehicle.name);
                
                showSuggestions(vehicleSuggestionsDiv, availableVehicles, rentalVehicleInput);
            });
            
            // Invoice suggestions for returns
            const returnInvoiceInput = document.getElementById('returnInvoiceSearch');
            const returnInvoiceSuggestionsDiv = document.getElementById('returnInvoiceSuggestions');
            
            returnInvoiceInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const activeRentals = rentals.filter(rental => 
                    rental.status === 'active' && 
                    rental.invoiceCode.toLowerCase().includes(value)
                ).map(rental => rental.invoiceCode);
                
                showSuggestions(returnInvoiceSuggestionsDiv, activeRentals, returnInvoiceInput);
            });
            
            // Vehicle suggestions for maintenance
            const maintenanceVehicleInput = document.getElementById('maintenanceVehicle');
            const maintenanceVehicleSuggestionsDiv = document.getElementById('maintenanceVehicleSuggestions');
            
            maintenanceVehicleInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = vehicles.filter(vehicle => 
                    vehicle.name.toLowerCase().includes(value)
                ).map(vehicle => vehicle.name);
                
                showSuggestions(maintenanceVehicleSuggestionsDiv, filtered, maintenanceVehicleInput);
            });
            
            // Customer suggestions for payments
            const paymentCustomerInput = document.getElementById('paymentCustomerSearch');
            const paymentCustomerSuggestionsDiv = document.getElementById('paymentCustomerSuggestions');
            
            paymentCustomerInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = customers.filter(customer => 
                    customer.fullName.toLowerCase().includes(value)
                ).map(customer => customer.fullName);
                
                showSuggestions(paymentCustomerSuggestionsDiv, filtered, paymentCustomerInput);
            });
            
            // Customer suggestions for fines
            const fineCustomerInput = document.getElementById('fineCustomer');
            const fineCustomerSuggestionsDiv = document.getElementById('fineCustomerSuggestions');
            
            fineCustomerInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = customers.filter(customer => 
                    customer.fullName.toLowerCase().includes(value)
                ).map(customer => customer.fullName);
                
                showSuggestions(fineCustomerSuggestionsDiv, filtered, fineCustomerInput);
            });
        }

        // Show suggestions dropdown
        function showSuggestions(suggestionsDiv, items, inputElement) {
            if (items.length > 0) {
                suggestionsDiv.innerHTML = '';
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = item;
                    div.addEventListener('click', function() {
                        inputElement.value = item;
                        suggestionsDiv.style.display = 'none';
                    });
                    suggestionsDiv.appendChild(div);
                });
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.matches('.form-control')) {
                document.querySelectorAll('.suggestion-list').forEach(list => {
                    list.style.display = 'none';
                });
            }
        });

        // Login handler
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('Invalid username or password');
            }
        }

        // Logout handler
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginScreen();
        }

        // Add vehicle handler
        function handleAddVehicle(e) {
            e.preventDefault();
            
            const name = document.getElementById('vehicleName').value;
            const odometer = parseInt(document.getElementById('vehicleOdometer').value);
            const vin = document.getElementById('vehicleVin').value;
            const plate = document.getElementById('vehiclePlate').value;
            const color = document.getElementById('vehicleColor').value;
            const model = document.getElementById('vehicleModel').value;
            const rentalPrice = parseFloat(document.getElementById('vehicleRentalPrice').value);
            
            const newVehicle = {
                id: vehicles.length > 0 ? Math.max(...vehicles.map(v => v.id)) + 1 : 1,
                name,
                model,
                color,
                plate,
                vin,
                odometer,
                rentalPrice,
                status: 'available',
                image: ''
            };
            
            // Handle image upload
            const imageInput = document.getElementById('vehicleImage');
            if (imageInput.files.length > 0) {
                const file = imageInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newVehicle.image = e.target.result;
                    vehicles.push(newVehicle);
                    saveVehicles();
                    resetForm('addVehicleForm');
                    alert('Vehicle added successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                vehicles.push(newVehicle);
                saveVehicles();
                resetForm('addVehicleForm');
                alert('Vehicle added successfully!');
            }
        }

        // Add customer handler
        function handleAddCustomer(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('customerFullName').value;
            const age = parseInt(document.getElementById('customerAge').value);
            const idNumber = document.getElementById('customerId').value;
            const nationality = document.getElementById('customerNationality').value;
            const contact = document.getElementById('customerContact').value;
            const address = document.getElementById('customerAddress').value;
            
            const newCustomer = {
                id: customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1,
                fullName,
                age,
                idNumber,
                nationality,
                contact,
                address,
                guaranteeDoc: '',
                totalDebt: 0
            };
            
            // Handle document upload
            const docInput = document.getElementById('guaranteeDoc');
            if (docInput.files.length > 0) {
                const file = docInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    newCustomer.guaranteeDoc = e.target.result;
                    customers.push(newCustomer);
                    saveCustomers();
                    resetForm('addCustomerForm');
                    alert('Customer added successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                customers.push(newCustomer);
                saveCustomers();
                resetForm('addCustomerForm');
                alert('Customer added successfully!');
            }
        }

        // Create rental handler
        function handleCreateRental(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('rentalCustomer').value;
            const vehicleName = document.getElementById('rentalVehicle').value;
            const amount = parseFloat(document.getElementById('rentalAmount').value);
            const days = parseInt(document.getElementById('rentalDays').value);
            const startDate = document.getElementById('rentalStartDate').value;
            const endDate = document.getElementById('rentalEndDate').value;
            const invoiceCode = document.getElementById('invoiceCode').value || `INV-${Date.now()}`;
            
            const customer = customers.find(c => c.fullName === customerName);
            const vehicle = vehicles.find(v => v.name === vehicleName);
            
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            if (vehicle.status !== 'available') {
                alert('Vehicle is not available for rental!');
                return;
            }
            
            const newRental = {
                id: rentals.length > 0 ? Math.max(...rentals.map(r => r.id)) + 1 : 1,
                invoiceCode,
                customerId: customer.id,
                vehicleId: vehicle.id,
                startDate,
                endDate,
                amount,
                days,
                status: 'active',
                createdDate: new Date().toISOString().split('T')[0]
            };
            
            // Update vehicle status
            vehicle.status = 'rented';
            
            rentals.push(newRental);
            saveRentals();
            saveVehicles();
            
            resetForm('createRentalForm');
            alert('Rental created successfully!');
            
            // Print invoice
            printInvoice(newRental, customer, vehicle);
        }

        // Return vehicle handler
        function handleReturnVehicle(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const odometer = parseInt(document.getElementById('returnOdometer').value);
            const returnDate = document.getElementById('returnDate').value;
            const returnTime = document.getElementById('returnTime').value;
            const fuelLevel = document.getElementById('returnFuelLevel').value;
            const notes = document.getElementById('returnNotes').value;
            
            const rental = rentals.find(r => r.invoiceCode === invoiceCode);
            if (!rental) {
                alert('Rental not found!');
                return;
            }
            
            const vehicle = vehicles.find(v => v.id === rental.vehicleId);
            const customer = customers.find(c => c.id === rental.customerId);
            
            if (!vehicle || !customer) {
                alert('Vehicle or customer not found!');
                return;
            }
            
            // Update vehicle status and odometer
            vehicle.status = 'available';
            vehicle.odometer = odometer;
            
            // Update rental status
            rental.status = 'completed';
            
            // Create return record
            const newReturn = {
                id: returns.length > 0 ? Math.max(...returns.map(r => r.id)) + 1 : 1,
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: customer.id,
                vehicleId: vehicle.id,
                returnDate,
                returnTime,
                odometer,
                fuelLevel,
                notes,
                images: []
            };
            
            // Handle return images
            const imagesInput = document.getElementById('returnImages');
            if (imagesInput.files.length > 0) {
                const files = Array.from(imagesInput.files);
                const readers = files.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });
                });
                
                Promise.all(readers).then(images => {
                    newReturn.images = images;
                    returns.push(newReturn);
                    saveReturns();
                    saveVehicles();
                    saveRentals();
                    resetForm('returnVehicleForm');
                    document.getElementById('returnFormContainer').style.display = 'none';
                    alert('Vehicle returned successfully!');
                });
            } else {
                returns.push(newReturn);
                saveReturns();
                saveVehicles();
                saveRentals();
                resetForm('returnVehicleForm');
                document.getElementById('returnFormContainer').style.display = 'none';
                alert('Vehicle returned successfully!');
            }
        }

        // Schedule maintenance handler
        function handleScheduleMaintenance(e) {
            e.preventDefault();
            
            const vehicleName = document.getElementById('maintenanceVehicle').value;
            const type = document.getElementById('maintenanceType').value;
            const date = document.getElementById('maintenanceDate').value;
            const cost = parseFloat(document.getElementById('maintenanceCost').value);
            const description = document.getElementById('maintenanceDescription').value;
            
            const vehicle = vehicles.find(v => v.name === vehicleName);
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            const newMaintenance = {
                id: maintenance.length > 0 ? Math.max(...maintenance.map(m => m.id)) + 1 : 1,
                vehicleId: vehicle.id,
                type,
                date,
                cost,
                description,
                status: 'scheduled'
            };
            
            maintenance.push(newMaintenance);
            saveMaintenance();
            resetForm('scheduleMaintenanceForm');
            alert('Maintenance scheduled successfully!');
        }

        // Payment handler
        function handlePayment(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('paymentCustomerName').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const date = document.getElementById('paymentDate').value;
            const time = document.getElementById('paymentTime').value;
            const method = document.getElementById('paymentMethod').value;
            const notes = document.getElementById('paymentNotes').value;
            
            const customer = customers.find(c => c.fullName === customerName);
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            const newPayment = {
                id: payments.length > 0 ? Math.max(...payments.map(p => p.id)) + 1 : 1,
                customerId: customer.id,
                amount,
                date,
                time,
                method,
                notes
            };
            
            // Update customer debt
            customer.totalDebt = Math.max(0, customer.totalDebt - amount);
            
            payments.push(newPayment);
            savePayments();
            saveCustomers();
            resetForm('paymentForm');
            alert('Payment processed successfully!');
        }

        // Add fine handler
        function handleAddFine(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('fineCustomer').value;
            const type = document.getElementById('fineType').value;
            const amount = parseFloat(document.getElementById('fineAmount').value);
            const date = document.getElementById('fineDate').value;
            const description = document.getElementById('fineDescription').value;
            
            const customer = customers.find(c => c.fullName === customerName);
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            const newFine = {
                id: fines.length > 0 ? Math.max(...fines.map(f => f.id)) + 1 : 1,
                customerId: customer.id,
                type,
                amount,
                date,
                description,
                status: 'unpaid'
            };
            
            // Update customer debt
            customer.totalDebt += amount;
            
            fines.push(newFine);
            saveFines();
            saveCustomers();
            resetForm('addFineForm');
            alert('Fine/tax added successfully!');
        }

        // System settings handler
        function handleSystemSettings(e) {
            e.preventDefault();
            
            const systemName = document.getElementById('systemName').value;
            const systemAddress = document.getElementById('systemAddress').value;
            const systemContact = document.getElementById('systemContact').value;
            const systemEmail = document.getElementById('systemEmail').value;
            
            systemSettings.systemName = systemName;
            systemSettings.systemAddress = systemAddress;
            systemSettings.systemContact = systemContact;
            systemSettings.systemEmail = systemEmail;
            
            // Handle logo upload
            const logoInput = document.getElementById('systemLogo');
            if (logoInput.files.length > 0) {
                const file = logoInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemSettings.systemLogo = e.target.result;
                    saveSystemSettings();
                    resetForm('systemSettingsForm');
                    alert('System settings saved successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                saveSystemSettings();
                resetForm('systemSettingsForm');
                alert('System settings saved successfully!');
            }
        }

        // Change password handler
        function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            if (currentUser.password !== currentPassword) {
                alert('Current password is incorrect!');
                return;
            }
            
            currentUser.password = newPassword;
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                saveUsers();
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                resetForm('changePasswordForm');
                document.getElementById('changePasswordModal').querySelector('.btn-close').click();
                alert('Password changed successfully!');
            }
        }

        // Add user handler
        function handleAddUser(e) {
            e.preventDefault();
            
            const username = document.getElementById('newUsername').value;
            const role = document.getElementById('newUserRole').value;
            const password = document.getElementById('newUserPassword').value;
            const confirmPassword = document.getElementById('confirmUserPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            // Get permissions
            const permissions = [];
            if (document.getElementById('permissionDashboard').checked) permissions.push('dashboard');
            if (document.getElementById('permissionVehicles').checked) permissions.push('vehicles');
            if (document.getElementById('permissionRentals').checked) permissions.push('rentals');
            if (document.getElementById('permissionReturns').checked) permissions.push('returns');
            if (document.getElementById('permissionMaintenance').checked) permissions.push('maintenance');
            if (document.getElementById('permissionPayments').checked) permissions.push('payments');
            if (document.getElementById('permissionFines').checked) permissions.push('fines');
            if (document.getElementById('permissionReports').checked) permissions.push('reports');
            if (document.getElementById('permissionSettings').checked) permissions.push('settings');
            
            const newUser = {
                username,
                password,
                role,
                permissions
            };
            
            users.push(newUser);
            saveUsers();
            resetForm('userManagementForm');
            document.getElementById('userManagementModal').querySelector('.btn-close').click();
            alert('User added successfully!');
        }

        // Search functions
        function searchVehicles() {
            const query = document.getElementById('vehicleSearch').value.toLowerCase();
            loadVehicleTable(query);
        }

        function searchCustomers() {
            const query = document.getElementById('customerSearch').value.toLowerCase();
            loadCustomerTable(query);
        }

        function searchRentals() {
            const query = document.getElementById('rentalSearch').value.toLowerCase();
            loadRentalTable(query);
        }

        function searchReturnHistory() {
            const query = document.getElementById('returnHistorySearch').value.toLowerCase();
            loadReturnHistoryTable(query);
        }

        function searchMaintenance() {
            const query = document.getElementById('maintenanceSearch').value.toLowerCase();
            loadMaintenanceTable(query);
        }

        function searchPaymentHistory() {
            const query = document.getElementById('paymentHistorySearch').value.toLowerCase();
            loadPaymentHistoryTable(query);
        }

        function searchFines() {
            const query = document.getElementById('finesSearch').value.toLowerCase();
            loadFinesTable(query);
        }

        function searchInvoiceForReturn() {
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const rental = rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'active');
            
            if (rental) {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                if (customer && vehicle) {
                    document.getElementById('returnCustomer').value = customer.fullName;
                    document.getElementById('returnVehicle').value = vehicle.name;
                    document.getElementById('returnStartDate').value = rental.startDate;
                    document.getElementById('returnEndDate').value = rental.endDate;
                    document.getElementById('returnFormContainer').style.display = 'block';
                } else {
                    alert('Customer or vehicle not found!');
                }
            } else {
                alert('Active rental with this invoice code not found!');
            }
        }

        function searchCustomerForPayment() {
            const customerName = document.getElementById('paymentCustomerSearch').value;
            const customer = customers.find(c => c.fullName === customerName);
            
            if (customer) {
                // Calculate total rental debt
                const customerRentals = rentals.filter(r => r.customerId === customer.id && r.status === 'active');
                const rentalDebt = customerRentals.reduce((sum, rental) => sum + (rental.amount * rental.days), 0);
                
                // Calculate total fines debt
                const customerFines = fines.filter(f => f.customerId === customer.id && f.status === 'unpaid');
                const finesDebt = customerFines.reduce((sum, fine) => sum + fine.amount, 0);
                
                const totalDebt = rentalDebt + finesDebt;
                
                document.getElementById('paymentCustomerName').value = customer.fullName;
                document.getElementById('paymentRentalDebt').value = rentalDebt.toFixed(2);
                document.getElementById('paymentFinesDebt').value = finesDebt.toFixed(2);
                document.getElementById('paymentTotalDebt').value = totalDebt.toFixed(2);
                document.getElementById('paymentDetailsContainer').style.display = 'block';
            } else {
                alert('Customer not found!');
            }
        }

        // Load dashboard
        function loadDashboard() {
            // Calculate statistics
            const totalVehicles = vehicles.length;
            const availableVehicles = vehicles.filter(v => v.status === 'available').length;
            const rentedVehicles = vehicles.filter(v => v.status === 'rented').length;
            const totalCustomers = customers.length;
            const activeRentals = rentals.filter(r => r.status === 'active').length;
            const totalRevenue = payments.reduce((sum, payment) => sum + payment.amount, 0);
            
            // Update dashboard stats
            document.getElementById('dashboardStats').innerHTML = `
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalVehicles}</h4>
                                    <p>Total Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${availableVehicles}</h4>
                                    <p>Available Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${rentedVehicles}</h4>
                                    <p>Rented Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-road fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalCustomers}</h4>
                                    <p>Total Customers</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-secondary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${activeRentals}</h4>
                                    <p>Active Rentals</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-clipboard-list fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card dashboard-card bg-dark text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalRevenue.toFixed(2)}</h4>
                                    <p>Total Revenue (AED)</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load recent rentals
            const recentRentals = rentals.slice(-5).reverse();
            let recentRentalsHTML = '';
            recentRentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                if (customer && vehicle) {
                    recentRentalsHTML += `
                        <tr>
                            <td>${customer.fullName}</td>
                            <td>${vehicle.name}</td>
                            <td>${rental.startDate}</td>
                            <td>${rental.amount * rental.days} AED</td>
                            <td><span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">${rental.status}</span></td>
                        </tr>
                    `;
                }
            });
            document.getElementById('recentRentalsTable').innerHTML = recentRentalsHTML;
            
            // Load vehicle status chart
            const ctx = document.getElementById('vehicleStatusChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented', 'Maintenance'],
                    datasets: [{
                        data: [
                            vehicles.filter(v => v.status === 'available').length,
                            vehicles.filter(v => v.status === 'rented').length,
                            vehicles.filter(v => v.status === 'maintenance').length
                        ],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#dc3545'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Load vehicle table
        function loadVehicleTable(query = '') {
            let filteredVehicles = vehicles;
            if (query) {
                filteredVehicles = vehicles.filter(vehicle => 
                    vehicle.name.toLowerCase().includes(query) ||
                    vehicle.plate.toLowerCase().includes(query) ||
                    vehicle.model.toLowerCase().includes(query) ||
                    vehicle.color.toLowerCase().includes(query)
                );
            }
            
            let vehicleTableHTML = '';
            filteredVehicles.forEach(vehicle => {
                vehicleTableHTML += `
                    <tr>
                        <td>
                            ${vehicle.image ? `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : '<i class="fas fa-car fa-2x text-muted"></i>'}
                        </td>
                        <td>${vehicle.name}</td>
                        <td>${vehicle.model}</td>
                        <td>${vehicle.color}</td>
                        <td>${vehicle.plate}</td>
                        <td>${vehicle.odometer.toLocaleString()} km</td>
                        <td>${vehicle.rentalPrice} AED</td>
                        <td>
                            <span class="badge ${vehicle.status === 'available' ? 'bg-success' : vehicle.status === 'rented' ? 'bg-warning' : 'bg-danger'}">
                                ${vehicle.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${currentUser.role === 'admin' ? `
                            <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById('vehicleTableBody').innerHTML = vehicleTableHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-vehicle').forEach(button => {
                button.addEventListener('click', function() {
                    const vehicleId = parseInt(this.getAttribute('data-id'));
                    viewVehicleDetails(vehicleId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-vehicle').forEach(button => {
                    button.addEventListener('click', function() {
                        const vehicleId = parseInt(this.getAttribute('data-id'));
                        editVehicle(vehicleId);
                    });
                });
                
                document.querySelectorAll('.delete-vehicle').forEach(button => {
                    button.addEventListener('click', function() {
                        const vehicleId = parseInt(this.getAttribute('data-id'));
                        deleteVehicle(vehicleId);
                    });
                });
            }
        }

        // View vehicle details
        function viewVehicleDetails(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            const vehicleRentals = rentals.filter(r => r.vehicleId === vehicleId);
            const vehicleMaintenance = maintenance.filter(m => m.vehicleId === vehicleId);
            
            let detailsHTML = `
                <div class="row">
                    <div class="col-md-4">
                        ${vehicle.image ? `<img src="${vehicle.image}" class="img-fluid rounded" alt="${vehicle.name}">` : '<i class="fas fa-car fa-5x text-muted"></i>'}
                    </div>
                    <div class="col-md-8">
                        <h4>${vehicle.name}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Model</th>
                                <td>${vehicle.model}</td>
                            </tr>
                            <tr>
                                <th>Color</th>
                                <td>${vehicle.color}</td>
                            </tr>
                            <tr>
                                <th>Plate Number</th>
                                <td>${vehicle.plate}</td>
                            </tr>
                            <tr>
                                <th>VIN</th>
                                <td>${vehicle.vin}</td>
                            </tr>
                            <tr>
                                <th>Odometer</th>
                                <td>${vehicle.odometer.toLocaleString()} km</td>
                            </tr>
                            <tr>
                                <th>Rental Price</th>
                                <td>${vehicle.rentalPrice} AED / day</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td>
                                    <span class="badge ${vehicle.status === 'available' ? 'bg-success' : vehicle.status === 'rented' ? 'bg-warning' : 'bg-danger'}">
                                        ${vehicle.status}
                                    </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (vehicleRentals.length > 0) {
                vehicleRentals.forEach(rental => {
                    const customer = customers.find(c => c.id === rental.customerId);
                    if (customer) {
                        detailsHTML += `
                            <tr>
                                <td>${customer.fullName}</td>
                                <td>${rental.startDate} to ${rental.endDate}</td>
                                <td>${rental.amount * rental.days} AED</td>
                            </tr>
                        `;
                    }
                });
            } else {
                detailsHTML += `<tr><td colspan="3" class="text-center">No rental history</td></tr>`;
            }
            
            detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Maintenance History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Date</th>
                                        <th>Cost</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (vehicleMaintenance.length > 0) {
                vehicleMaintenance.forEach(maint => {
                    detailsHTML += `
                        <tr>
                            <td>${maint.type}</td>
                            <td>${maint.date}</td>
                            <td>${maint.cost} AED</td>
                        </tr>
                    `;
                });
            } else {
                detailsHTML += `<tr><td colspan="3" class="text-center">No maintenance history</td></tr>`;
            }
            
            detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('vehicleDetailsContent').innerHTML = detailsHTML;
            document.getElementById('vehicleDetailsCard').style.display = 'block';
        }

        // Edit vehicle
        function editVehicle(vehicleId) {
            // Implementation for editing a vehicle
            alert('Edit vehicle functionality would be implemented here');
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                const index = vehicles.findIndex(v => v.id === vehicleId);
                if (index !== -1) {
                    vehicles.splice(index, 1);
                    saveVehicles();
                    loadVehicleTable();
                    alert('Vehicle deleted successfully!');
                }
            }
        }

        // Close vehicle details
        function closeVehicleDetails() {
            document.getElementById('vehicleDetailsCard').style.display = 'none';
        }

        // Load customer table
        function loadCustomerTable(query = '') {
            let filteredCustomers = customers;
            if (query) {
                filteredCustomers = customers.filter(customer => 
                    customer.fullName.toLowerCase().includes(query) ||
                    customer.idNumber.toLowerCase().includes(query) ||
                    customer.nationality.toLowerCase().includes(query) ||
                    customer.contact.toLowerCase().includes(query)
                );
            }
            
            let customerTableHTML = '';
            filteredCustomers.forEach(customer => {
                customerTableHTML += `
                    <tr>
                        <td>${customer.fullName}</td>
                        <td>${customer.age}</td>
                        <td>${customer.idNumber}</td>
                        <td>${customer.nationality}</td>
                        <td>${customer.contact}</td>
                        <td>${customer.totalDebt.toFixed(2)} AED</td>
                        <td>
                            <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${currentUser.role === 'admin' ? `
                            <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById('customerTableBody').innerHTML = customerTableHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-customer').forEach(button => {
                button.addEventListener('click', function() {
                    const customerId = parseInt(this.getAttribute('data-id'));
                    viewCustomerDetails(customerId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-customer').forEach(button => {
                    button.addEventListener('click', function() {
                        const customerId = parseInt(this.getAttribute('data-id'));
                        editCustomer(customerId);
                    });
                });
                
                document.querySelectorAll('.delete-customer').forEach(button => {
                    button.addEventListener('click', function() {
                        const customerId = parseInt(this.getAttribute('data-id'));
                        deleteCustomer(customerId);
                    });
                });
            }
        }

        // View customer details
        function viewCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerRentals = rentals.filter(r => r.customerId === customerId);
            const customerFines = fines.filter(f => f.customerId === customerId);
            const customerPayments = payments.filter(p => p.customerId === customerId);
            
            let detailsHTML = `
                <div class="row">
                    <div class="col-md-4">
                        ${customer.guaranteeDoc ? `<img src="${customer.guaranteeDoc}" class="img-fluid rounded" alt="Guarantee Document">` : '<i class="fas fa-user fa-5x text-muted"></i>'}
                    </div>
                    <div class="col-md-8">
                        <h4>${customer.fullName}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Age</th>
                                <td>${customer.age}</td>
                            </tr>
                            <tr>
                                <th>ID Number</th>
                                <td>${customer.idNumber}</td>
                            </tr>
                            <tr>
                                <th>Nationality</th>
                                <td>${customer.nationality}</td>
                            </tr>
                            <tr>
                                <th>Contact</th>
                                <td>${customer.contact}</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td>${customer.address}</td>
                            </tr>
                            <tr>
                                <th>Total Debt</th>
                                <td>${customer.totalDebt.toFixed(2)} AED</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-4">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Vehicle</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (customerRentals.length > 0) {
                customerRentals.forEach(rental => {
                    const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                    if (vehicle) {
                        detailsHTML += `
                            <tr>
                                <td>${vehicle.name}</td>
                                <td>${rental.startDate} to ${rental.endDate}</td>
                                <td>${rental.amount * rental.days} AED</td>
                            </tr>
                        `;
                    }
                });
            } else {
                detailsHTML += `<tr><td colspan="3" class="text-center">No rental history</td></tr>`;
            }
            
            detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h5>Fines & Taxes</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (customerFines.length > 0) {
                customerFines.forEach(fine => {
                    detailsHTML += `
                        <tr>
                            <td>${fine.type}</td>
                            <td>${fine.amount} AED</td>
                            <td>${fine.date}</td>
                        </tr>
                    `;
                });
            } else {
                detailsHTML += `<tr><td colspan="3" class="text-center">No fines or taxes</td></tr>`;
            }
            
            detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h5>Payment History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Amount</th>
                                        <th>Date</th>
                                        <th>Method</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (customerPayments.length > 0) {
                customerPayments.forEach(payment => {
                    detailsHTML += `
                        <tr>
                            <td>${payment.amount} AED</td>
                            <td>${payment.date}</td>
                            <td>${payment.method}</td>
                        </tr>
                    `;
                });
            } else {
                detailsHTML += `<tr><td colspan="3" class="text-center">No payment history</td></tr>`;
            }
            
            detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('customerDetailsContent').innerHTML = detailsHTML;
            document.getElementById('customerDetailsCard').style.display = 'block';
        }

        // Edit customer
        function editCustomer(customerId) {
            // Implementation for editing a customer
            alert('Edit customer functionality would be implemented here');
        }

        // Delete customer
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                // Check if customer has active rentals
                const activeRentals = rentals.filter(r => r.customerId === customerId && r.status === 'active');
                if (activeRentals.length > 0) {
                    alert('Cannot delete customer with active rentals!');
                    return;
                }
                
                const index = customers.findIndex(c => c.id === customerId);
                if (index !== -1) {
                    customers.splice(index, 1);
                    saveCustomers();
                    loadCustomerTable();
                    alert('Customer deleted successfully!');
                }
            }
        }

        // Close customer details
        function closeCustomerDetails() {
            document.getElementById('customerDetailsCard').style.display = 'none';
        }

        // Load rental table
        function loadRentalTable(query = '') {
            let filteredRentals = rentals;
            if (query) {
                filteredRentals = rentals.filter(rental => 
                    rental.invoiceCode.toLowerCase().includes(query)
                );
            }
            
            let rentalTableHTML = '';
            filteredRentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                if (customer && vehicle) {
                    rentalTableHTML += `
                        <tr>
                            <td>${rental.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${vehicle.name}</td>
                            <td>${rental.startDate}</td>
                            <td>${rental.endDate}</td>
                            <td>${rental.amount * rental.days} AED</td>
                            <td>
                                <span class="badge ${rental.status === 'active' ? 'bg-warning' : 'bg-success'}">
                                    ${rental.status}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info view-rental" data-id="${rental.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${currentUser.role === 'admin' && rental.status === 'active' ? `
                                <button class="btn btn-sm btn-success return-rental" data-id="${rental.id}">
                                    <i class="fas fa-undo"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('rentalTableBody').innerHTML = rentalTableHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-rental').forEach(button => {
                button.addEventListener('click', function() {
                    const rentalId = parseInt(this.getAttribute('data-id'));
                    viewRentalDetails(rentalId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.return-rental').forEach(button => {
                    button.addEventListener('click', function() {
                        const rentalId = parseInt(this.getAttribute('data-id'));
                        initiateReturn(rentalId);
                    });
                });
            }
        }

        // View rental details
        function viewRentalDetails(rentalId) {
            // Implementation for viewing rental details
            alert('View rental details functionality would be implemented here');
        }

        // Initiate return process
        function initiateReturn(rentalId) {
            const rental = rentals.find(r => r.id === rentalId);
            if (rental) {
                document.getElementById('returnInvoiceSearch').value = rental.invoiceCode;
                searchInvoiceForReturn();
                
                // Switch to returns tab
                document.querySelector('a[href="#returns"]').click();
            }
        }

        // Load return history table
        function loadReturnHistoryTable(query = '') {
            let filteredReturns = returns;
            if (query) {
                filteredReturns = returns.filter(ret => 
                    ret.invoiceCode.toLowerCase().includes(query)
                );
            }
            
            let returnHistoryHTML = '';
            filteredReturns.forEach(ret => {
                const customer = customers.find(c => c.id === ret.customerId);
                const vehicle = vehicles.find(v => v.id === ret.vehicleId);
                
                if (customer && vehicle) {
                    returnHistoryHTML += `
                        <tr>
                            <td>${ret.invoiceCode}</td>
                            <td>${customer.fullName}</td>
                            <td>${vehicle.name}</td>
                            <td>${ret.returnDate} ${ret.returnTime}</td>
                            <td>${ret.odometer.toLocaleString()} km</td>
                            <td>${ret.fuelLevel}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-return" data-id="${ret.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('returnHistoryTableBody').innerHTML = returnHistoryHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-return').forEach(button => {
                button.addEventListener('click', function() {
                    const returnId = parseInt(this.getAttribute('data-id'));
                    viewReturnDetails(returnId);
                });
            });
        }

        // View return details
        function viewReturnDetails(returnId) {
            // Implementation for viewing return details
            alert('View return details functionality would be implemented here');
        }

        // Load maintenance table
        function loadMaintenanceTable(query = '') {
            let filteredMaintenance = maintenance;
            if (query) {
                filteredMaintenance = maintenance.filter(maint => {
                    const vehicle = vehicles.find(v => v.id === maint.vehicleId);
                    return vehicle && vehicle.name.toLowerCase().includes(query);
                });
            }
            
            let maintenanceHTML = '';
            filteredMaintenance.forEach(maint => {
                const vehicle = vehicles.find(v => v.id === maint.vehicleId);
                
                if (vehicle) {
                    maintenanceHTML += `
                        <tr>
                            <td>${vehicle.name}</td>
                            <td>${maint.type}</td>
                            <td>${maint.date}</td>
                            <td>${maint.cost} AED</td>
                            <td>${maint.description}</td>
                            <td>
                                <span class="badge ${maint.status === 'scheduled' ? 'bg-warning' : maint.status === 'completed' ? 'bg-success' : 'bg-danger'}">
                                    ${maint.status}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info view-maintenance" data-id="${maint.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${currentUser.role === 'admin' ? `
                                <button class="btn btn-sm btn-warning edit-maintenance" data-id="${maint.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-maintenance" data-id="${maint.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('maintenanceTableBody').innerHTML = maintenanceHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-maintenance').forEach(button => {
                button.addEventListener('click', function() {
                    const maintenanceId = parseInt(this.getAttribute('data-id'));
                    viewMaintenanceDetails(maintenanceId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-maintenance').forEach(button => {
                    button.addEventListener('click', function() {
                        const maintenanceId = parseInt(this.getAttribute('data-id'));
                        editMaintenance(maintenanceId);
                    });
                });
                
                document.querySelectorAll('.delete-maintenance').forEach(button => {
                    button.addEventListener('click', function() {
                        const maintenanceId = parseInt(this.getAttribute('data-id'));
                        deleteMaintenance(maintenanceId);
                    });
                });
            }
        }

        // View maintenance details
        function viewMaintenanceDetails(maintenanceId) {
            // Implementation for viewing maintenance details
            alert('View maintenance details functionality would be implemented here');
        }

        // Edit maintenance
        function editMaintenance(maintenanceId) {
            // Implementation for editing maintenance
            alert('Edit maintenance functionality would be implemented here');
        }

        // Delete maintenance
        function deleteMaintenance(maintenanceId) {
            if (confirm('Are you sure you want to delete this maintenance record?')) {
                const index = maintenance.findIndex(m => m.id === maintenanceId);
                if (index !== -1) {
                    maintenance.splice(index, 1);
                    saveMaintenance();
                    loadMaintenanceTable();
                    alert('Maintenance record deleted successfully!');
                }
            }
        }

        // Load payment history table
        function loadPaymentHistoryTable(query = '') {
            let filteredPayments = payments;
            if (query) {
                filteredPayments = payments.filter(payment => {
                    const customer = customers.find(c => c.id === payment.customerId);
                    return customer && customer.fullName.toLowerCase().includes(query);
                });
            }
            
            let paymentHistoryHTML = '';
            filteredPayments.forEach(payment => {
                const customer = customers.find(c => c.id === payment.customerId);
                
                if (customer) {
                    paymentHistoryHTML += `
                        <tr>
                            <td>${customer.fullName}</td>
                            <td>${payment.amount} AED</td>
                            <td>${payment.date}</td>
                            <td>${payment.time}</td>
                            <td>${payment.method}</td>
                            <td>${payment.notes}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-payment" data-id="${payment.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${currentUser.role === 'admin' ? `
                                <button class="btn btn-sm btn-warning edit-payment" data-id="${payment.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-payment" data-id="${payment.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('paymentHistoryTableBody').innerHTML = paymentHistoryHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-payment').forEach(button => {
                button.addEventListener('click', function() {
                    const paymentId = parseInt(this.getAttribute('data-id'));
                    viewPaymentDetails(paymentId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-payment').forEach(button => {
                    button.addEventListener('click', function() {
                        const paymentId = parseInt(this.getAttribute('data-id'));
                        editPayment(paymentId);
                    });
                });
                
                document.querySelectorAll('.delete-payment').forEach(button => {
                    button.addEventListener('click', function() {
                        const paymentId = parseInt(this.getAttribute('data-id'));
                        deletePayment(paymentId);
                    });
                });
            }
        }

        // View payment details
        function viewPaymentDetails(paymentId) {
            // Implementation for viewing payment details
            alert('View payment details functionality would be implemented here');
        }

        // Edit payment
        function editPayment(paymentId) {
            // Implementation for editing payment
            alert('Edit payment functionality would be implemented here');
        }

        // Delete payment
        function deletePayment(paymentId) {
            if (confirm('Are you sure you want to delete this payment record?')) {
                const index = payments.findIndex(p => p.id === paymentId);
                if (index !== -1) {
                    // Restore customer debt
                    const payment = payments[index];
                    const customer = customers.find(c => c.id === payment.customerId);
                    if (customer) {
                        customer.totalDebt += payment.amount;
                        saveCustomers();
                    }
                    
                    payments.splice(index, 1);
                    savePayments();
                    loadPaymentHistoryTable();
                    alert('Payment record deleted successfully!');
                }
            }
        }

        // Load fines table
        function loadFinesTable(query = '') {
            let filteredFines = fines;
            if (query) {
                filteredFines = fines.filter(fine => {
                    const customer = customers.find(c => c.id === fine.customerId);
                    return customer && customer.fullName.toLowerCase().includes(query);
                });
            }
            
            let finesHTML = '';
            filteredFines.forEach(fine => {
                const customer = customers.find(c => c.id === fine.customerId);
                
                if (customer) {
                    finesHTML += `
                        <tr>
                            <td>${customer.fullName}</td>
                            <td>${fine.type}</td>
                            <td>${fine.amount} AED</td>
                            <td>${fine.date}</td>
                            <td>${fine.description}</td>
                            <td>
                                <span class="badge ${fine.status === 'paid' ? 'bg-success' : 'bg-danger'}">
                                    ${fine.status}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info view-fine" data-id="${fine.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${currentUser.role === 'admin' ? `
                                <button class="btn btn-sm btn-warning edit-fine" data-id="${fine.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-fine" data-id="${fine.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('finesTableBody').innerHTML = finesHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-fine').forEach(button => {
                button.addEventListener('click', function() {
                    const fineId = parseInt(this.getAttribute('data-id'));
                    viewFineDetails(fineId);
                });
            });
            
            if (currentUser.role === 'admin') {
                document.querySelectorAll('.edit-fine').forEach(button => {
                    button.addEventListener('click', function() {
                        const fineId = parseInt(this.getAttribute('data-id'));
                        editFine(fineId);
                    });
                });
                
                document.querySelectorAll('.delete-fine').forEach(button => {
                    button.addEventListener('click', function() {
                        const fineId = parseInt(this.getAttribute('data-id'));
                        deleteFine(fineId);
                    });
                });
            }
        }

        // View fine details
        function viewFineDetails(fineId) {
            // Implementation for viewing fine details
            alert('View fine details functionality would be implemented here');
        }

        // Edit fine
        function editFine(fineId) {
            // Implementation for editing fine
            alert('Edit fine functionality would be implemented here');
        }

        // Delete fine
        function deleteFine(fineId) {
            if (confirm('Are you sure you want to delete this fine record?')) {
                const index = fines.findIndex(f => f.id === fineId);
                if (index !== -1) {
                    // Update customer debt
                    const fine = fines[index];
                    const customer = customers.find(c => c.id === fine.customerId);
                    if (customer) {
                        customer.totalDebt = Math.max(0, customer.totalDebt - fine.amount);
                        saveCustomers();
                    }
                    
                    fines.splice(index, 1);
                    saveFines();
                    loadFinesTable();
                    alert('Fine record deleted successfully!');
                }
            }
        }

        // Load user management table
        function loadUserManagementTable() {
            let userManagementHTML = '';
            users.forEach(user => {
                if (user.username !== currentUser.username) {
                    userManagementHTML += `
                        <tr>
                            <td>${user.username}</td>
                            <td>${user.role}</td>
                            <td>${user.permissions.join(', ')}</td>
                            <td>
                                <button class="btn btn-sm btn-warning edit-user" data-username="${user.username}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-user" data-username="${user.username}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }
            });
            
            document.getElementById('userManagementTableBody').innerHTML = userManagementHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-user').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    editUser(username);
                });
            });
            
            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    deleteUser(username);
                });
            });
        }

        // Edit user
        function editUser(username) {
            // Implementation for editing user
            alert('Edit user functionality would be implemented here');
        }

        // Delete user
        function deleteUser(username) {
            if (confirm('Are you sure you want to delete this user?')) {
                const index = users.findIndex(u => u.username === username);
                if (index !== -1) {
                    users.splice(index, 1);
                    saveUsers();
                    loadUserManagementTable();
                    alert('User deleted successfully!');
                }
            }
        }

        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            let reportData = [];
            let reportHTML = '';
            
            switch (reportType) {
                case 'rental':
                    reportData = rentals.filter(rental => {
                        if (startDate && rental.startDate < startDate) return false;
                        if (endDate && rental.startDate > endDate) return false;
                        return true;
                    });
                    
                    reportData.forEach(rental => {
                        const customer = customers.find(c => c.id === rental.customerId);
                        const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                        
                        if (customer && vehicle) {
                            reportHTML += `
                                <tr>
                                    <td>${rental.startDate}</td>
                                    <td>Rental: ${vehicle.name} to ${customer.fullName}</td>
                                    <td>${rental.amount * rental.days} AED</td>
                                    <td>${customer.fullName}</td>
                                    <td>${vehicle.name}</td>
                                </tr>
                            `;
                        }
                    });
                    break;
                    
                case 'financial':
                    // Combine rentals, payments, and fines
                    const financialData = [];
                    
                    // Add rentals
                    rentals.forEach(rental => {
                        if ((!startDate || rental.startDate >= startDate) && (!endDate || rental.startDate <= endDate)) {
                            const customer = customers.find(c => c.id === rental.customerId);
                            const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                            
                            if (customer && vehicle) {
                                financialData.push({
                                    date: rental.startDate,
                                    description: `Rental: ${vehicle.name} to ${customer.fullName}`,
                                    amount: rental.amount * rental.days,
                                    customer: customer.fullName,
                                    vehicle: vehicle.name,
                                    type: 'income'
                                });
                            }
                        }
                    });
                    
                    // Add payments
                    payments.forEach(payment => {
                        if ((!startDate || payment.date >= startDate) && (!endDate || payment.date <= endDate)) {
                            const customer = customers.find(c => c.id === payment.customerId);
                            
                            if (customer) {
                                financialData.push({
                                    date: payment.date,
                                    description: `Payment from ${customer.fullName}`,
                                    amount: payment.amount,
                                    customer: customer.fullName,
                                    vehicle: '',
                                    type: 'income'
                                });
                            }
                        }
                    });
                    
                    // Add fines
                    fines.forEach(fine => {
                        if ((!startDate || fine.date >= startDate) && (!endDate || fine.date <= endDate)) {
                            const customer = customers.find(c => c.id === fine.customerId);
                            
                            if (customer) {
                                financialData.push({
                                    date: fine.date,
                                    description: `Fine: ${fine.type} for ${customer.fullName}`,
                                    amount: fine.amount,
                                    customer: customer.fullName,
                                    vehicle: '',
                                    type: 'income'
                                });
                            }
                        }
                    });
                    
                    // Add maintenance costs
                    maintenance.forEach(maint => {
                        if ((!startDate || maint.date >= startDate) && (!endDate || maint.date <= endDate)) {
                            const vehicle = vehicles.find(v => v.id === maint.vehicleId);
                            
                            if (vehicle) {
                                financialData.push({
                                    date: maint.date,
                                    description: `Maintenance: ${maint.type} for ${vehicle.name}`,
                                    amount: -maint.cost,
                                    customer: '',
                                    vehicle: vehicle.name,
                                    type: 'expense'
                                });
                            }
                        }
                    });
                    
                    // Sort by date
                    financialData.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    financialData.forEach(item => {
                        reportHTML += `
                            <tr>
                                <td>${item.date}</td>
                                <td>${item.description}</td>
                                <td>${item.amount} AED</td>
                                <td>${item.customer}</td>
                                <td>${item.vehicle}</td>
                            </tr>
                        `;
                    });
                    break;
                    
                case 'vehicle':
                    reportData = vehicles;
                    
                    reportData.forEach(vehicle => {
                        const vehicleRentals = rentals.filter(r => r.vehicleId === vehicle.id);
                        const totalRevenue = vehicleRentals.reduce((sum, rental) => sum + (rental.amount * rental.days), 0);
                        
                        reportHTML += `
                            <tr>
                                <td>N/A</td>
                                <td>Vehicle: ${vehicle.name} (${vehicle.status})</td>
                                <td>${totalRevenue} AED</td>
                                <td>N/A</td>
                                <td>${vehicle.name}</td>
                            </tr>
                        `;
                    });
                    break;
                    
                case 'customer':
                    reportData = customers;
                    
                    reportData.forEach(customer => {
                        reportHTML += `
                            <tr>
                                <td>N/A</td>
                                <td>Customer: ${customer.fullName}</td>
                                <td>${customer.totalDebt} AED debt</td>
                                <td>${customer.fullName}</td>
                                <td>N/A</td>
                            </tr>
                        `;
                    });
                    break;
            }
            
            document.getElementById('reportTableBody').innerHTML = reportHTML;
        }

        // Export report to Excel
        function exportReport() {
            // Simple implementation - in a real app, you would use a library like SheetJS
            const table = document.getElementById('reportTable');
            let csv = [];
            
            // Add headers
            const headers = [];
            for (let i = 0; i < table.rows[0].cells.length; i++) {
                headers.push(table.rows[0].cells[i].innerText);
            }
            csv.push(headers.join(','));
            
            // Add rows
            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                const rowData = [];
                for (let j = 0; j < row.cells.length; j++) {
                    rowData.push(row.cells[j].innerText);
                }
                csv.push(rowData.join(','));
            }
            
            // Download CSV
            const csvContent = "data:text/csv;charset=utf-8," + csv.join('\n');
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "report.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Print invoice
        function printInvoice(rental, customer, vehicle) {
            document.getElementById('printInvoiceCode').textContent = rental.invoiceCode;
            document.getElementById('printInvoiceDate').textContent = new Date().toLocaleDateString();
            document.getElementById('printCustomerName').textContent = customer.fullName;
            document.getElementById('printVehicleName').textContent = vehicle.name;
            document.getElementById('printCustomerId').textContent = customer.idNumber;
            document.getElementById('printCustomerAddress').textContent = customer.address;
            document.getElementById('printRentalAmount').textContent = rental.amount + ' AED';
            document.getElementById('printRentalDays').textContent = rental.days;
            document.getElementById('printTotalAmount').textContent = (rental.amount * rental.days) + ' AED';
            
            // Add rental history
            const customerRentals = rentals.filter(r => r.customerId === customer.id);
            let rentalHistoryHTML = '';
            customerRentals.forEach(r => {
                const v = vehicles.find(veh => veh.id === r.vehicleId);
                if (v) {
                    rentalHistoryHTML += `<div>${r.startDate} to ${r.endDate} - ${v.name} - ${r.amount * r.days} AED</div>`;
                }
            });
            document.getElementById('printRentalHistory').innerHTML = rentalHistoryHTML;
            
            // Show print dialog
            window.print();
        }

        // Reset form
        function resetForm(formId) {
            document.getElementById(formId).reset();
        }

        // Set today's date as default for date fields
        function setTodayDate(fieldId) {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById(fieldId).value = today;
        }

        // Set current time as default for time fields
        function setCurrentTime(fieldId) {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById(fieldId).value = `${hours}:${minutes}`;
        }

        // Initialize date and time fields
        setTodayDate('rentalStartDate');
        setTodayDate('rentalEndDate');
        setTodayDate('returnDate');
        setTodayDate('maintenanceDate');
        setTodayDate('fineDate');
        setTodayDate('paymentDate');
        setTodayDate('reportStartDate');
        setTodayDate('reportEndDate');
        
        setCurrentTime('returnTime');
        setCurrentTime('paymentTime');
    </script>
</body>
</html>